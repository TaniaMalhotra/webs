<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	
	xmlns:georss="http://www.georss.org/georss"
	xmlns:geo="http://www.w3.org/2003/01/geo/wgs84_pos#"
	>

<channel>
	<title>react &#8211; CSS-Tricks</title>
	<atom:link href="https://css-tricks.com/tag/react/feed/" rel="self" type="application/rss+xml" />
	<link>https://css-tricks.com</link>
	<description>Tips, Tricks, and Techniques on using Cascading Style Sheets.</description>
	<lastBuildDate>Tue, 16 Jun 2020 14:40:06 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.4.2</generator>
<site xmlns="com-wordpress:feed-additions:1">45537868</site>	<item>
		<title>Everything You Need to Know About FLIP Animations in React</title>
		<link>https://css-tricks.com/everything-you-need-to-know-about-flip-animations-in-react/</link>
					<comments>https://css-tricks.com/everything-you-need-to-know-about-flip-animations-in-react/#respond</comments>
		
		<dc:creator><![CDATA[Kirill Vasiltsov]]></dc:creator>
		<pubDate>Tue, 16 Jun 2020 14:40:04 +0000</pubDate>
				<category><![CDATA[Article]]></category>
		<category><![CDATA[flip]]></category>
		<category><![CDATA[react]]></category>
		<category><![CDATA[web animation api]]></category>
		<guid isPermaLink="false">https://css-tricks.com/?p=312119</guid>

					<description><![CDATA[<p>With a very recent Safari update, <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Animations_API">Web Animations API</a> (WAAPI) is <a href="https://caniuse.com/#feat=web-animation">now supported without a flag</a> in all modern browsers (except IE). &#160;Here’s <a href="https://codepen.io/danwilson/pen/xGBKVq">a handy Pen</a> where you can check which features your browser supports. The WAAPI is a nice way to do animation (that needs to be done in JavaScript) because it’s native — meaning it requires no additional libraries to work. If you’re completely new to WAAPI, here’s <a href="https://danielcwilson.com/blog/2015/07/animations-part-1/">a very good introduction by Dan Wilson</a>.</p>
<p>One of &#8230; <a href="https://css-tricks.com/everything-you-need-to-know-about-flip-animations-in-react/" class="read-more">Read article <span class="screen-reader-text"> &#8220;Everything You Need to Know About FLIP Animations in React&#8221;</span></a></p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/everything-you-need-to-know-about-flip-animations-in-react/">Everything You Need to Know About FLIP Animations in React</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></description>
										<content:encoded><![CDATA[
<p>With a very recent Safari update, <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Animations_API">Web Animations API</a> (WAAPI) is <a href="https://caniuse.com/#feat=web-animation">now supported without a flag</a> in all modern browsers (except IE). &nbsp;Here’s <a href="https://codepen.io/danwilson/pen/xGBKVq">a handy Pen</a> where you can check which features your browser supports. The WAAPI is a nice way to do animation (that needs to be done in JavaScript) because it’s native — meaning it requires no additional libraries to work. If you’re completely new to WAAPI, here’s <a href="https://danielcwilson.com/blog/2015/07/animations-part-1/">a very good introduction by Dan Wilson</a>.</p>



<p>One of the most efficient <em>approaches</em> to animation is <a href="https://css-tricks.com/animating-layouts-with-the-flip-technique/">FLIP</a>. FLIP requires a bit of JavaScript to do its thing.&nbsp;</p>



<p>Let’s take a look at the intersection of using the WAAPI, FLIP, and integrating all that into React. But we’ll start without React first, then get to that.</p>



<span id="more-312119"></span>



<h3>FLIP and WAAPI</h3>



<p><a href="https://aerotwist.com/blog/flip-your-animations/">FLIP animations</a> are made much easier by the WAAPI!</p>



<p><strong>Quick refresher on FLIP:</strong> The big idea is that you position the element <em>where you want it to end up first</em>. Next, apply transforms to move it to the starting position. Then unapply those transforms.&nbsp;</p>



<p>Animating transforms is super efficient, thus FLIP is super efficient. Before WAAPI, we had to directly manipulate element’s styles to set transforms and wait for the next frame to unset/invert it:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">// FLIP Before the WAAPI
el.style.transform = `translateY(200px)`;
 
requestAnimationFrame(() => {
  el.style.transform = '';
});</code></pre>



<p>A lot of libraries are built upon this approach. &nbsp;However, there are several problems with this:</p>



<ul><li>Everything feels like a huge hack.</li><li>It is extremely difficult to reverse the FLIP animation. While CSS transforms are reversed “for free” once a class is removed, this is not the case here. Starting a new FLIP while a previous one is running can cause glitches. Reversing requires parsing a transform matrix with <code>getComputedStyles</code> and using it to calculate the current dimensions before setting a new animation.</li><li>Advanced animations are close to impossible. For example, to prevent distorting a scaled parent’s children, we need to have access to current scale value each frame. This can only be done by parsing the transform matrix.</li><li>There’s lots of browser gotchas. For example, <a href="https://github.com/joshwcomeau/react-flip-move/blob/12f58727d38ac33cefb0fe20c91d5d7e19485a3c/src/FlipMove.js#L420">sometimes</a> getting a FLIP animation to work flawlessly in Firefox requires calling <code>requestAnimationFrame</code> twice:</li></ul>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">requestAnimationFrame(() => {
  requestAnimationFrame(() => {
    el.style.transform = '';
  });
});</code></pre>



<p>We get none of these problems when WAAPI is used. Reversing can be painlessly done with <a href="https://developer.mozilla.org/en-US/docs/Web/API/Animation/reverse">the <code>reverse</code>&nbsp;function</a>.The counter-scaling of children <a href="https://developers.google.com/web/updates/2017/03/performant-expand-and-collapse">is also possible</a>. And when there is a bug, it is easy to pinpoint the exact culprit since we’re only working with simple functions, like <code>animate</code>&nbsp;and <code>reverse</code>, rather than combing through things like the <code>requestAnimationFrame</code> approach.&nbsp;</p>



<p>Here’s the outline of the WAAPI version:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">el.classList.toggle('someclass');
const keyframes = /* Calculate the size/position diff */;
el.animate(keyframes, 2000);</code></pre>



<h3>FLIP and React</h3>



<p>To understand how FLIP animations work in React, it is important to know <em>how</em> and, most importantly, <em>why</em> they work in plain JavaScript. Recall the anatomy of a FLIP animation:</p>



<figure class="wp-block-image size-full is-resized"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/06/JakPwnSa.png?resize=299%2C723&#038;ssl=1" alt="Diagram. Cache current site and position, make a style change, get new size and position, calculate the difference, set transforms, and cancel transforms. Each item has a purple background, except the last one, indicating they happen before paint." class="wp-image-312120" width="299" height="723" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/06/JakPwnSa.png?w=398&amp;ssl=1 398w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/06/JakPwnSa.png?resize=124%2C300&amp;ssl=1 124w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>Everything that has a purple background needs to happen before the “paint” step of rendering. Otherwise, we would see a flash of new styles for a moment which is not good. Things get a little bit more complicated in React since all DOM updates are done for us.</p>



<p>The magic of FLIP animations is that an element is transformed <em>before</em> the browser has a chance to paint. So how do we know the “before paint” moment in React?</p>



<p>Meet <a href="https://reactjs.org/docs/hooks-reference.html%23uselayouteffect">the <code>useLayoutEffect</code> hook</a>. If you even wondered what is for… this is it! Anything we pass in this callback happens synchronously <em>after</em> DOM updates but <em>before</em> paint. In other words, this is a great place to set up a FLIP!</p>



<p>Let us do something the FLIP technique is very good for: <strong>animating the DOM position.</strong> There’s nothing CSS can do if we want to animate how an element moves from one DOM position to another. (Imagine completing a task in a to-do list and moving it to the list of “completed” tasks like when you click on items in the Pen below.)</p>



<div class="wp-block-cp-codepen-gutenberg-embed-block cp_embed_wrapper"><iframe id="cp_embed_mdeYMdX" src="//codepen.io/anon/embed/mdeYMdX?height=450&amp;theme-id=1&amp;slug-hash=mdeYMdX&amp;default-tab=result" height="450" scrolling="no" frameborder="0" allowfullscreen allowpaymentrequest name="CodePen Embed mdeYMdX" title="CodePen Embed mdeYMdX" class="cp_embed_iframe" style="width:100%;overflow:hidden">CodePen Embed Fallback</iframe></div>



<p>Let&#8217;s look at the simplest example. Clicking on any of the two squares in the following Pen makes them swap positions. Without FLIP, it would happen instantly.</p>



<div class="wp-block-cp-codepen-gutenberg-embed-block cp_embed_wrapper"><iframe id="cp_embed_oNjaMrK" src="//codepen.io/anon/embed/oNjaMrK?height=450&amp;theme-id=1&amp;slug-hash=oNjaMrK&amp;default-tab=result" height="450" scrolling="no" frameborder="0" allowfullscreen allowpaymentrequest name="CodePen Embed oNjaMrK" title="CodePen Embed oNjaMrK" class="cp_embed_iframe" style="width:100%;overflow:hidden">CodePen Embed Fallback</iframe></div>



<p>There’s a lot going on there. Notice how all work happens inside lifecycle hook callbacks: <code>useEffect</code> and <code>useLayoutEffect</code>. What makes it a little bit confusing is that the timeline of our FLIP animation is not obvious from code alone since it happens across <strong>two</strong> React renders. Here’s the anatomy of a React FLIP animation to show the different order of operations:</p>



<figure class="wp-block-image size-large is-resized"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/kTkr-F7_.png?fit=1024%2C1024&amp;ssl=1" alt="Diagram. Cache the size and position, retrieve previous size and position from cache, get new size and position, calculate the difference, and play the animation." class="wp-image-312122" width="768" height="767" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/kTkr-F7_.png?w=1229&amp;ssl=1 1229w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/kTkr-F7_.png?resize=300%2C300&amp;ssl=1 300w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/kTkr-F7_.png?resize=1024%2C1024&amp;ssl=1 1024w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/kTkr-F7_.png?resize=150%2C150&amp;ssl=1 150w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/kTkr-F7_.png?resize=768%2C767&amp;ssl=1 768w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/kTkr-F7_.png?resize=1000%2C999&amp;ssl=1 1000w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/kTkr-F7_.png?resize=100%2C100&amp;ssl=1 100w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>Although <code>useEffect</code> always runs after <code>useLayoutEffect</code> and after browser paint, it is important that we cache the element&#8217;s position and size after the first render. We won’t get a chance to do it on second render because <code>useLayoutEffect</code> is run after all DOM updates. But the procedure is essentially the same as with vanilla FLIP animations.</p>



<h3>Caveats</h3>



<p>Like most things, there are some caveats to consider when working with FLIP in React.</p>



<h4>Keep it under 100ms</h4>



<p>A FLIP animation is calculation. Calculation takes time and before you can show that smooth 60fps transform you need to do quite some work. People won’t notice a delay if it is under 100ms, so make sure everything is below that. The Performance tab in DevTools is a good place to check that.</p>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/6LqLR8Jc.png?fit=1024%2C275&amp;ssl=1" alt="" class="wp-image-312123" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/6LqLR8Jc.png?w=2129&amp;ssl=1 2129w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/6LqLR8Jc.png?resize=300%2C81&amp;ssl=1 300w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/6LqLR8Jc.png?resize=1024%2C275&amp;ssl=1 1024w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/6LqLR8Jc.png?resize=768%2C206&amp;ssl=1 768w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/6LqLR8Jc.png?resize=1536%2C413&amp;ssl=1 1536w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/6LqLR8Jc.png?resize=2048%2C550&amp;ssl=1 2048w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/06/6LqLR8Jc.png?resize=1000%2C269&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<h4>Unnecessary renders</h4>



<p>We can’t use useState for caching size, positions and animation objects because every <code>setState</code> will cause an unnecessary render and slow down the app. It can even cause bugs in the worst of cases. Try using <code>useRef</code> instead and think of it as an object that can be mutated without rendering anything.</p>



<h4>Layout thrashing</h4>



<p>Avoid repeatedly triggering browser layout. In the context of FLIP animations, that means avoid looping through elements and reading their position with <code>getBoundingClientRect</code>, then immediately animating them with animate. Batch “reads” and “writes” whenever possible. This will allow for extremely smooth animations.</p>



<h4>Animation canceling</h4>



<p>Try randomly clicking on the squares in <a href="https://codepen.io/jlkiri/pen/oNjaMrK">the earlier demo</a> while they move, then again after they stop. You will see glitches. In real life, users will interact with elements while they move, so it’s worth making sure they are canceled, paused, and updated smoothly.&nbsp;</p>



<p>However, not all animations can be reversed with <code>reverse</code>. Sometimes, we want them to stop and then move to a new position (like when randomly shuffling a list of elements). In this case, we need to:</p>



<ul><li>obtain a size/position of a moving element</li><li>finish the current animation</li><li>calculate the new size and position differences</li><li>start a new animation</li></ul>



<p>In React, this can be harder than it seems. I wasted a lot of time struggling with it. The current animation object must be cached. A good way to do it is to create a <code>Map</code> so to get the animation by an ID. Then, we need to obtain the size and position of the moving element. There are two ways to do it:</p>



<ol><li><strong>Use a function component:</strong> Simply loop through every animated element right in the body of the function and cache the current positions.</li><li><strong>Use a class component:</strong> Use the <a href="https://reactjs.org/docs/react-component.html%23getsnapshotbeforeupdate"><code>getSnapshotBeforeUpdate</code></a> lifecycle method.</li></ol>



<p>In fact, official React docs recommend using <code>getSnapshotBeforeUpdate</code> “because there may be delays between the “render” phase lifecycles (like <code>render</code>) and “commit” phase lifecycles (like <code>getSnapshotBeforeUpdate</code> and <code>componentDidUpdate</code>).” However, there is no hook counterpart of this method yet. I found that using the body of the function component is fine enough.</p>



<h4>Don’t fight the browser</h4>



<p>I’ve said it before, but avoid fighting the browser and try to make things happen the way the browser would do it. If we need to animate a simple size change, then consider whether CSS would suffice (e.g. &nbsp;<code>transform: scale()</code>) . I’ve found that FLIP animations are used best where browsers really can’t help:</p>



<ul><li>Animating DOM position change (as we did above)</li><li>Sharing layout animations</li></ul>



<p>The second is a more complicated version of the first. There are two DOM elements that act and look as one changing its position (while another is unmounted/hidden). This tricks enables some cool animations. For example, this animation is made with a library I built called <a href="https://github.com/jlkiri/react-easy-flip"><code>react-easy-flip</code></a> that uses this approach:</p>



<div class="wp-block-cp-codepen-gutenberg-embed-block cp_embed_wrapper"><iframe id="cp_embed_wvKbeqy" src="//codepen.io/anon/embed/wvKbeqy?height=450&amp;theme-id=1&amp;slug-hash=wvKbeqy&amp;default-tab=result" height="450" scrolling="no" frameborder="0" allowfullscreen allowpaymentrequest name="CodePen Embed wvKbeqy" title="CodePen Embed wvKbeqy" class="cp_embed_iframe" style="width:100%;overflow:hidden">CodePen Embed Fallback</iframe></div>



<h4>Libraries</h4>



<p>There are quite a few libraries that make FLIP animations in React easier and abstract the boilerplate. Ones that are currently maintained actively include: <a href="https://github.com/aholachek/react-flip-toolkit"><code>react-flip-toolkit</code></a> and mine, <a href="https://github.com/jlkiri/react-easy-flip"><code>react-easy-flip</code></a>.</p>



<p>If you do not mind something heavier but capable of more general animations, <a href="https://www.framer.com/motion/">check out <code>framer-motion</code></a>. It also does cool shared layout animations! <a href="https://css-tricks.com/video-screencasts/176-working-with-framer-motion/">There is a video</a> digging into that library.</p>



<hr class="wp-block-separator"/>



<h3>Resources and references</h3>



<ul><li><a href="https://joshwcomeau.com/react/animating-the-unanimatable/">Animating the Unanimatable</a> by Josh W. Comeau</li><li><a href="https://developers.google.com/web/updates/2017/03/performant-expand-and-collapse">Build performant expand &amp; collapse animation</a>s by Paul Lewis and Stephen McGruer</li><li><a href="https://inventingwithmonster.io/20200409-inside-magic-motion/">The Magic Inside Magic Motion</a> by Matt Perry</li><li><a href="https://twitter.com/keyframers/status/1255510937014018050">Using animate CSS variables from JavaScript</a>, tweeted by @keyframers</li><li><a href="https://developers.google.com/web/updates/2018/09/inside-browser-part3/#inner_workings_of_a_renderer_process">Inside look at modern web browser (part 3)</a> by Mariko Kosaka</li><li><a href="https://css-tricks.com/building-a-complex-ui-animation-in-react-simply/">Building a Complex UI Animation in React, Simply</a> by Alex Holachek</li><li><a href="https://css-tricks.com/animating-layouts-with-the-flip-technique/">Animating Layouts with the FLIP Technique</a> by David Khourshid</li><li><a href="https://dev.to/jlkiri/smooth-animations-with-react-hooks-again-51a4">Smooth animations with React Hooks, again</a> by Kirill Vasiltsov&nbsp;</li><li><a href="https://blog.jayantbhawal.in/shared-element-transitions-with-react-hooks/">Shared element transition with React Hooks</a> by Jayant Bhawal</li></ul>



<p></p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/everything-you-need-to-know-about-flip-animations-in-react/">Everything You Need to Know About FLIP Animations in React</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://css-tricks.com/everything-you-need-to-know-about-flip-animations-in-react/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
		<post-id xmlns="com-wordpress:feed-additions:1">312119</post-id>	</item>
		<item>
		<title>&#8220;The Modern Web&#8221;</title>
		<link>https://css-tricks.com/the-modern-web/</link>
					<comments>https://css-tricks.com/the-modern-web/#comments</comments>
		
		<dc:creator><![CDATA[Chris Coyier]]></dc:creator>
		<pubDate>Fri, 22 May 2020 20:11:24 +0000</pubDate>
				<category><![CDATA[Article]]></category>
		<category><![CDATA[performance]]></category>
		<category><![CDATA[react]]></category>
		<category><![CDATA[static sites]]></category>
		<guid isPermaLink="false">https://css-tricks.com/?p=311360</guid>

					<description><![CDATA[<p>A couple of interesting articles making the rounds:</p>
<ul>
<li>Tom MacWrite: <a href="https://macwright.org/2020/05/10/spa-fatigue.html">Second-guessing the modern web</a></li>
<li>Rich Harris: <a href="https://dev.to/richharris/in-defense-of-the-modern-web-2nia">In defense of the modern web</a></li>
</ul>
<p>I like Tom&#8217;s assertion that React (which he&#8217;s using as a stand-in for JavaScript frameworks in general) has an ideal usage:</p>
<blockquote class="wp-block-quote">
<p>There is a sweet spot of React: in moderately interactive interfaces. Complex forms that require immediate feedback, UIs that need to move around and react instantly. That’s where it excels.</p>
</blockquote>
<p>If there is anything I hope for &#8230; <a href="https://css-tricks.com/the-modern-web/" class="read-more">Read article <span class="screen-reader-text"> &#8220;&#8220;The Modern Web&#8221;&#8221;</span></a></p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/the-modern-web/">&#8220;The Modern Web&#8221;</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></description>
										<content:encoded><![CDATA[
<p>A couple of interesting articles making the rounds:</p>



<ul><li>Tom MacWrite: <a href="https://macwright.org/2020/05/10/spa-fatigue.html">Second-guessing the modern web</a></li><li>Rich Harris: <a href="https://dev.to/richharris/in-defense-of-the-modern-web-2nia">In defense of the modern web</a></li></ul>



<span id="more-311360"></span>



<p>I like Tom&#8217;s assertion that React (which he&#8217;s using as a stand-in for JavaScript frameworks in general) has an ideal usage:</p>



<blockquote class="wp-block-quote"><p>There is a sweet spot of React: in moderately interactive interfaces. Complex forms that require immediate feedback, UIs that need to move around and react instantly. That’s where it excels.</p></blockquote>



<p>If there is anything I hope for the world of web design and development, it&#8217;s that we get better at picking the <a href="https://css-tricks.com/the-tools-are-here/">right tools for the job</a>.</p>



<p>I heard several people hone in on this:</p>



<blockquote class="wp-block-quote"><p>I can, for example, guarantee that this blog is faster than&nbsp;<em>any Gatsby blog</em>&nbsp;(and much love to the Gatsby team) because there is nothing that a React static site can do that will make it faster than a non-React static site.</p></blockquote>



<p>One reaction was <em>hell yes</em>. React is a bunch of JavaScript and it does lots of stuff, but does <em>not</em> grant superpowers that make the web faster than it was without it. Another reaction was: <em>well it actually does</em>. That&#8217;s kind of the whole point of SPAs: not needing to reload the page. Instead, we&#8217;re able to make a trimmed network request for the new data needed for a new page and re-rendering only what is necessary. </p>



<p>Rich digs into that even more:</p>



<blockquote class="wp-block-quote"><p>When I tap on a link on Tom&#8217;s JS-free website, the browser first waits to confirm that it was a tap and not a brush/swipe, then makes a request, and then we have to wait for the response. With a framework-authored site with client-side routing, we can start to do more interesting things. We can make informed guesses based on analytics about which things the user is likely to interact with and preload the logic and data for them. We can kick off requests as soon as the user first&nbsp;<em>touches</em>&nbsp;(or hovers) the link instead of waiting for confirmation of a tap — worst case scenario, we&#8217;ve loaded some stuff that will be useful later if they&nbsp;<em>do</em>&nbsp;tap on it. We can provide better visual feedback that loading is taking place and a transition is about to occur. And we don&#8217;t need to load the entire contents of the page — often, we can make do with a small bit of JSON because we already have the JavaScript for the page. This stuff gets fiendishly difficult to do by hand. </p></blockquote>



<p>That&#8217;s what makes this stuff so easy to argue about. Everyone has good points. When we try to speak on behalf of <em>the entire web</em>, it&#8217;s tough for us all to agree. But the web is too big for broad, sweeping assertions.</p>



<p>Do people reach for React-powered SPAs too much? Probably, but that&#8217;s not without reason. There is innovation there that draws people in. The question is, how can we improve it?</p>



<p>From a front-of-the-front-end perspective, the fact that front-end frameworks like React <s>encourage</s> demand us write a front-end in components is compelling all by itself. </p>



<p>There is optimism and pessimism in both posts. The ending sentences of both are starkly different.</p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/the-modern-web/">&#8220;The Modern Web&#8221;</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://css-tricks.com/the-modern-web/feed/</wfw:commentRss>
			<slash:comments>7</slash:comments>
		
		
		<post-id xmlns="com-wordpress:feed-additions:1">311360</post-id>	</item>
		<item>
		<title>React Single File Components Are Here</title>
		<link>https://css-tricks.com/react-single-file-components-are-here/</link>
					<comments>https://css-tricks.com/react-single-file-components-are-here/#comments</comments>
		
		<dc:creator><![CDATA[Chris Coyier]]></dc:creator>
		<pubDate>Wed, 13 May 2020 01:56:27 +0000</pubDate>
				<category><![CDATA[Article]]></category>
		<category><![CDATA[apollo]]></category>
		<category><![CDATA[react]]></category>
		<category><![CDATA[redwoodjs]]></category>
		<category><![CDATA[shoptalk]]></category>
		<guid isPermaLink="false">https://css-tricks.com/?p=310965</guid>

					<description><![CDATA[<p>Shawn Wang is <a href="https://www.swyx.io/writing/react-sfcs-here/">talking about</a> <a href="https://redwoodjs.com/">RedwoodJS</a> here:</p>
<blockquote class="wp-block-quote">
<p>&#8230;  it is the first time React components are being expressed in a single file format with explicit conventions.</p>
</blockquote>
<p>Which is the RedwoodJS idea of <a href="https://redwoodjs.com/tutorial/cells.html#summary">Cells</a>. To me, it feels like a slightly cleaner version of how Apollo wants you to <a href="https://www.apollographql.com/docs/react/data/queries/">do it with useQuery</a>. Shawn makes that same connection and I know RedwoodJS uses Apollo, so I&#8217;m thinking it&#8217;s some nice semantic sugar.</p>
<p>There is a lot of cool stuff &#8230; <a href="https://css-tricks.com/react-single-file-components-are-here/" class="read-more">Read article <span class="screen-reader-text"> &#8220;React Single File Components Are Here&#8221;</span></a></p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/react-single-file-components-are-here/">React Single File Components Are Here</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></description>
										<content:encoded><![CDATA[
<p>Shawn Wang is <a href="https://www.swyx.io/writing/react-sfcs-here/">talking about</a> <a href="https://redwoodjs.com/">RedwoodJS</a> here:</p>



<blockquote class="wp-block-quote"><p>&#8230;  it is the first time React components are being expressed in a single file format with explicit conventions.</p></blockquote>



<p>Which is the RedwoodJS idea of <a href="https://redwoodjs.com/tutorial/cells.html#summary">Cells</a>. To me, it feels like a slightly cleaner version of how Apollo wants you to <a href="https://www.apollographql.com/docs/react/data/queries/">do it with useQuery</a>. Shawn makes that same connection and I know RedwoodJS uses Apollo, so I&#8217;m thinking it&#8217;s some nice semantic sugar.</p>



<p>There is a lot of cool stuff going on in RedwoodJS. &#8220;A highly opinionated stack&#8221; if its helpful to think of it that way, but Tom made clear in <a href="https://shoptalkshow.com/412/">our last episode of ShopTalk</a> that it&#8217;s <em>not like Rails</em>. Not that Rails is bad (it isn&#8217;t), but that this new world can do things in new and better ways that make for long-term healthy software.</p>



<p></p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/react-single-file-components-are-here/">React Single File Components Are Here</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://css-tricks.com/react-single-file-components-are-here/feed/</wfw:commentRss>
			<slash:comments>8</slash:comments>
		
		
		<post-id xmlns="com-wordpress:feed-additions:1">310965</post-id>	</item>
		<item>
		<title>Working With MDX Custom Elements and Shortcodes</title>
		<link>https://css-tricks.com/working-with-mdx-custom-elements-and-shortcodes/</link>
					<comments>https://css-tricks.com/working-with-mdx-custom-elements-and-shortcodes/#respond</comments>
		
		<dc:creator><![CDATA[Agney Menon]]></dc:creator>
		<pubDate>Thu, 07 May 2020 14:18:03 +0000</pubDate>
				<category><![CDATA[Article]]></category>
		<category><![CDATA[gatsby]]></category>
		<category><![CDATA[markdown]]></category>
		<category><![CDATA[mdx]]></category>
		<category><![CDATA[react]]></category>
		<guid isPermaLink="false">https://css-tricks.com/?p=307780</guid>

					<description><![CDATA[<p><a href="https://mdxjs.com/">MDX</a> is a killer feature for things like blogs, slide decks and component documentation. It allows you to write Markdown without worrying about HTML elements, their formatting and placement while sprinkling in the magic of custom React components when necessary.</p>
<p>Let’s harness that magic and look at how we can customize MDX by replacing Markdown elements with our own MDX components. In the process, we’ll introduce the concept of “shortcodes” when using those components.</p>
<p>As a heads up, the code &#8230; <a href="https://css-tricks.com/working-with-mdx-custom-elements-and-shortcodes/" class="read-more">Read article <span class="screen-reader-text"> &#8220;Working With MDX Custom Elements and Shortcodes&#8221;</span></a></p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/working-with-mdx-custom-elements-and-shortcodes/">Working With MDX Custom Elements and Shortcodes</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></description>
										<content:encoded><![CDATA[
<p><a href="https://mdxjs.com/">MDX</a> is a killer feature for things like blogs, slide decks and component documentation. It allows you to write Markdown without worrying about HTML elements, their formatting and placement while sprinkling in the magic of custom React components when necessary.</p>



<p>Let’s harness that magic and look at how we can customize MDX by replacing Markdown elements with our own MDX components. In the process, we’ll introduce the concept of “shortcodes” when using those components.</p>



<p>As a heads up, the code snippets here are based on <a href="https://www.gatsbyjs.org/">GatsbyJS</a> and <a href="https://reactjs.org/">React</a>, but MDX can be written with <a href="https://mdxjs.com/getting-started">different frameworks</a> as well. If you need a primer on MDX, <a href="https://css-tricks.com/an-introduction-to-mdxjs/">start here first</a>. This article extends that one with more advanced concepts.</p>



<h3>Setting up a layout</h3>



<p>We almost always want to render our MDX-based pages in a common layout. That way, they can be arranged with other components on our website. We can specify a default <code>Layout</code> component with the MDX plugin we’re using. For example. we can define a a layout with the <a href="https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-mdx"><code>gatsby-plugin-mdx</code></a> plugin like this:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">{
  resolve: `gatsby-plugin-mdx`,
  options: {
    defaultLayouts: {
      default: path.resolve('./src/templates/blog-post.js'),
    },
    // ...other options
  }
}</code></pre>



<p>This would require the <code>src/templates/blog-post.js</code> file to contain a component that would render the <code>children</code> prop it receives.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import { MDXRenderer } from 'gatsby-plugin-mdx';
 
function BlogPost({ children }) {
  return (
    &lt;div>{children}&lt;/div>
  );
}
 
export default BlogPost;</code></pre>



<p>If we are programmatically creating pages, we’d have to use a component named <code>MDXRenderer</code> to achieve the same thing, as specified in the <a href="https://www.gatsbyjs.org/docs/mdx/programmatically-creating-pages/%23make-a-template-for-your-posts">Gatsby docs</a>.</p>



<h3>Custom Markdown elements</h3>



<p>While MDX is a format where that lets us write custom HTML and React components, its power is rendering Markdown with custom content. But what if we wanted to customize how these Markdown elements render on screen?</p>



<p>We could surely <a href="https://www.gatsbyjs.org/docs/mdx/plugins/%23remark-plugins">write a remark plugin for it</a>, but MDX provides us with a better, simpler solution. By default, these are some of the elements being rendered by Markdown:</p>



<figure class="wp-block-table"><table class="has-fixed-layout"><thead><tr><th>Name</th><th>HTML Element</th><th>MDX Syntax</th></tr></thead><tbody><tr><td><a href="https://github.com/syntax-tree/mdast#paragraph">Paragraph</a></td><td><code>&lt;p&gt;</code></td><td></td></tr><tr><td><a href="https://github.com/syntax-tree/mdast#heading">Heading 1</a></td><td><code>&lt;h1&gt;</code></td><td><code>#</code></td></tr><tr><td><a href="https://github.com/syntax-tree/mdast#heading">Heading 2</a></td><td><code>&lt;h2&gt;</code></td><td><code>##</code></td></tr><tr><td><a href="https://github.com/syntax-tree/mdast#heading">Heading 3</a></td><td><code>&lt;h3&gt;</code></td><td><code>###</code></td></tr><tr><td><a href="https://github.com/syntax-tree/mdast#heading">Heading 4</a></td><td><code>&lt;h4&gt;</code></td><td><code>####</code></td></tr><tr><td><a href="https://github.com/syntax-tree/mdast#heading">Heading 5</a></td><td><code>&lt;h5&gt;</code></td><td><code>#####</code></td></tr><tr><td><a href="https://github.com/syntax-tree/mdast#heading">Heading 6</a></td><td><code>&lt;h6&gt;</code></td><td><code>######</code></td></tr><tr><td><a href="https://github.com/syntax-tree/mdast#list">Unordered List</a></td><td><code>&lt;ul&gt;</code></td><td><code>-</code></td></tr><tr><td><a href="https://github.com/syntax-tree/mdast#list">Ordered List</a></td><td><code>&lt;ol /&gt;</code></td><td><code>1.</code></td></tr><tr><td><a href="https://github.com/syntax-tree/mdast#image">Image</a></td><td><code>&lt;img /&gt;</code></td><td><code>![alt](https://image-url)</code></td></tr></tbody></table><figcaption>A&nbsp;complete list of components&nbsp;is available in the&nbsp;<a rel="noreferrer noopener" target="_blank" href="https://mdxjs.com/table-of-components">MDX Docs</a>.</figcaption></figure>



<p>To replace these defaults with our custom React components, MDX ships with a <code>Provider</code> component named &nbsp;<code>MDXProvider</code>. It relies on the <a href="https://reactjs.org/docs/context">React Context API</a> to inject new custom components and merge them into the defaults provided by MDX.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import React from 'react';
import { MDXProvider } from "@mdx-js/react";
import Image from './image-component';
 
function Layout({ children }) {
  return (
    &lt;MDXProvider
      components={{
        h1: (props) => &lt;h1 {...props} className="text-xl font-light" />
        img: Image,
      }} 
    >
      {children}
    &lt;/MDXProvider>
  );
}
 
export default Layout;</code></pre>



<p>In this example, any H1 heading (<code>#</code>) in the MDX file will be replaced by the custom implementation specified in the <code>Provider</code> component’s prop while all the other elements will continue to use the defaults. In other words, <code>MDXProvider</code> is able to take our custom markup for a H1 element, merge it with MDX defaults, then apply the custom markup when we write Heading 1 (<code>#</code>) in an MDX file.</p>



<h3>MDX and custom components</h3>



<p>Customizing MDX elements is great, but what if we want to introduce <em>our own</em> components into the mix?</p>



<pre rel="MDX" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">---
title: Importing Components
---
import Playground from './Playground';
 
Here is a look at the `Playground` component that I have been building:
 
&lt;Playground /></code></pre>



<p>We can import a component into an MDX file and use it the same way we would any React component. And, sure, while this works well for something like a component demo in a blog post, what if we want to use Playground on all blog posts? It would be a pain to import them to all the pages. Instead. <a href="https://mdxjs.com/blog/shortcodes">MDX presents us with the option to use shortcodes.</a> Here’s how the MDX documentation describes shortcodes:</p>



<blockquote class="wp-block-quote"><p>[A shortcode] allows you to expose components to all of your documents in your app or website. This is a useful feature for common components like YouTube embeds, Twitter cards, or anything else frequently used in your documents.</p></blockquote>



<p>To include shortcodes in an MDX application, we have to rely on the <code>MDXProvider</code> component again.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import React from 'react';
import { MDXProvider } from "@mdx-js/react";
import Playground from './playground-wrapper';
 
function Layout({ children }) {
  return (
    &lt;MDXProvider
      components={{
        h1: (props) => &lt;h1 {...props} className="text-xl font-light" />
        Playground,
      }} 
    >
      {children}
    &lt;/MDXProvider>
  );
}
 
export default Layout;</code></pre>



<p>Once we have included custom components into the components object, we can proceed to use them without importing in MDX files.</p>



<pre rel="MDX" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">---
title: Demoing concepts
---
 
Here's the demo for the new concept:
 
&lt;Playground />
 
> Look ma! No imports</code></pre>



<h3>Directly manipulating child components</h3>



<p>In React, we get top-level APIs to manipulate children with <a href="https://reactjs.org/docs/react-api.html%23reactchildren"><code>React.Children</code></a>. We can use these to pass new props to child components that change their order or determine their visibility. MDX provides us a special wrapper component to access the child components passed in by MDX.</p>



<p>To add a wrapper, we can use the <code>MDXProvider</code> as we did before:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import React from "react";
import { MDXProvider } from "@mdx-js/react";
const components = {
  wrapper: ({ children, ...props }) => {
    const reversedChildren = React.Children.toArray(children).reverse();
    return &lt;>{reversedChildren}&lt;/>;
  },
};
export default (props) => (
  &lt;MDXProvider components={components}>
    &lt;main {...props} />
  &lt;/MDXProvider>
);</code></pre>



<p>This example reverses the children so that they appear in reverse order that we wrote it in. </p>



<p>We can even go wild and animate all of MDX children as they come in:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import React from "react";
import { MDXProvider } from "@mdx-js/react";
import { useTrail, animated, config } from "react-spring";
 
const components = {
  wrapper: ({ children, ...props }) => {
    const childrenArray = React.Children.toArray(children);
    const trail = useTrail(childrenArray.length, {
      xy: [0, 0],
      opacity: 1,
      from: { xy: [30, 50], opacity: 0 },
      config: config.gentle,
      delay: 200,
    });
    return (
      &lt;section>
        {trail.map(({ y, opacity }, index) => (
          &lt;animated.div
            key={index}
            style={{
              opacity,
              transform: xy.interpolate((x, y) => `translate3d(${x}px,${y}px,0)`),
            }}
          >
            {childrenArray[index]}
          &lt;/animated.div>
        ))}
      &lt;/section>
    );
  },
};
 
export default (props) => (
  &lt;MDXProvider components={components}>
    &lt;main {...props} />
  &lt;/MDXProvider>
);</code></pre>



<figure class="wp-block-video ticss-de6c81a9"><video controls src="https://css-tricks.com/wp-content/uploads/2020/04/Screen-Recording-2020-04-10-at-2.00.18-AM.mp4"></video></figure>



<h3>Wrapping up</h3>



<p>MDX is designed with flexibility out of the box, but extending with a plugin can make it do even more. Here’s what we were just able to do in a short amount of time, thanks to <a href="https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-plugin-mdx"><code>gatsby-plugin-mdx</code></a>:</p>



<ol><li>Create default Layout components that help format the MDX output.</li><li>Replace default HTML elements rendered from Markdown with custom components</li><li>Use shortcodes to get rid of us of importing components in every file.</li><li>Manipulate children directly to change the MDX output.</li></ol>



<p>Again, this is just another drop in the bucket as far as what MDX does to help make writing content for static sites easier.</p>



<h4>More on MDX</h4>



<ul><li><a href="https://css-tricks.com/an-introduction-to-mdxjs/">An Introduction to MDX</a></li><li><a href="https://css-tricks.com/front-end-documentation-style-guides-and-the-rise-of-mdx/">Front-End Documentation, Style Guides and the Rise of MDX</a></li></ul>
<p>The post <a rel="nofollow" href="https://css-tricks.com/working-with-mdx-custom-elements-and-shortcodes/">Working With MDX Custom Elements and Shortcodes</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://css-tricks.com/working-with-mdx-custom-elements-and-shortcodes/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		<enclosure url="https://css-tricks.com/wp-content/uploads/2020/04/Screen-Recording-2020-04-10-at-2.00.18-AM.mp4" length="182388" type="video/mp4" />

		<post-id xmlns="com-wordpress:feed-additions:1">307780</post-id>	</item>
		<item>
		<title>The Anatomy of a Tablist Component in Vanilla JavaScript Versus React</title>
		<link>https://css-tricks.com/the-anatomy-of-a-tablist-component-in-vanilla-javascript-versus-react/</link>
					<comments>https://css-tricks.com/the-anatomy-of-a-tablist-component-in-vanilla-javascript-versus-react/#comments</comments>
		
		<dc:creator><![CDATA[Nathan Smith]]></dc:creator>
		<pubDate>Tue, 05 May 2020 15:00:00 +0000</pubDate>
				<category><![CDATA[Article]]></category>
		<category><![CDATA[accessibility]]></category>
		<category><![CDATA[accordion]]></category>
		<category><![CDATA[JavaScript]]></category>
		<category><![CDATA[react]]></category>
		<category><![CDATA[tabs]]></category>
		<guid isPermaLink="false">https://css-tricks.com/?p=307347</guid>

					<description><![CDATA[<p>If you follow the undercurrent of the JavaScript community, there seems to be a divide as of late. It goes back over a decade. Really, this sort of strife has always been. Perhaps it is human nature.</p>
<p>Whenever a popular framework gains traction, you inevitably see people comparing it to rivals. I suppose that is to be expected. Everyone has a particular favorite.</p>
<p>Lately, the framework everyone loves (to hate?) is <a href="https://reactjs.org/">React</a>. You often see it pitted against others &#8230; <a href="https://css-tricks.com/the-anatomy-of-a-tablist-component-in-vanilla-javascript-versus-react/" class="read-more">Read article <span class="screen-reader-text"> &#8220;The Anatomy of a Tablist Component in Vanilla JavaScript Versus React&#8221;</span></a></p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/the-anatomy-of-a-tablist-component-in-vanilla-javascript-versus-react/">The Anatomy of a Tablist Component in Vanilla JavaScript Versus React</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></description>
										<content:encoded><![CDATA[
<p>If you follow the undercurrent of the JavaScript community, there seems to be a divide as of late. It goes back over a decade. Really, this sort of strife has always been. Perhaps it is human nature.</p>



<p>Whenever a popular framework gains traction, you inevitably see people comparing it to rivals. I suppose that is to be expected. Everyone has a particular favorite.</p>



<p>Lately, the framework everyone loves (to hate?) is <a href="https://reactjs.org/">React</a>. You often see it pitted against others in head-to-head blog posts and feature comparison matrices of enterprise whitepapers. Yet a few years ago, it seemed like jQuery would forever be king of the hill.</p>



<p>Frameworks come and go. To me, what is more interesting is when React — or any JS framework for that matter — gets pitted against the programming language itself. Because of course, under the hood, it is all built atop JS.</p>



<span id="more-307347"></span>



<p>The two are not inherently at odds. I would even go so far as to say that if you do not have a good handle on JS fundamentals, you probably are not going to reap the full benefits of using React. It can still be helpful, similar to using a jQuery plugin without understanding its internals. But I feel like React presupposes more JS familiarity.</p>



<p>HTML is equally important. There exists a fair bit of <a href="https://en.wikipedia.org/wiki/Fear,_uncertainty,_and_doubt">FUD</a> around how React affects accessibility. I think this narrative is inaccurate. In fact, the <a href="https://www.npmjs.com/package/eslint-plugin-jsx-a11y">ESLint JSX a11y plugin</a> will warn of possible accessibility violations in the <code>console</code>.</p>



<figure class="wp-block-image size-large"><a href="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/eslint-jsx-a11y-plugin.png?ssl=1"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/eslint-jsx-a11y-plugin.png?fit=1024%2C340&amp;ssl=1" alt="Console warnings from eslint-jsx-a11y-plugin" class="wp-image-307465" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/eslint-jsx-a11y-plugin.png?w=1280&amp;ssl=1 1280w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/eslint-jsx-a11y-plugin.png?resize=300%2C100&amp;ssl=1 300w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/eslint-jsx-a11y-plugin.png?resize=1024%2C340&amp;ssl=1 1024w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/eslint-jsx-a11y-plugin.png?resize=768%2C255&amp;ssl=1 768w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/eslint-jsx-a11y-plugin.png?resize=1000%2C332&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></a><figcaption><a href="https://en.wikipedia.org/wiki/ESLint">ESLint</a> warnings about empty <code>&lt;a&gt;</code> tags</figcaption></figure>



<p>Recently, an <a href="https://webaim.org/projects/million/">annual study of the top 1 million sites</a> was released. It shows that for sites using JS frameworks, there is an increased likelihood of accessibility problems. This is correlation, not causation.</p>



<blockquote class="wp-block-quote"><p>This does not necessarily mean that the frameworks caused these errors, but it does indicate that home pages with these frameworks had more errors than on average.</p></blockquote>



<p>In a manner of speaking, React&#8217;s magic incantations work regardless of whether you recognize the words. Ultimately, you are still responsible for the outcome.</p>



<p>Philosophical musings aside, I am a firm believer in choosing the best tool for the job. Sometimes, that means building a single page app with a <a href="https://jamstack.org/">Jamstack</a> approach. Or maybe a particular project is better suited to offloading HTML rendering to the server, where it has historically been handled.</p>



<p>Either way, there inevitably comes the need for JS to augment the user experience. At <a href="https://reaktivstudios.com/">Reaktiv Studios</a>, to that end I have been attempting to keep most of our React components in sync with our &#8220;flat HTML&#8221; approach. I have been writing commonly used functionality in vanilla JS as well. This keeps our options open, so that our clients are free to choose. It also allows us to reuse the same CSS.</p>



<p>If I may, I would like to share how I built our <code>&lt;Tabs&gt;</code> and <code>&lt;Accordion&gt;</code> React components. I will also demonstrate how I wrote the same functionality without using a framework.</p>



<p>Hopefully, this lesson will feel like we are making a layered cake. Let us first start with the base markup, then cover the vanilla JS, and finish with how it works in React.</p>



<div class="wp-block-group article-series"><div class="wp-block-group__inner-container">
<h4>Table of contents</h4>



<ol><li><a href="#article-header-id-0">Flat HTML examples</a></li><li><a href="#article-header-id-1">Vanilla JavaScript examples</a></li><li><a href="#article-header-id-2">React examples</a></li><li><a href="#article-header-id-3">Conclusion</a></li></ol>
</div></div>



<p>For reference, you can tinker with our live examples:</p>



<ul><li><a href="https://ui.reaktivstudios.com/storybook/?path=/story/accordion--default">Live demo of Accordion</a></li><li><a href="https://ui.reaktivstudios.com/storybook/?path=/story/tabs--example">Live demo of Tabs</a></li></ul>



<figure class="wp-block-image size-large"><a href="https://ui.reaktivstudios.com/storybook/?path=/story/accordion--default"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/05/reaktiv-studios-storybook.png?fit=1024%2C566&amp;ssl=1" alt="" class="wp-image-309040" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/05/reaktiv-studios-storybook.png?w=1280&amp;ssl=1 1280w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/05/reaktiv-studios-storybook.png?resize=300%2C166&amp;ssl=1 300w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/05/reaktiv-studios-storybook.png?resize=1024%2C566&amp;ssl=1 1024w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/05/reaktiv-studios-storybook.png?resize=768%2C425&amp;ssl=1 768w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/05/reaktiv-studios-storybook.png?resize=1000%2C553&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></a><figcaption><a href="https://reaktivstudios.com/">Reaktiv Studios</a> UI components</figcaption></figure>



<hr class="wp-block-separator"/>



<h3>Flat HTML examples</h3>



<p>Since we need JavaScript to make interactive widgets either way, I figured the easiest approach — from a server side implementation standpoint — would be to require only the bare minimum HTML. The rest can be augmented with JS.</p>



<p>The following are examples of markup for <strong>tabs</strong> and <strong>accordion</strong> components, showing a before/after comparison of how JS affects the DOM.</p>



<p class="explanation">I have added <code>id="TABS_ID"</code> and <code>id="ACCORDION_ID"</code> for demonstrative purposes. This is to make it more obvious what is happening. But the JS that I will be explaining automatically generates unique IDs if nothing is supplied in the HTML. It would work fine either way, with or without an <code>id</code> specified.</p>



<h4 class="ek-link">Tabs (without ARIA)</h4>



<pre rel="HTML" class="wp-block-csstricks-code-block language-markup" data-line=""><code markup="tt">&lt;div class="tabs" id="TABS_ID">
  &lt;ul class="tabs__list">
    &lt;li class="tabs__item">
      Tab 1
    &lt;/li>
    &lt;!-- .tabs__item -->

    &lt;li class="tabs__item">
      Tab 2
    &lt;/li>
    &lt;!-- .tabs__item -->
  &lt;/ul>
  &lt;!-- .tabs__list -->

  &lt;div class="tabs__panel">
    &lt;p>
      Tab 1 content
    &lt;/p>
  &lt;/div>
  &lt;!-- .tabs__panel -->

  &lt;div class="tabs__panel">
    &lt;p>
      Tab 2 content
    &lt;/p>
  &lt;/div>
  &lt;!-- .tabs__panel -->
&lt;/div>
&lt;!-- .tabs --></code></pre>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#tabs-with-aria"></a>Tabs (with ARIA)</h4>



<pre rel="HTML" class="wp-block-csstricks-code-block language-markup" data-line=""><code markup="tt">&lt;div class="tabs" id="TABS_ID">
  &lt;ul class="tabs__list" role="tablist">
    &lt;li
      aria-controls="tabpanel_TABS_ID_0"
      aria-selected="false"
      class="tabs__item"
      id="tab_TABS_ID_0"
      role="tab"
      tabindex="0"
    >
      Tab 1
    &lt;/li>
    &lt;!-- .tabs__item -->

    &lt;li
      aria-controls="tabpanel_TABS_ID_1"
      aria-selected="true"
      class="tabs__item"
      id="tab_TABS_ID_1"
      role="tab"
      tabindex="0"
    >
      Tab 2
    &lt;/li>
    &lt;!-- .tabs__item -->
  &lt;/ul>
  &lt;!-- .tabs__list -->

  &lt;div
    aria-hidden="true"
    aria-labelledby="tab_TABS_ID_0"
    class="tabs__panel"
    id="tabpanel_TABS_ID_0"
    role="tabpanel"
  >
    &lt;p>
      Tab 1 content
    &lt;/p>
  &lt;/div>
  &lt;!-- .tabs__panel -->

  &lt;div
    aria-hidden="false"
    aria-labelledby="tab_TABS_ID_1"
    class="tabs__panel"
    id="tabpanel_TABS_ID_1"
    role="tabpanel"
  >
    &lt;p>
      Tab 2 content
    &lt;/p>
  &lt;/div>
  &lt;!-- .tabs__panel -->
&lt;/div>
&lt;!-- .tabs --></code></pre>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#accordion-without-aria"></a>Accordion (without ARIA)</h4>



<pre rel="HTML" class="wp-block-csstricks-code-block language-markup" data-line=""><code markup="tt">&lt;div class="accordion" id="ACCORDION_ID">
  &lt;div class="accordion__item">
    Tab 1
  &lt;/div>
  &lt;!-- .accordion__item -->

  &lt;div class="accordion__panel">
    &lt;p>
      Tab 1 content
    &lt;/p>
  &lt;/div>
  &lt;!-- .accordion__panel -->

  &lt;div class="accordion__item">
    Tab 2
  &lt;/div>
  &lt;!-- .accordion__item -->

  &lt;div class="accordion__panel">
    &lt;p>
      Tab 2 content
    &lt;/p>
  &lt;/div>
  &lt;!-- .accordion__panel -->
&lt;/div>
&lt;!-- .accordion --></code></pre>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#accordion-with-aria"></a>Accordion (with ARIA)</h4>



<pre rel="HTML" class="wp-block-csstricks-code-block language-markup" data-line=""><code markup="tt">&lt;div
  aria-multiselectable="true"
  class="accordion"
  id="ACCORDION_ID"
  role="tablist"
>
  &lt;div
    aria-controls="tabpanel_ACCORDION_ID_0"
    aria-selected="true"
    class="accordion__item"
    id="tab_ACCORDION_ID_0"
    role="tab"
    tabindex="0"
  >
    &lt;i aria-hidden="true" class="accordion__item__icon">&lt;/i>
    Tab 1
  &lt;/div>
  &lt;!-- .accordion__item -->

  &lt;div
    aria-hidden="false"
    aria-labelledby="tab_ACCORDION_ID_0"
    class="accordion__panel"
    id="tabpanel_ACCORDION_ID_0"
    role="tabpanel"
  >
    &lt;p>
      Tab 1 content
    &lt;/p>
  &lt;/div>
  &lt;!-- .accordion__panel -->

  &lt;div
    aria-controls="tabpanel_ACCORDION_ID_1"
    aria-selected="false"
    class="accordion__item"
    id="tab_ACCORDION_ID_1"
    role="tab"
    tabindex="0"
  >
    &lt;i aria-hidden="true" class="accordion__item__icon">&lt;/i>
    Tab 2
  &lt;/div>
  &lt;!-- .accordion__item -->

  &lt;div
    aria-hidden="true"
    aria-labelledby="tab_ACCORDION_ID_1"
    class="accordion__panel"
    id="tabpanel_ACCORDION_ID_1"
    role="tabpanel"
  >
    &lt;p>
      Tab 2 content
    &lt;/p>
  &lt;/div>
  &lt;!-- .accordion__panel -->
&lt;/div>
&lt;!-- .accordion --></code></pre>



<hr class="wp-block-separator"/>



<h3>Vanilla JavaScript examples</h3>



<p>Okay. Now that we have seen the aforementioned HTML examples, let us walk through how we get from <em>before</em> to <em>after</em>.</p>



<p>First, I want to cover a few helper functions. These will make more sense in a bit. I figure it is best to get them documented first, so we can stay focused on the rest of the code once we dive in further.</p>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#file-getdomfallbackjs"></a>File: <code>getDomFallback.js</code></h4>



<p>This function provides common DOM properties and methods as <a href="https://en.wikipedia.org/wiki/NOP_(code)">no-op</a>, rather than having to make lots of <code>typeof foo.getAttribute</code> checks and whatnot. We could forego those types of confirmations altogether.</p>



<p>Since live HTML changes can be a potentially volatile environment, I always feel a bit safer making sure my JS is not bombing out and taking the rest of the page with it. Here is what that function looks like. It simply returns an object with the DOM equivalents of falsy results.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">/*
  Helper to mock DOM methods, for
  when an element might not exist.
*/
const getDomFallback = () => {
  return {
    // Props.
    children: [],
    className: '',
    classList: {
      contains: () => false,
    },
    id: '',
    innerHTML: '',
    name: '',
    nextSibling: null,
    previousSibling: null,
    outerHTML: '',
    tagName: '',
    textContent: '',

    // Methods.
    appendChild: () => Object.create(null),
    blur: () => undefined,
    click: () => undefined,
    cloneNode: () => Object.create(null),
    closest: () => null,
    createElement: () => Object.create(null),
    focus: () => undefined,
    getAttribute: () => null,
    hasAttribute: () => false,
    insertAdjacentElement: () => Object.create(null),
    insertBefore: () => Object.create(null),
    querySelector: () => null,
    querySelectorAll: () => [],
    removeAttribute: () => undefined,
    removeChild: () => Object.create(null),
    replaceChild: () => Object.create(null),
    setAttribute: () => undefined,
  };
};

// Export.
export { getDomFallback };</code></pre>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#file-uniquejs"></a>File: <code>unique.js</code></h4>



<p>This function is a poor man&#8217;s <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a> equivalent.</p>



<p>It generates a unique string that can be used to associate DOM elements with one another. It is handy, because then the author of an HTML page does not have to ensure that every <strong>tabs</strong> and <strong>accordion</strong> component have unique IDs. In the previous HTML examples, this is where <code>TABS_ID</code> and <code>ACCORDION_ID</code> would typically contain the randomly generated numeric strings instead.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">// ==========
// Constants.
// ==========

const BEFORE = '0.';
const AFTER = '';

// ==================
// Get unique string.
// ==================

const unique = () => {
  // Get prefix.
  let prefix = Math.random();
  prefix = String(prefix);
  prefix = prefix.replace(BEFORE, AFTER);

  // Get suffix.
  let suffix = Math.random();
  suffix = String(suffix);
  suffix = suffix.replace(BEFORE, AFTER);

  // Expose string.
  return `${prefix}_${suffix}`;
};

// Export.
export { unique };</code></pre>



<p>On larger JavaScript projects, I would typically use <a href="https://www.npmjs.com/package/uuid"><code>npm install uuid</code></a>. But since we are keeping this simple and do not require cryptographic parity, concatenating two lightly edited <code>Math.random()</code> numbers will suffice for our <code>string</code> uniqueness needs.</p>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#file-tablistjs"></a>File: <code>tablist.js</code></h4>



<p>This file does the bulk of the work. What is cool about it, if I do say so myself, is that there are enough similarities between a <strong>tabs</strong> component and an <strong>accordion</strong> that we can handle both with the same <code>*.js</code> file. Go ahead and scroll through the entirety, and then we will break down what each function does individually.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">// Helpers.
import { getDomFallback } from './getDomFallback';
import { unique } from './unique';

// ==========
// Constants.
// ==========

// Boolean strings.
const TRUE = 'true';
const FALSE = 'false';

// ARIA strings.
const ARIA_CONTROLS = 'aria-controls';
const ARIA_LABELLEDBY = 'aria-labelledby';
const ARIA_HIDDEN = 'aria-hidden';
const ARIA_MULTISELECTABLE = 'aria-multiselectable';
const ARIA_ORIENTATION = 'aria-orientation';
const ARIA_SELECTED = 'aria-selected';

// Attribute strings.
const DATA_INDEX = 'data-index';
const HORIZONTAL = 'horizontal';
const ID = 'id';
const ROLE = 'role';
const TABINDEX = 'tabindex';
const TABLIST = 'tablist';
const VERTICAL = 'vertical';

// Event strings.
const AFTER_BEGIN = 'afterbegin';
const ARROW_LEFT = 'arrowleft';
const ARROW_RIGHT = 'arrowright';
const CLICK = 'click';
const KEYDOWN = 'keydown';

// Key strings.
const ENTER = 'enter';
const FUNCTION = 'function';
const SPACE = ' ';

// Tag strings.
const I = 'i';
const LI = 'li';

// Selector strings.
const ACCORDION_ITEM_ICON = 'accordion__item__icon';
const ACCORDION_ITEM_ICON_SELECTOR = `.${ACCORDION_ITEM_ICON}`;

const TAB = 'tab';
const TAB_SELECTOR = `[${ROLE}=${TAB}]`;

const TABPANEL = 'tabpanel';
const TABPANEL_SELECTOR = `[${ROLE}=${TABPANEL}]`;

const ACCORDION = 'accordion';
const TABLIST_CLASS_SELECTOR = '.accordion, .tabs';
const TAB_CLASS_SELECTOR = '.accordion__item, .tabs__item';
const TABPANEL_CLASS_SELECTOR = '.accordion__panel, .tabs__panel';

// ===========
// Get tab ID.
// ===========

const getTabId = (id = '', index = 0) => {
  return `${TAB}_${id}_${index}`;
};

// =============
// Get panel ID.
// =============

const getPanelId = (id = '', index = 0) => {
  return `${TABPANEL}_${id}_${index}`;
};

// ==============
// Click handler.
// ==============

const globalClick = (event = {}) => {
  // Get target.
  const { target = getDomFallback() } = event;

  // Get key.
  let { key = '' } = event;
  key = key.toLowerCase();

  // Key events.
  const isArrowLeft = key === ARROW_LEFT;
  const isArrowRight = key === ARROW_RIGHT;
  const isArrowKey = isArrowLeft || isArrowRight;
  const isTriggerKey = key === ENTER || key === SPACE;

  // Get parent.
  const { parentNode = getDomFallback(), tagName = '' } = target;

  // Set later.
  let wrapper = getDomFallback();

  /*
    =====
    NOTE:
    =====

    We test for this, because the method does
    not exist on `document.documentElement`.
  */
  if (typeof target.closest === FUNCTION) {
    // Get wrapper.
    wrapper = target.closest(TABLIST_CLASS_SELECTOR) || getDomFallback();
  }

  // Is multi?
  const isMulti = wrapper.getAttribute(ARIA_MULTISELECTABLE) === TRUE;

  // Valid target?
  const isValidTarget =
    target.getAttribute(ROLE) === TAB &amp;&amp; parentNode.getAttribute(ROLE) === TABLIST;

  // Is `&lt;li>`?
  const isListItem = isValidTarget &amp;&amp; tagName.toLowerCase() === LI;

  // Valid event?
  const isArrowEvent = isListItem &amp;&amp; isArrowKey;
  const isTriggerEvent = isValidTarget &amp;&amp; (!key || isTriggerKey);
  const isValidEvent = isArrowEvent || isTriggerEvent;

  // Prevent default.
  if (isValidEvent) {
    event.preventDefault();
  }

  // ============
  // Arrow event?
  // ============

  if (isArrowEvent) {
    // Get index.
    let index = target.getAttribute(DATA_INDEX);
    index = parseFloat(index);

    // Get list.
    const list = wrapper.querySelectorAll(TAB_SELECTOR);

    // Set later.
    let newIndex = null;
    let nextItem = null;

    // Arrow left?
    if (isArrowLeft) {
      newIndex = index - 1;
      nextItem = list[newIndex];

      if (!nextItem) {
        newIndex = list.length - 1;
        nextItem = list[newIndex];
      }
    }

    // Arrow right?
    if (isArrowRight) {
      newIndex = index + 1;
      nextItem = list[newIndex];

      if (!nextItem) {
        newIndex = 0;
        nextItem = list[newIndex];
      }
    }

    // Fallback?
    nextItem = nextItem || getDomFallback();

    // Focus new item.
    nextItem.click();
    nextItem.focus();
  }

  // ==============
  // Trigger event?
  // ==============

  if (isTriggerEvent) {
    // Get panel.
    const panelId = target.getAttribute(ARIA_CONTROLS);
    const panel = wrapper.querySelector(`#${panelId}`) || getDomFallback();

    // Get booleans.
    let boolPanel = panel.getAttribute(ARIA_HIDDEN) !== TRUE;
    let boolTab = target.getAttribute(ARIA_SELECTED) !== TRUE;

    // List item?
    if (isListItem) {
      boolPanel = FALSE;
      boolTab = TRUE;
    }

    // [aria-multiselectable="false"]
    if (!isMulti) {
      // Get tabs &amp; panels.
      const childTabs = wrapper.querySelectorAll(TAB_SELECTOR);
      const childPanels = wrapper.querySelectorAll(TABPANEL_SELECTOR);

      // Loop through tabs.
      childTabs.forEach((tab = getDomFallback()) => {
        tab.setAttribute(ARIA_SELECTED, FALSE);

        // li[tabindex="-1"]
        if (isListItem) {
          tab.setAttribute(TABINDEX, -1);
        }
      });

      // Loop through panels.
      childPanels.forEach((panel = getDomFallback()) => {
        panel.setAttribute(ARIA_HIDDEN, TRUE);
      });
    }

    // Set individual tab.
    target.setAttribute(ARIA_SELECTED, boolTab);

    // li[tabindex="0"]
    if (isListItem) {
      target.setAttribute(TABINDEX, 0);
    }

    // Set individual panel.
    panel.setAttribute(ARIA_HIDDEN, boolPanel);
  }
};

// ====================
// Add ARIA attributes.
// ====================

const addAriaAttributes = () => {
  // Get elements.
  const allWrappers = document.querySelectorAll(TABLIST_CLASS_SELECTOR);

  // Loop through.
  allWrappers.forEach((wrapper = getDomFallback()) => {
    // Get attributes.
    const { id = '', classList } = wrapper;
    const parentId = id || unique();

    // Is accordion?
    const isAccordion = classList.contains(ACCORDION);

    // Get tabs &amp; panels.
    const childTabs = wrapper.querySelectorAll(TAB_CLASS_SELECTOR);
    const childPanels = wrapper.querySelectorAll(TABPANEL_CLASS_SELECTOR);

    // Add ID?
    if (!wrapper.getAttribute(ID)) {
      wrapper.setAttribute(ID, parentId);
    }

    // [aria-multiselectable="true"]
    if (isAccordion &amp;&amp; wrapper.getAttribute(ARIA_MULTISELECTABLE) !== FALSE) {
      wrapper.setAttribute(ARIA_MULTISELECTABLE, TRUE);
    }

    // ===========================
    // Loop through tabs &amp; panels.
    // ===========================

    for (let index = 0; index &lt; childTabs.length; index++) {
      // Get elements.
      const tab = childTabs[index] || getDomFallback();
      const panel = childPanels[index] || getDomFallback();

      // Get IDs.
      const tabId = getTabId(parentId, index);
      const panelId = getPanelId(parentId, index);

      // ===================
      // Add tab attributes.
      // ===================

      // Tab: add icon?
      if (isAccordion) {
        // Get icon.
        let icon = tab.querySelector(ACCORDION_ITEM_ICON_SELECTOR);

        // Create icon?
        if (!icon) {
          icon = document.createElement(I);
          icon.className = ACCORDION_ITEM_ICON;
          tab.insertAdjacentElement(AFTER_BEGIN, icon);
        }

        // [aria-hidden="true"]
        icon.setAttribute(ARIA_HIDDEN, TRUE);
      }

      // Tab: add id?
      if (!tab.getAttribute(ID)) {
        tab.setAttribute(ID, tabId);
      }

      // Tab: add controls?
      if (!tab.getAttribute(ARIA_CONTROLS)) {
        tab.setAttribute(ARIA_CONTROLS, panelId);
      }

      // Tab: add selected?
      if (!tab.getAttribute(ARIA_SELECTED)) {
        const bool = !isAccordion &amp;&amp; index === 0;

        tab.setAttribute(ARIA_SELECTED, bool);
      }

      // Tab: add role?
      if (tab.getAttribute(ROLE) !== TAB) {
        tab.setAttribute(ROLE, TAB);
      }

      // Tab: add data index?
      if (!tab.getAttribute(DATA_INDEX)) {
        tab.setAttribute(DATA_INDEX, index);
      }

      // Tab: add tabindex?
      if (!tab.getAttribute(TABINDEX)) {
        if (isAccordion) {
          tab.setAttribute(TABINDEX, 0);
        } else {
          tab.setAttribute(TABINDEX, index === 0 ? 0 : -1);
        }
      }

      // Tab: first item?
      if (index === 0) {
        // Get parent.
        const { parentNode = getDomFallback() } = tab;

        /*
          We do this here, instead of outside the loop.

          The top level item isn't always the `tablist`.

          The accordion UI only has `&lt;div>`, whereas
          the tabs UI has both `&lt;div>` and `&lt;ul>`.
        */
        if (parentNode.getAttribute(ROLE) !== TABLIST) {
          parentNode.setAttribute(ROLE, TABLIST);
        }

        // Accordion?
        if (isAccordion) {
          // [aria-orientation="vertical"]
          if (parentNode.getAttribute(ARIA_ORIENTATION) !== VERTICAL) {
            parentNode.setAttribute(ARIA_ORIENTATION, VERTICAL);
          }

          // Tabs?
        } else {
          // [aria-orientation="horizontal"]
          if (parentNode.getAttribute(ARIA_ORIENTATION) !== HORIZONTAL) {
            parentNode.setAttribute(ARIA_ORIENTATION, HORIZONTAL);
          }
        }
      }

      // =====================
      // Add panel attributes.
      // =====================

      // Panel: add ID?
      if (!panel.getAttribute(ID)) {
        panel.setAttribute(ID, panelId);
      }

      // Panel: add hidden?
      if (!panel.getAttribute(ARIA_HIDDEN)) {
        const bool = isAccordion || index !== 0;

        panel.setAttribute(ARIA_HIDDEN, bool);
      }

      // Panel: add labelled?
      if (!panel.getAttribute(ARIA_LABELLEDBY)) {
        panel.setAttribute(ARIA_LABELLEDBY, tabId);
      }

      // Panel: add role?
      if (panel.getAttribute(ROLE) !== TABPANEL) {
        panel.setAttribute(ROLE, TABPANEL);
      }

      // Panel: add tabindex?
      if (!panel.getAttribute(TABINDEX)) {
        panel.setAttribute(TABINDEX, 0);
      }
    }
  });
};

// =====================
// Remove global events.
// =====================

const unbind = () => {
  document.removeEventListener(CLICK, globalClick);
  document.removeEventListener(KEYDOWN, globalClick);
};

// ==================
// Add global events.
// ==================

const init = () => {
  // Add attributes.
  addAriaAttributes();

  // Prevent doubles.
  unbind();

  document.addEventListener(CLICK, globalClick);
  document.addEventListener(KEYDOWN, globalClick);
};

// ==============
// Bundle object.
// ==============

const tablist = {
  init,
  unbind,
};

// =======
// Export.
// =======

export { tablist };</code></pre>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#function-gettabid-and-getpanelid"></a>Function: <code>getTabId</code> and <code>getPanelId</code></h4>



<p>These two functions are used to create individually unique IDs for elements in a loop, based on an existing (or generated) parent ID. This is helpful to ensure matching values for attributes like <code>aria-controls="…"</code> and <code>aria-labelledby="…"</code>. Think of those as the accessibility equivalents of <code>&lt;label for="…"&gt;</code>, telling the browser which elements are related to one another.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const getTabId = (id = '', index = 0) => {
  return `${TAB}_${id}_${index}`;
};</code></pre>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const getPanelId = (id = '', index = 0) => {
  return `${TABPANEL}_${id}_${index}`;
};</code></pre>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#function-globalclick"></a>Function: <code>globalClick</code></h4>



<p>This is a click handler that is applied at the <code>document</code> level. That means we are not having to manually add click handlers to a number of elements. Instead, we use <a href="https://www.sitepoint.com/event-bubbling-javascript/">event bubbling</a> to listen for clicks further down in the document, and allow them to propagate up to the top.</p>



<p>Conveniently, this is also how we can handle keyboard events such as the <code>ArrowLeft</code>, <code>ArrowRight</code>, <code>Enter</code> (or spacebar) keys being pressed. These are necessary to have an accessible UI.</p>



<p>In the first part of the function, we destructure <code>target</code> and <code>key</code> from the incoming <code>event</code>. Next, we destructure the <code>parentNode</code> and <code>tagName</code> from the <code>target</code>.</p>



<p>Then, we attempt to get the wrapper element. This would be the one with either <code>class="tabs"</code> or <code>class="accordion"</code>. Because we might actually be clicking on the ancestor element highest in the DOM tree — which exists but possibly does not have the <code>*.closest(…)</code> method — we do a <code>typeof</code> check. If that function exists, we attempt to get the element. Even still, we might come up without a match. So we have one more <code>getDomFallback</code> to be safe.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">// Get target.
const { target = getDomFallback() } = event;

// Get key.
let { key = '' } = event;
key = key.toLowerCase();

// Key events.
const isArrowLeft = key === ARROW_LEFT;
const isArrowRight = key === ARROW_RIGHT;
const isArrowKey = isArrowLeft || isArrowRight;
const isTriggerKey = key === ENTER || key === SPACE;

// Get parent.
const { parentNode = getDomFallback(), tagName = '' } = target;

// Set later.
let wrapper = getDomFallback();

/*
  =====
  NOTE:
  =====

  We test for this, because the method does
  not exist on `document.documentElement`.
*/
if (typeof target.closest === FUNCTION) {
  // Get wrapper.
  wrapper = target.closest(TABLIST_CLASS_SELECTOR) || getDomFallback();
}</code></pre>



<p>Then, we store a boolean about whether the wrapper element has <code>aria-multiselectable="true"</code>. I will get back to that. Likewise, we store whether or not the tag that was clicked is a <code>&lt;li></code>. We need this info later on.</p>



<p>We also determine if the click happened on a relevant <code>target</code>. Remember, we are using event bubbling so really the user could have clicked anything. We also interrogate the event a bit, to determine if it was triggered by the user pressing a key. If so, then we determine if the key is relevant.</p>



<p>We want to make sure it:</p>



<ul><li>Has <code>role="tab"</code></li><li>Has a parent element with <code>role="tablist"</code></li></ul>



<p>Then we bundle up our other booleans into two categories, <code>isArrowEvent</code> and <code>isTriggerEvent</code>. Which in turn are further combined into <code>isValidEvent</code>.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">// Is multi?
const isMulti = wrapper.getAttribute(ARIA_MULTISELECTABLE) === TRUE;

// Valid target?
const isValidTarget =
  target.getAttribute(ROLE) === TAB &amp;&amp; parentNode.getAttribute(ROLE) === TABLIST;

// Is `&lt;li>`?
const isListItem = isValidTarget &amp;&amp; tagName.toLowerCase() === LI;

// Valid event?
const isArrowEvent = isListItem &amp;&amp; isArrowKey;
const isTriggerEvent = isValidTarget &amp;&amp; (!key || isTriggerKey);
const isValidEvent = isArrowEvent || isTriggerEvent;

// Prevent default.
if (isValidEvent) {
  event.preventDefault();
}</code></pre>



<p>We then enter an <code>if</code> conditional that checks if either the left or right arrow keys were pressed. If so, then we want to change the focus to the corresponding adjacent tab. If we are already at the beginning of our list, we will jump to the end. Or if we area already at the end, we will jump to the beginning.</p>



<p>By triggering the <code>click</code> event, that causes this same function to be executed again. It is then evaluated as being a trigger event. This is covered in the next block.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">if (isArrowEvent) {
  // Get index.
  let index = target.getAttribute(DATA_INDEX);
  index = parseFloat(index);

  // Get list.
  const list = wrapper.querySelectorAll(TAB_SELECTOR);

  // Set later.
  let newIndex = null;
  let nextItem = null;

  // Arrow left?
  if (isArrowLeft) {
    newIndex = index - 1;
    nextItem = list[newIndex];

    if (!nextItem) {
      newIndex = list.length - 1;
      nextItem = list[newIndex];
    }
  }

  // Arrow right?
  if (isArrowRight) {
    newIndex = index + 1;
    nextItem = list[newIndex];

    if (!nextItem) {
      newIndex = 0;
      nextItem = list[newIndex];
    }
  }

  // Fallback?
  nextItem = nextItem || getDomFallback();

  // Focus new item.
  nextItem.click();
  nextItem.focus();
}</code></pre>



<p>Assuming the trigger <code>event</code> is indeed valid, we make it past our next <code>if</code> check. Now, we are concerned with getting the <code>role="tabpanel"</code> element with an <code>id</code> that matches our tab&#8217;s <code>aria-controls="…"</code>.</p>



<p>Once we have got it, we check whether the panel is hidden, and if the tab is selected. Basically, we first presuppose that we are dealing with an <strong>accordion</strong> and flip the booleans to their opposites.</p>



<p>This is also where our earlier <code>isListItem</code> boolean comes into play. If the user is clicking an <code>&lt;li&gt;</code> then we know we are dealing with <strong>tabs</strong>, not an <strong>accordion</strong>. In which case, we want to flag our panel as being visible (via <code>aria-hiddden="false"</code>) and our tab as being selected (via <code>aria-selected="true"</code>).</p>



<p>Also, we want to ensure that either the wrapper has <code>aria-multiselectable="false"</code> or is completely missing <code>aria-multiselectable</code>. If that is the case, then we loop through all neighboring <code>role="tab"</code> and all <code>role="tabpanel"</code> elements and set them to their inactive states. Finally, we arrive at setting the previously determined booleans for the individual tab and panel pairing.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">if (isTriggerEvent) {
  // Get panel.
  const panelId = target.getAttribute(ARIA_CONTROLS);
  const panel = wrapper.querySelector(`#${panelId}`) || getDomFallback();

  // Get booleans.
  let boolPanel = panel.getAttribute(ARIA_HIDDEN) !== TRUE;
  let boolTab = target.getAttribute(ARIA_SELECTED) !== TRUE;

  // List item?
  if (isListItem) {
    boolPanel = FALSE;
    boolTab = TRUE;
  }

  // [aria-multiselectable="false"]
  if (!isMulti) {
    // Get tabs &amp; panels.
    const childTabs = wrapper.querySelectorAll(TAB_SELECTOR);
    const childPanels = wrapper.querySelectorAll(TABPANEL_SELECTOR);

    // Loop through tabs.
    childTabs.forEach((tab = getDomFallback()) => {
      tab.setAttribute(ARIA_SELECTED, FALSE);

      // li[tabindex="-1"]
      if (isListItem) {
        tab.setAttribute(TABINDEX, -1);
      }
    });

    // Loop through panels.
    childPanels.forEach((panel = getDomFallback()) => {
      panel.setAttribute(ARIA_HIDDEN, TRUE);
    });
  }

  // Set individual tab.
  target.setAttribute(ARIA_SELECTED, boolTab);

  // li[tabindex="0"]
  if (isListItem) {
    target.setAttribute(TABINDEX, 0);
  }

  // Set individual panel.
  panel.setAttribute(ARIA_HIDDEN, boolPanel);
}</code></pre>



<hr class="wp-block-separator"/>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#function-addariaattributes"></a>Function: <code>addAriaAttributes</code></h4>



<p>The astute reader might be thinking:</p>



<blockquote class="wp-block-quote"><p>You said earlier that we start with the most bare possible markup, yet the <code>globalClick</code> function was looking for attributes that would not be there. Why would you lie!?</p></blockquote>



<p>Or perhaps not, for the astute reader would have also noticed the function named <code>addAriaAttributes</code>. Indeed, this function does exactly what it says on the tin. It breathes life into the base DOM structure, by adding all the requisite <code>aria-*</code> and <code>role</code> attributes.</p>



<p>This not only makes the UI inherently more accessible to assistive technologies, but it also ensures the functionality actually works. I prefer to build vanilla JS things this way, rather than pivoting on <code>class="…"</code> for interactivity, because it forces me to think about the entirety of the user experience, beyond what I can see visually.</p>



<p>First off, we get all elements on the page that have <code>class="tabs"</code> and/or <code>class="accordion"</code>. Then we check if we have something to work with. If not, then we would exit our function here. Assuming we do have a list, we loop through each of the wrapping elements and pass them into the scope of our function as <code>wrapper</code>.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">// Get elements.
const allWrappers = document.querySelectorAll(TABLIST_CLASS_SELECTOR);

// Loop through.
allWrappers.forEach((wrapper = getDomFallback()) => {
  /*
    NOTE: Cut, for brevity.
  */
});
</code></pre>



<p>Inside the scope of our looping function, we destructure <code>id</code> and <code>classList</code> from <code>wrapper</code>. If there is no ID, then we generate one via <code>unique()</code>. We set a boolean flag, to identify if we are working with an <strong>accordion</strong>. This is used later.</p>



<p>We also get decendants of <code>wrapper</code> that are tabs and panels, via their class name selectors.</p>



<p>Tabs:</p>



<ul><li><code>class="tabs__item"</code> or</li><li><code>class="accordion__item"</code></li></ul>



<p>Panels:</p>



<ul><li><code>class="tabs__panel"</code> or</li><li><code>class="accordion__panel"</code></li></ul>



<p>We then set the wrapper&#8217;s <code>id</code> if it does not already have one.</p>



<p>If we are dealing with an <strong>accordion</strong> that lacks <code>aria-multiselectable="false"</code>, we set its flag to <code>true</code>. Reason being, if developers are reaching for an accordion UI paradigm — and also have tabs available to them, which are inherently mutually exclusive — then the safer assumption is that the accordion should support expanding and collapsing of several panels.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">// Get attributes.
const { id = '', classList } = wrapper;
const parentId = id || unique();

// Is accordion?
const isAccordion = classList.contains(ACCORDION);

// Get tabs &amp; panels.
const childTabs = wrapper.querySelectorAll(TAB_CLASS_SELECTOR);
const childPanels = wrapper.querySelectorAll(TABPANEL_CLASS_SELECTOR);

// Add ID?
if (!wrapper.getAttribute(ID)) {
  wrapper.setAttribute(ID, parentId);
}

// [aria-multiselectable="true"]
if (isAccordion &amp;&amp; wrapper.getAttribute(ARIA_MULTISELECTABLE) !== FALSE) {
  wrapper.setAttribute(ARIA_MULTISELECTABLE, TRUE);
}</code></pre>



<p>Next, we loop through tabs. Wherein, we also handle our panels.</p>



<p>You may be wondering why this is an old school <code>for</code> loop, instead of a more modern <code>*.forEach</code>. The reason is that we want to loop through two <a href="https://developer.mozilla.org/en-US/docs/Web/API/NodeList"><code>NodeList</code></a> instances: tabs and panels. Assuming they each map 1-to-1 we know they both have the same <code>*.length</code>. This allows us to have one loop instead of two.</p>



<p>Let us peer inside of the loop. First, we get unique IDs for each tab and panel. These would look like one of the two following scenarios. These are used later on, to associate tabs with panels and vice versa.</p>



<ul><li><code>tab_WRAPPER_ID_0</code> or<br><code>tab_GENERATED_STRING_0</code></li><li><code>tabpanel_WRAPPER_ID_0</code> or<br><code>tabpanel_GENERATED_STRING_0</code></li></ul>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">for (let index = 0; index &lt; childTabs.length; index++) {
  // Get elements.
  const tab = childTabs[index] || getDomFallback();
  const panel = childPanels[index] || getDomFallback();

  // Get IDs.
  const tabId = getTabId(parentId, index);
  const panelId = getPanelId(parentId, index);

  /*
    NOTE: Cut, for brevity.
  */
}</code></pre>



<p>As we loop through, we first ensure that an expand/collapse icon exists. We create it if necessary, and set it to <code>aria-hidden="true"</code> since it is purely decorative.</p>



<p>Next, we check on attributes for the current tab. If an <code>id="…"</code> does not exist on the tab, we add it. Likewise, if <code>aria-controls="…"</code> does not exist we add that as well, pointing to our newly created <code>panelId</code>.</p>



<p>You will notice there is a little pivot here, checking if we do not have <code>aria-selected</code> and then further determining if we are <em>not</em> in the context of an accordion <em>and</em> if the <code>index</code> is <code>0</code>. In that case, we want to make our first tab look selected. The reason is that though an accordion can be fully collapsed, tabbed content cannot. There is always at least one panel visible.</p>



<p>Then we ensure that <code>role="tab"</code> exists. We store the current <code>index</code> of our loop as <code>data-index="…"</code> in case we need it later for keyboard navigation.</p>



<p>We also add the correct <code>tabindex="0"</code> or possibly <code>tabindex="-1"</code> depending on if what time of item it is. This allows all triggers of an <strong>accordion</strong> to receive keyboard <code>:focus</code>, versus just the currently active trigger in a <strong>tabs</strong> layout.</p>



<p>Lastly, we check if we are on the first iteration of our loop where <code>index</code> is <code>0</code>. If so, we go up one level to the <code>parentNode</code>. If that element does not have <code>role="tablist"</code>, then we add it.</p>



<p>We do this via <code>parentNode</code> instead of <code>wrapper</code> because in the context of tabs (not accordion) there is a <code>&lt;ul></code>element around the tab <code>&lt;li></code> that needs <code>role="tablist"</code>. In the case of an accordion, it would be the outermost <code>&lt;div></code> ancestor. This code accounts for both.</p>



<p>We also set the correct <code>aria-orientation</code>, depending on the UI type. Accordion is <code>vertical</code> and tabs are <code>horizontal</code>.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">// Tab: add icon?
if (isAccordion) {
  // Get icon.
  let icon = tab.querySelector(ACCORDION_ITEM_ICON_SELECTOR);

  // Create icon?
  if (!icon) {
    icon = document.createElement(I);
    icon.className = ACCORDION_ITEM_ICON;
    tab.insertAdjacentElement(AFTER_BEGIN, icon);
  }

  // [aria-hidden="true"]
  icon.setAttribute(ARIA_HIDDEN, TRUE);
}

// Tab: add id?
if (!tab.getAttribute(ID)) {
  tab.setAttribute(ID, tabId);
}

// Tab: add controls?
if (!tab.getAttribute(ARIA_CONTROLS)) {
  tab.setAttribute(ARIA_CONTROLS, panelId);
}

// Tab: add selected?
if (!tab.getAttribute(ARIA_SELECTED)) {
  const bool = !isAccordion &amp;&amp; index === 0;

  tab.setAttribute(ARIA_SELECTED, bool);
}

// Tab: add role?
if (tab.getAttribute(ROLE) !== TAB) {
  tab.setAttribute(ROLE, TAB);
}

// Tab: add data index?
if (!tab.getAttribute(DATA_INDEX)) {
  tab.setAttribute(DATA_INDEX, index);
}

// Tab: add tabindex?
if (!tab.getAttribute(TABINDEX)) {
  if (isAccordion) {
    tab.setAttribute(TABINDEX, 0);
  } else {
    tab.setAttribute(TABINDEX, index === 0 ? 0 : -1);
  }
}

// Tab: first item?
if (index === 0) {
  // Get parent.
  const { parentNode = getDomFallback() } = tab;

  /*
    We do this here, instead of outside the loop.

    The top level item isn't always the `tablist`.

    The accordion UI only has `&lt;div>`, whereas
    the tabs UI has both `&lt;div>` and `&lt;ul>`.
  */
  if (parentNode.getAttribute(ROLE) !== TABLIST) {
    parentNode.setAttribute(ROLE, TABLIST);
  }

  // Accordion?
  if (isAccordion) {
    // [aria-orientation="vertical"]
    if (parentNode.getAttribute(ARIA_ORIENTATION) !== VERTICAL) {
      parentNode.setAttribute(ARIA_ORIENTATION, VERTICAL);
    }

    // Tabs?
  } else {
    // [aria-orientation="horizontal"]
    if (parentNode.getAttribute(ARIA_ORIENTATION) !== HORIZONTAL) {
      parentNode.setAttribute(ARIA_ORIENTATION, HORIZONTAL);
    }
  }
}</code></pre>



<p>Continuing within the earlier <code>for</code> loop, we add attributes for each <code>panel</code>. We add an <code>id</code> if needed. We also set <code>aria-hidden</code> to either <code>true</code> or <code>false</code> depending on the context of being an accordion (or not).</p>



<p>Likewise, we ensure that our panel points back to its tab trigger via <code>aria-labelledby="…"</code>, and that <code>role="tabpanel"</code> has been set. We also give it <code>tabindex="0"</code> so it can receive <code>:focus</code>.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">// Panel: add ID?
if (!panel.getAttribute(ID)) {
  panel.setAttribute(ID, panelId);
}

// Panel: add hidden?
if (!panel.getAttribute(ARIA_HIDDEN)) {
  const bool = isAccordion || index !== 0;

  panel.setAttribute(ARIA_HIDDEN, bool);
}

// Panel: add labelled?
if (!panel.getAttribute(ARIA_LABELLEDBY)) {
  panel.setAttribute(ARIA_LABELLEDBY, tabId);
}

// Panel: add role?
if (panel.getAttribute(ROLE) !== TABPANEL) {
  panel.setAttribute(ROLE, TABPANEL);
}

// Panel: add tabindex?
if (!panel.getAttribute(TABINDEX)) {
  panel.setAttribute(TABINDEX, 0);
}</code></pre>



<p>At the very end of the file, we have a few setup and teardown functions. As a way to play nicely with other JS that might be in the page, we provide an <code>unbind</code> function that removes our global event listeners. It can be called by itself, via <code>tablist.unbind()</code> but is mostly there so that we can <code>unbind()</code> before (re-)binding. That way we prevent doubling up.</p>



<p>Inside our <code>init</code> function, we call <code>addAriaAttributes()</code> which modifies the DOM to be accessible. We then call <code>unbind()</code> and then add our event listeners to the <code>document</code>.</p>



<p>Finally, we bundle both methods into a parent object and export it under the name <code>tablist</code>. That way, when dropping it into a flat HTML page, we can call <code>tablist.init()</code> when we are ready to apply our functionality.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">// =====================
// Remove global events.
// =====================

const unbind = () => {
  document.removeEventListener(CLICK, globalClick);
  document.removeEventListener(KEYDOWN, globalClick);
};

// ==================
// Add global events.
// ==================

const init = () => {
  // Add attributes.
  addAriaAttributes();

  // Prevent doubles.
  unbind();

  document.addEventListener(CLICK, globalClick);
  document.addEventListener(KEYDOWN, globalClick);
};

// ==============
// Bundle object.
// ==============

const tablist = {
  init,
  unbind,
};

// =======
// Export.
// =======

export { tablist };</code></pre>



<hr class="wp-block-separator"/>



<h3>React examples</h3>



<p>There is a scene in <a href="https://www.rottentomatoes.com/m/batman_begins/quotes/"><em>Batman Begins</em></a> where Lucius Fox (played by Morgan Freeman) explains to a recovering Bruce Wayne (Christian Bale) the scientific steps he took to save his life after being poisoned.</p>



<p><strong>Lucius Fox:</strong> &#8220;I analyzed your blood, isolating the receptor compounds and the protein-based catalyst.&#8221;</p>



<p><strong>Bruce Wayne:</strong> &#8220;Am I meant to understand any of that?&#8221;</p>



<p><strong>Lucius Fox:</strong> &#8220;Not at all, I just wanted you to know how hard it was. Bottom line, I synthesized an antidote.&#8221;</p>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/lucious-fox-and-bruce-wayne.jpg?ssl=1" alt="Morgan Freeman and Christian Bale, sitting inside the Batmobile" class="wp-image-307515" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/lucious-fox-and-bruce-wayne.jpg?w=1000&amp;ssl=1 1000w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/lucious-fox-and-bruce-wayne.jpg?resize=300%2C200&amp;ssl=1 300w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/lucious-fox-and-bruce-wayne.jpg?resize=768%2C513&amp;ssl=1 768w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /><figcaption>&#8220;How do I configure <a href="https://en.wikipedia.org/wiki/Webpack">Webpack</a>?&#8221;</figcaption></figure>



<p>↑ When working with a framework, I think in those terms.</p>



<p>Now that we know &#8220;hard&#8221; it is — not really, but humor me — to do raw DOM manipulation and event binding, we can better appreciate the existence of an antidote. React abstracts a lot of that complexity away, and handles it for us automatically.</p>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#file-tabsjs"></a>File: <code>Tabs.js</code></h4>



<p>Now that we are diving into React examples, we will start with the <code>&lt;Tabs&gt;</code> component.</p>



<pre rel="HTML" class="wp-block-csstricks-code-block language-markup" data-line=""><code markup="tt">// =============
// Used like so…
// =============

&lt;Tabs>
  &lt;div label="Tab 1">
    &lt;p>
      Tab 1 content
    &lt;/p>
  &lt;/div>
  &lt;div label="Tab 2">
    &lt;p>
      Tab 2 content
    &lt;/p>
  &lt;/div>
&lt;/Tabs></code></pre>



<p>Here is the content from our <code>Tabs.js</code> file. Note that in React parlance, it is standard practice to name the file with the same capitalization as its <code>export default</code> component.</p>



<p>We start out with the same <code>getTabId</code> and <code>getPanelId</code> functions as in our vanilla JS approach, because we still need to make sure to accessibly map tabs to components. Take a look at the entirey of the code, and then we will continue to break it down.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import React, { useState } from 'react';
import PropTypes from 'prop-types';
import { v4 as uuid } from 'uuid';
import cx from 'classnames';

// Helpers.
import { getDomFallback } from '../utils';

// UI.
import Render from './Render';

// ==========
// Constants.
// ==========

const ARROW_LEFT = 'arrowleft';
const ARROW_RIGHT = 'arrowright';
const ENTER = 'enter';
const HORIZONTAL = 'horizontal';
const SPACE = ' ';
const STRING = 'string';

// Selector strings.
const TAB = 'tab';
const TAB_SELECTOR = `[role="${TAB}"]`;

const TABLIST = 'tablist';
const TABLIST_SELECTOR = `[role="${TABLIST}"]`;

const TABPANEL = 'tabpanel';

// ===========
// Get tab ID.
// ===========

const getTabId = (id = '', index = 0) => {
  return `${TAB}_${id}_${index}`;
};

// =============
// Get panel ID.
// =============

const getPanelId = (id = '', index = 0) => {
  return `${TABPANEL}_${id}_${index}`;
};

// ==========
// Is active?
// ==========

const getIsActive = ({ activeIndex = null, index = null, list = [] }) => {
  // Index matches?
  const isMatch = index === parseFloat(activeIndex);

  // Is first item?
  const isFirst = index === 0;

  // Only first item exists?
  const onlyFirstItem = list.length === 1;

  // Item doesn't exist?
  const badActiveItem = !list[activeIndex];

  // Flag as active?
  const isActive = isMatch || onlyFirstItem || (isFirst &amp;&amp; badActiveItem);

  // Expose boolean.
  return !!isActive;
};

getIsActive.propTypes = {
  activeIndex: PropTypes.number,
  index: PropTypes.number,
  list: PropTypes.array,
};

// ===============
// Focus new item.
// ===============

const focusNewItem = (target = getDomFallback(), newIndex = 0) => {
  // Get tablist.
  const tablist = target.closest(TABLIST_SELECTOR) || getDomFallback();

  // Get list items.
  const listItems = tablist.querySelectorAll(TAB_SELECTOR);

  // Get new item.
  const newItem = listItems[newIndex] || getDomFallback();

  // Focus new item.
  newItem.focus();
};

// ================
// Get `&lt;ul>` list.
// ================

const getTabsList = ({ activeIndex = null, id = '', list = [], setActiveIndex = () => {} }) => {
  // Build new list.
  const newList = list.map((item = {}, index) => {
    // =========
    // Get data.
    // =========

    const { props: itemProps = {} } = item;
    const { label = '' } = itemProps;
    const idPanel = getPanelId(id, index);
    const idTab = getTabId(id, index);
    const isActive = getIsActive({ activeIndex, index, list });

    // =======
    // Events.
    // =======

    const handleClick = () => {
      // Set active item.
      setActiveIndex(index);
    };

    const handleKeyDown = (event = {}) => {
      // Get target.
      const { target } = event;

      // Get key.
      let { key = '' } = event;
      key = key.toLowerCase();

      // Key events.
      const isArrowLeft = key === ARROW_LEFT;
      const isArrowRight = key === ARROW_RIGHT;
      const isArrowKey = isArrowLeft || isArrowRight;
      const isTriggerKey = key === ENTER || key === SPACE;

      // Valid event?
      const isValidEvent = isArrowKey || isTriggerKey;

      // Prevent default.
      if (isValidEvent) {
        event.preventDefault();
      }

      // ============
      // Arrow event?
      // ============

      if (isArrowKey) {
        // Set later.
        let newIndex = null;
        let nextItem = null;

        // Arrow left?
        if (isArrowLeft) {
          newIndex = index - 1;
          nextItem = list[newIndex];

          if (!nextItem) {
            newIndex = list.length - 1;
            nextItem = list[newIndex];
          }
        }

        // Arrow right?
        if (isArrowRight) {
          newIndex = index + 1;
          nextItem = list[newIndex];

          if (!nextItem) {
            newIndex = 0;
            nextItem = list[newIndex];
          }
        }

        // Item exists?
        if (nextItem) {
          // Focus new item.
          focusNewItem(target, newIndex);

          // Set active item.
          setActiveIndex(newIndex);
        }
      }

      // ==============
      // Trigger event?
      // ==============

      if (isTriggerKey) {
        // Set active item.
        setActiveIndex(index);
      }
    };

    // ============
    // Add to list.
    // ============

    return (
      &lt;li
        aria-controls={idPanel}
        aria-selected={isActive}
        className="tabs__item"
        id={idTab}
        key={idTab}
        role={TAB}
        tabIndex={isActive ? 0 : -1}
        // Events.
        onClick={handleClick}
        onKeyDown={handleKeyDown}
      >
        {label || `${index + 1}`}
      &lt;/li>
    );
  });

  // ==========
  // Expose UI.
  // ==========

  return (
    &lt;Render if={newList.length}>
      &lt;ul aria-orientation={HORIZONTAL} className="tabs__list" role={TABLIST}>
        {newList}
      &lt;/ul>
    &lt;/Render>
  );
};

getTabsList.propTypes = {
  activeIndex: PropTypes.number,
  id: PropTypes.string,
  list: PropTypes.array,
  setActiveIndex: PropTypes.func,
};

// =================
// Get `&lt;div>` list.
// =================

const getPanelsList = ({ activeIndex = null, id = '', list = [] }) => {
  // Build new list.
  const newList = list.map((item = {}, index) => {
    // =========
    // Get data.
    // =========

    const { props: itemProps = {} } = item;
    const { children = '', className = null, style = null } = itemProps;
    const idPanel = getPanelId(id, index);
    const idTab = getTabId(id, index);
    const isActive = getIsActive({ activeIndex, index, list });

    // =============
    // Get children.
    // =============

    let content = children || item;

    if (typeof content === STRING) {
      content = &lt;p>{content}&lt;/p>;
    }

    // =================
    // Build class list.
    // =================

    const classList = cx({
      tabs__panel: true,
      [String(className)]: className,
    });

    // ==========
    // Expose UI.
    // ==========

    return (
      &lt;div
        aria-hidden={!isActive}
        aria-labelledby={idTab}
        className={classList}
        id={idPanel}
        key={idPanel}
        role={TABPANEL}
        style={style}
        tabIndex={0}
      >
        {content}
      &lt;/div>
    );
  });

  // ==========
  // Expose UI.
  // ==========

  return newList;
};

getPanelsList.propTypes = {
  activeIndex: PropTypes.number,
  id: PropTypes.string,
  list: PropTypes.array,
};

// ==========
// Component.
// ==========

const Tabs = ({
  children = '',
  className = null,
  selected = 0,
  style = null,
  id: propsId = uuid(),
}) => {
  // ===============
  // Internal state.
  // ===============

  const [id] = useState(propsId);
  const [activeIndex, setActiveIndex] = useState(selected);

  // =================
  // Build class list.
  // =================

  const classList = cx({
    tabs: true,
    [String(className)]: className,
  });

  // ===============
  // Build UI lists.
  // ===============

  const list = Array.isArray(children) ? children : [children];

  const tabsList = getTabsList({
    activeIndex,
    id,
    list,
    setActiveIndex,
  });

  const panelsList = getPanelsList({
    activeIndex,
    id,
    list,
  });

  // ==========
  // Expose UI.
  // ==========

  return (
    &lt;Render if={list[0]}>
      &lt;div className={classList} id={id} style={style}>
        {tabsList}
        {panelsList}
      &lt;/div>
    &lt;/Render>
  );
};

Tabs.propTypes = {
  children: PropTypes.node,
  className: PropTypes.string,
  id: PropTypes.string,
  selected: PropTypes.number,
  style: PropTypes.object,
};

export default Tabs;</code></pre>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#function-getisactive"></a>Function: <code>getIsActive</code></h4>



<p>Due to a <code>&lt;Tabs&gt;</code> component always having something active and visible, this function contains some logic to determine whether an <code>index</code> of a given tab should be the lucky winner. Essentially, in sentence form the logic goes like this.</p>



<p>This current tab is active if:</p>



<ul><li>Its <code>index</code> matches the <code>activeIndex</code>, or</li><li>The tabs UI has only one tab, or</li><li>It is the first tab, and the <code>activeIndex</code> tab does not exist.</li></ul>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const getIsActive = ({ activeIndex = null, index = null, list = [] }) => {
  // Index matches?
  const isMatch = index === parseFloat(activeIndex);

  // Is first item?
  const isFirst = index === 0;

  // Only first item exists?
  const onlyFirstItem = list.length === 1;

  // Item doesn't exist?
  const badActiveItem = !list[activeIndex];

  // Flag as active?
  const isActive = isMatch || onlyFirstItem || (isFirst &amp;&amp; badActiveItem);

  // Expose boolean.
  return !!isActive;
};</code></pre>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#function-gettabslist"></a>Function: <code>getTabsList</code></h4>



<p>This function generates the clickable <code>&lt;li role="tabs"&gt;</code> UI, and returns it wrapped in a parent <code>&lt;ul role="tablist"&gt;</code>. It assigns all the relevant <code>aria-*</code> and <code>role</code> attributes, and handles binding the <code>onClick</code>and <code>onKeyDown</code> events. When an event is triggered, <code>setActiveIndex</code> is called. This updates the component&#8217;s internal state.</p>



<p>It is noteworthy how the content of the <code>&lt;li&gt;</code> is derived. That is passed in as <code>&lt;div label="…"&gt;</code> children of the parent <code>&lt;Tabs&gt;</code> component. Though this is not a real concept in flat HTML, it is a handy way to think about the relationship of the content. The <code>children</code> of that <code>&lt;div&gt;</code> become the the innards of our <code>role="tabpanel"</code> later.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const getTabsList = ({ activeIndex = null, id = '', list = [], setActiveIndex = () => {} }) => {
  // Build new list.
  const newList = list.map((item = {}, index) => {
    // =========
    // Get data.
    // =========

    const { props: itemProps = {} } = item;
    const { label = '' } = itemProps;
    const idPanel = getPanelId(id, index);
    const idTab = getTabId(id, index);
    const isActive = getIsActive({ activeIndex, index, list });

    // =======
    // Events.
    // =======

    const handleClick = () => {
      // Set active item.
      setActiveIndex(index);
    };

    const handleKeyDown = (event = {}) => {
      // Get target.
      const { target } = event;

      // Get key.
      let { key = '' } = event;
      key = key.toLowerCase();

      // Key events.
      const isArrowLeft = key === ARROW_LEFT;
      const isArrowRight = key === ARROW_RIGHT;
      const isArrowKey = isArrowLeft || isArrowRight;
      const isTriggerKey = key === ENTER || key === SPACE;

      // Valid event?
      const isValidEvent = isArrowKey || isTriggerKey;

      // Prevent default.
      if (isValidEvent) {
        event.preventDefault();
      }

      // ============
      // Arrow event?
      // ============

      if (isArrowKey) {
        // Set later.
        let newIndex = null;
        let nextItem = null;

        // Arrow left?
        if (isArrowLeft) {
          newIndex = index - 1;
          nextItem = list[newIndex];

          if (!nextItem) {
            newIndex = list.length - 1;
            nextItem = list[newIndex];
          }
        }

        // Arrow right?
        if (isArrowRight) {
          newIndex = index + 1;
          nextItem = list[newIndex];

          if (!nextItem) {
            newIndex = 0;
            nextItem = list[newIndex];
          }
        }

        // Item exists?
        if (nextItem) {
          // Focus new item.
          focusNewItem(target, newIndex);

          // Set active item.
          setActiveIndex(newIndex);
        }
      }

      // ==============
      // Trigger event?
      // ==============

      if (isTriggerKey) {
        // Set active item.
        setActiveIndex(index);
      }
    };

    // ============
    // Add to list.
    // ============

    return (
      &lt;li
        aria-controls={idPanel}
        aria-selected={isActive}
        className="tabs__item"
        id={idTab}
        key={idTab}
        role={TAB}
        tabIndex={isActive ? 0 : -1}
        // Events.
        onClick={handleClick}
        onKeyDown={handleKeyDown}
      >
        {label || `${index + 1}`}
      &lt;/li>
    );
  });

  // ==========
  // Expose UI.
  // ==========

  return (
    &lt;Render if={newList.length}>
      &lt;ul aria-orientation={HORIZONTAL} className="tabs__list" role={TABLIST}>
        {newList}
      &lt;/ul>
    &lt;/Render>
  );
};</code></pre>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#function-getpanelslist"></a>Function: <code>getPanelsList</code></h4>



<p>This function parses the incoming <code>children</code> of the top level component and extracts the content. It also makes use of <code>getIsActive</code> to determine whether (or not) to apply <code>aria-hidden="true"</code>. As one might expect by now, it adds all the other relevant <code>aria-*</code> and <code>role</code> attributes too. It also applies any extra <code>className</code> or <code>style</code> that was passed in.</p>



<p>It also is &#8220;smart&#8221; enough to wrap any <code>string</code> content — anything lacking a wrapping tag already — in <code>&lt;p&gt;</code> tags for consistency.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const getPanelsList = ({ activeIndex = null, id = '', list = [] }) => {
  // Build new list.
  const newList = list.map((item = {}, index) => {
    // =========
    // Get data.
    // =========

    const { props: itemProps = {} } = item;
    const { children = '', className = null, style = null } = itemProps;
    const idPanel = getPanelId(id, index);
    const idTab = getTabId(id, index);
    const isActive = getIsActive({ activeIndex, index, list });

    // =============
    // Get children.
    // =============

    let content = children || item;

    if (typeof content === STRING) {
      content = &lt;p>{content}&lt;/p>;
    }

    // =================
    // Build class list.
    // =================

    const classList = cx({
      tabs__panel: true,
      [String(className)]: className,
    });

    // ==========
    // Expose UI.
    // ==========

    return (
      &lt;div
        aria-hidden={!isActive}
        aria-labelledby={idTab}
        className={classList}
        id={idPanel}
        key={idPanel}
        role={TABPANEL}
        style={style}
        tabIndex={0}
      >
        {content}
      &lt;/div>
    );
  });

  // ==========
  // Expose UI.
  // ==========

  return newList;
};</code></pre>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#function-tabs"></a>Function: <code>Tabs</code></h4>



<p>This is the main component. It sets an internal state for an <code>id</code>, to essentially cache any generated <code>uuid()</code> so that it does not change during the lifecycle of the component. React is finicky about its <code>key</code> attributes (in the previous loops) changing dynamically, so this ensures they remain static once set.</p>



<p>We also employ <code>useState</code> to track the currently selected tab, and pass down a <code>setActiveIndex</code> function to each <code>&lt;li&gt;</code> to monitor when they are clicked. After that, it is pretty straightfowrard. We call <code>getTabsList</code> and <code>getPanelsList</code> to build our UI, and then wrap it all up in <code>&lt;div role="tablist"&gt;</code>.</p>



<p>It accepts any wrapper level <code>className</code> or <code>style</code>, in case anyone wants further tweaks during implementation. Providing other developers (as consumers) this flexibility means that the likelihood of needing to make further edits to the core component is lower. Lately, I have been doing this as a &#8220;best practice&#8221; for all components I create.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const Tabs = ({
  children = '',
  className = null,
  selected = 0,
  style = null,
  id: propsId = uuid(),
}) => {
  // ===============
  // Internal state.
  // ===============

  const [id] = useState(propsId);
  const [activeIndex, setActiveIndex] = useState(selected);

  // =================
  // Build class list.
  // =================

  const classList = cx({
    tabs: true,
    [String(className)]: className,
  });

  // ===============
  // Build UI lists.
  // ===============

  const list = Array.isArray(children) ? children : [children];

  const tabsList = getTabsList({
    activeIndex,
    id,
    list,
    setActiveIndex,
  });

  const panelsList = getPanelsList({
    activeIndex,
    id,
    list,
  });

  // ==========
  // Expose UI.
  // ==========

  return (
    &lt;Render if={list[0]}>
      &lt;div className={classList} id={id} style={style}>
        {tabsList}
        {panelsList}
      &lt;/div>
    &lt;/Render>
  );
};</code></pre>



<p class="explanation">If you are curious about the <code>&lt;Render&gt;</code> function, you can <a href="https://ui.reaktivstudios.com/storybook/?path=/story/render--example">read more about that in this example</a>.</p>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#file-accordionjs"></a>File: <code>Accordion.js</code></h4>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">// =============
// Used like so…
// =============

&lt;Accordion>
  &lt;div label="Tab 1">
    &lt;p>
      Tab 1 content
    &lt;/p>
  &lt;/div>
  &lt;div label="Tab 2">
    &lt;p>
      Tab 2 content
    &lt;/p>
  &lt;/div>
&lt;/Accordion></code></pre>



<p>As you may have deduced — due to the vanilla JS example handling both tabs <em>and</em> accordion — this file has quite a few similarities to how <code>Tabs.js</code> works.</p>



<p>Rather than belabor the point, I will simply provide the file&#8217;s contents for completeness and then speak about the specific areas in which the logic differs. So, take a gander at the contents and I will explain what makes <code>&lt;Accordion&gt;</code> quirky.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import React, { useState } from 'react';
import PropTypes from 'prop-types';
import { v4 as uuid } from 'uuid';
import cx from 'classnames';

// UI.
import Render from './Render';

// ==========
// Constants.
// ==========

const ENTER = 'enter';
const SPACE = ' ';
const STRING = 'string';
const VERTICAL = 'vertical';

// ===========
// Get tab ID.
// ===========

const getTabId = (id = '', index = 0) => {
  return `tab_${id}_${index}`;
};

// =============
// Get panel ID.
// =============

const getPanelId = (id = '', index = 0) => {
  return `tabpanel_${id}_${index}`;
};

// ==============================
// Get `tab` and `tabpanel` list.
// ==============================

const getTabsAndPanelsList = ({
  activeItems = {},
  id = '',
  isMulti = true,
  list = [],
  setActiveItems = () => {},
}) => {
  // Build new list.
  const newList = [];

  // Loop through.
  list.forEach((item = {}, index) => {
    // =========
    // Get data.
    // =========

    const { props: itemProps = {} } = item;

    const { children = '', className = null, label = '', style = null } = itemProps;

    const idPanel = getPanelId(id, index);
    const idTab = getTabId(id, index);
    const isActive = !!activeItems[index];

    // =======
    // Events.
    // =======

    const handleClick = (event = {}) => {
      let { key = '' } = event;
      key = key.toLowerCase();

      // Trigger key?
      const isTriggerKey = key === ENTER || key === SPACE;

      // Early exit.
      if (key &amp;&amp; !isTriggerKey) {
        return;
      }

      // Keep active items?
      const state = isMulti ? activeItems : null;

      // Update active item.
      const newState = {
        ...state,
        [index]: !activeItems[index],
      };

      // Prevent key press.
      event.preventDefault();

      // Set active item.
      setActiveItems(newState);
    };

    // =============
    // Get children.
    // =============

    let content = children || item;

    if (typeof content === STRING) {
      content = &lt;p>{content}&lt;/p>;
    }

    // =================
    // Build class list.
    // =================

    const classList = cx({
      accordion__panel: true,
      [String(className)]: className,
    });

    // ========
    // Add tab.
    // ========

    newList.push(
      &lt;div
        aria-controls={idPanel}
        aria-selected={isActive}
        className="accordion__item"
        id={idTab}
        key={idTab}
        role="tab"
        tabIndex={0}
        // Events.
        onClick={handleClick}
        onKeyDown={handleClick}
      >
        &lt;i aria-hidden="true" className="accordion__item__icon" />
        {label || `${index + 1}`}
      &lt;/div>
    );

    // ==========
    // Add panel.
    // ==========

    newList.push(
      &lt;div
        aria-hidden={!isActive}
        aria-labelledby={idTab}
        className={classList}
        id={idPanel}
        key={idPanel}
        role="tabpanel"
        style={style}
        tabIndex={0}
      >
        {content}
      &lt;/div>
    );
  });

  // ==========
  // Expose UI.
  // ==========

  return newList;
};

getTabsAndPanelsList.propTypes = {
  activeItems: PropTypes.object,
  id: PropTypes.string,
  isMulti: PropTypes.bool,
  list: PropTypes.array,
  setActiveItems: PropTypes.func,
};

// ==========
// Component.
// ==========

const Accordion = ({
  children = '',
  className = null,
  isMulti = true,
  selected = {},
  style = null,
  id: propsId = uuid(),
}) => {
  // ===============
  // Internal state.
  // ===============

  const [id] = useState(propsId);
  const [activeItems, setActiveItems] = useState(selected);

  // =================
  // Build class list.
  // =================

  const classList = cx({
    accordion: true,
    [String(className)]: className,
  });

  // ===============
  // Build UI lists.
  // ===============

  const list = Array.isArray(children) ? children : [children];

  const tabsAndPanelsList = getTabsAndPanelsList({
    activeItems,
    id,
    isMulti,
    list,
    setActiveItems,
  });

  // ==========
  // Expose UI.
  // ==========

  return (
    &lt;Render if={list[0]}>
      &lt;div
        aria-multiselectable={isMulti}
        aria-orientation={VERTICAL}
        className={classList}
        id={id}
        role="tablist"
        style={style}
      >
        {tabsAndPanelsList}
      &lt;/div>
    &lt;/Render>
  );
};

Accordion.propTypes = {
  children: PropTypes.node,
  className: PropTypes.string,
  id: PropTypes.string,
  isMulti: PropTypes.bool,
  selected: PropTypes.object,
  style: PropTypes.object,
};

export default Accordion;</code></pre>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#function-handleclick"></a>Function: <code>handleClick</code></h4>



<p>While most of our <code>&lt;Accordion&gt;</code> logic is similar to <code>&lt;Tabs&gt;</code>, it differs in how it stores the currently active tab.</p>



<p>Since <code>&lt;Tabs&gt;</code> are always mutually exclusive, we only really need a single numeric <code>index</code>. Easy peasy.</p>



<p>However, because an <code>&lt;Accordion&gt;</code> can have concurrently visible panels — or be used in a mutually exclusive manner — we need to represent that to <code>useState</code> in a way that could handle both.</p>



<p>If you were beginning to think…</p>



<blockquote class="wp-block-quote"><p>&#8220;I would store that in an object.&#8221;</p></blockquote>



<p>…then congrats. You are right!</p>



<p>This function does a quick check to see if <code>isMulti</code> has been set to <code>true</code>. If so, we use the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax">spread syntax</a> to apply the existing <code>activeItems</code> to our <code>newState</code> object. We then set the current <code>index</code> to its boolean opposite.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const handleClick = (event = {}) => {
  let { key = '' } = event;
  key = key.toLowerCase();

  // Trigger key?
  const isTriggerKey = key === ENTER || key === SPACE;

  // Early exit.
  if (key &amp;&amp; !isTriggerKey) {
    return;
  }

  // Keep active items?
  const state = isMulti ? activeItems : null;

  // Update active item.
  const newState = {
    ...state,
    [index]: !activeItems[index],
  };

  // Prevent key press.
  event.preventDefault();

  // Set active item.
  setActiveItems(newState);
};</code></pre>



<p>For reference, here is how our <code>activeItems</code> object looks if only the first accordion panel is active and a user clicks the second. Both indexes would be set to <code>true</code>. This allows for viewing two expanded <code>role="tabpanel"</code> simultaneously.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">/*
  Internal representation
  of `activeItems` state.
*/

{
  0: true,
  1: true,
}
</code></pre>



<p>Whereas if we were <em>not</em> operating in <code>isMulti</code> mode — when the wrapper has <code>aria-multiselectable="false"</code> — then <code>activeItems</code> would only ever contain one key/value pair.</p>



<p>Because rather than spreading the current <code>activeItems</code>, we would be spreading <code>null</code>. That effectively wipes the slate clean, before recording the currently active tab.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">/*
  Internal representation
  of `activeItems` state.
*/

{
  1: true,
}
</code></pre>



<hr class="wp-block-separator"/>



<h3>Conclusion</h3>



<p>Still here? Awesome.</p>



<p>Hopefully you found this article informative, and maybe even learned a bit more about accessibility and JS(X) along the way. For review, let us look one more time at our flat HTML example and and the React usage of our <code>&lt;Tabs&gt;</code>component. Here is a comparison of the markup we would write in a vanilla JS approach, versus the <a href="https://reactjs.org/docs/introducing-jsx.html">JSX</a> it takes to generate the same thing.</p>



<p>I am not saying that one is better than the other, but you can see how React makes it possible to distill things down into a mental model. Working directly in HTML, you always have to be aware of every tag.</p>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#html"></a>HTML</h4>



<pre rel="HTML" class="wp-block-csstricks-code-block language-markup" data-line=""><code markup="tt">&lt;div class="tabs">
  &lt;ul class="tabs__list">
    &lt;li class="tabs__item">
      Tab 1
    &lt;/li>
    &lt;li class="tabs__item">
      Tab 2
    &lt;/li>
  &lt;/ul>
  &lt;div class="tabs__panel">
    &lt;p>
      Tab 1 content
    &lt;/p>
  &lt;/div>
  &lt;div class="tabs__panel">
    &lt;p>
      Tab 2 content
    &lt;/p>
  &lt;/div>
&lt;/div></code></pre>



<h4><a href="https://gist.github.com/nathansmith/4d06cdb55502ca57c0e293ee64efdcc4#jsx"></a>JSX</h4>



<pre rel="JSX" class="wp-block-csstricks-code-block language-jsx" data-line=""><code markup="tt">&lt;Tabs>
  &lt;div label="Tab 1">
    Tab 1 content
  &lt;/div>
  &lt;div label="Tab 2">
    Tab 2 content
  &lt;/div>
&lt;/Tabs></code></pre>



<p>↑ One of these probably looks preferrable, depending on your point of view.</p>



<p>Writing code <a href="https://wiki.c2.com/?CloseToTheMetal">closer to the metal</a> means more direct control, but also more tedium. Using a framework like React means you get more functionality &#8220;for free,&#8221; but also it can be a black box.</p>



<p>That is, unless you understand the underlying nuances already. Then you can fluidly operate in either realm. Because you can see <a href="https://www.youtube.com/watch?v=Vy7RaQUmOzE"><em>The Matrix</em></a> for what it really is: Just JavaScript&#x2122;. Not a bad place to be, no matter where you find yourself.</p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/the-anatomy-of-a-tablist-component-in-vanilla-javascript-versus-react/">The Anatomy of a Tablist Component in Vanilla JavaScript Versus React</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://css-tricks.com/the-anatomy-of-a-tablist-component-in-vanilla-javascript-versus-react/feed/</wfw:commentRss>
			<slash:comments>6</slash:comments>
		
		
		<post-id xmlns="com-wordpress:feed-additions:1">307347</post-id>	</item>
		<item>
		<title>Creating a Gauge in React</title>
		<link>https://wattenberger.com/blog/gauge</link>
		
		<dc:creator><![CDATA[Chris Coyier]]></dc:creator>
		<pubDate>Sun, 03 May 2020 13:45:27 +0000</pubDate>
				<category><![CDATA[Article]]></category>
		<category><![CDATA[data visualization]]></category>
		<category><![CDATA[graph]]></category>
		<category><![CDATA[react]]></category>
		<category><![CDATA[SVG]]></category>
		<guid isPermaLink="false">https://css-tricks.com/?p=308118</guid>

					<description><![CDATA[<p>You should really look at everything Amelia does, but I get extra excited about her interactive blog posts. Her latest about creating a gauge with <a href="https://wattenberger.com/blog/gauge">SVG in React</a> is unreal. Just the stuff about understanding <code>viewBox</code> is amazing and that&#8217;s like 10% of it. </p>
<p>Don&#8217;t miss her earlier posts like the one on <a href="https://wattenberger.com/blog/css-cascade">CSS Cascade</a> or <a href="https://wattenberger.com/blog/react-hooks">React Hooks</a> either. </p>
<p><a href="https://wattenberger.com/blog/gauge" title="Direct link to featured article">Direct Link to Article</a> &#8212; <a href="https://css-tricks.com/creating-a-gauge-in-react/">Permalink</a>&#8230; <a href="https://css-tricks.com/creating-a-gauge-in-react/" class="read-more">Read article <span class="screen-reader-text"> &#8220;Creating a Gauge in React&#8221;</span></a></p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/creating-a-gauge-in-react/">Creating a Gauge in React</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></description>
										<content:encoded><![CDATA[
<p>You should really look at everything Amelia does, but I get extra excited about her interactive blog posts. Her latest about creating a gauge with <a href="https://wattenberger.com/blog/gauge">SVG in React</a> is unreal. Just the stuff about understanding <code>viewBox</code> is amazing and that&#8217;s like 10% of it. </p>



<p>Don&#8217;t miss her earlier posts like the one on <a href="https://wattenberger.com/blog/css-cascade">CSS Cascade</a> or <a href="https://wattenberger.com/blog/react-hooks">React Hooks</a> either. </p>
<p><a href="https://wattenberger.com/blog/gauge" title="Direct link to featured article">Direct Link to Article</a> &#8212; <a href="https://css-tricks.com/creating-a-gauge-in-react/">Permalink</a></p><p>The post <a rel="nofollow" href="https://css-tricks.com/creating-a-gauge-in-react/">Creating a Gauge in React</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></content:encoded>
					
		
		
		<post-id xmlns="com-wordpress:feed-additions:1">308118</post-id>	</item>
		<item>
		<title>Using Formik to Handle Forms in React</title>
		<link>https://css-tricks.com/using-formik-to-handle-forms-in-react/</link>
					<comments>https://css-tricks.com/using-formik-to-handle-forms-in-react/#respond</comments>
		
		<dc:creator><![CDATA[Adebiyi Adedotun]]></dc:creator>
		<pubDate>Tue, 28 Apr 2020 14:46:36 +0000</pubDate>
				<category><![CDATA[Article]]></category>
		<category><![CDATA[formik]]></category>
		<category><![CDATA[forms]]></category>
		<category><![CDATA[react]]></category>
		<guid isPermaLink="false">https://css-tricks.com/?p=306672</guid>

					<description><![CDATA[<p>There is no doubt that web forms play an integral role in our web site or applications. By default, they provide a useful set of elements and features — from legends and fieldsets to native validation and states — but they only get us so far when we start to consider the peculiarities of using them. For example, how can we manipulate the state of a form? How about different forms of validation? Even hooking a form up to post &#8230; <a href="https://css-tricks.com/using-formik-to-handle-forms-in-react/" class="read-more">Read article <span class="screen-reader-text"> &#8220;Using Formik to Handle Forms in React&#8221;</span></a></p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/using-formik-to-handle-forms-in-react/">Using Formik to Handle Forms in React</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></description>
										<content:encoded><![CDATA[
<p>There is no doubt that web forms play an integral role in our web site or applications. By default, they provide a useful set of elements and features — from legends and fieldsets to native validation and states — but they only get us so far when we start to consider the peculiarities of using them. For example, how can we manipulate the state of a form? How about different forms of validation? Even hooking a form up to post submissions is a daunting effort at times.</p>



<p>Component-driven front-end libraries, like React, can ease the task of wiring web forms but can also get verbose and redundant. That’s why I want to introduce you to Formik, a small library that solves the three most annoying parts of writing forms in React:</p>



<ol><li>State manipulation</li><li>Form validation (and error messages)</li><li>Form submission </li></ol>



<p>We’re going to build a form together in this post. We’ll start with a React component then integrate Formik while demonstrating the way it handles state, validation, and submissions.</p>



<span id="more-306672"></span>



<h3>Creating a form as a React component</h3>



<p>Components live and breathe through their <strong>state</strong> and <strong>prop</strong><em>. </em>What HTML form elements have in common with React components is that they naturally keep some internal state. Their values are also automatically stored in their <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input#htmlattrdefvalue">value</a> attribute.</p>



<p>Allowing form elements to manage their own state in React makes them <a href="https://reactjs.org/docs/uncontrolled-components.html"><em>uncontrolle</em>d</a> components. That’s just a fancy way of saying the DOM handles the state instead of React. And while that works, it is often easier to use <a href="https://reactjs.org/docs/forms.html%23controlled-components"><em>controlled</em></a> components, where React handles the state and serves as the single source of truth rather than the DOM.</p>



<p>The markup for a straightforward HTML form might look something like this:</p>



<pre rel="HTML" class="wp-block-csstricks-code-block language-markup" data-line=""><code markup="tt">&lt;form>
  &lt;div className="formRow">
    &lt;label htmlFor="email">Email address&lt;/label>
    &lt;input type="email" name="email" className="email" />
  &lt;/div>
  &lt;div className="formRow">
    &lt;label htmlFor="password">Password&lt;/label>
    &lt;input type="password" name="password" className="password" />
  &lt;/div>
  &lt;button type="submit">Submit&lt;/button>
&lt;/form></code></pre>



<p>We can convert that into a controlled React component like so:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">function HTMLForm() {
  const [email, setEmail] = React.useState("");
  const [password, setPassword] = React.useState("");
 
  return (
    &lt;form>
      &lt;div className="formRow">
        &lt;label htmlFor="email">Email address&lt;/label>
        &lt;input
          type="email"
          name="email"
          className="email"
          value={email}
          onChange={e => setEmail(e.target.value)}
        />
      &lt;/div>
      &lt;div className="formRow">
        &lt;label htmlFor="password">Password&lt;/label>
        &lt;input
          type="password"
          name="password"
          className="password"
          value={password}
          onChange={e => setPassword(e.target.value)}
        />
      &lt;/div>
      &lt;button type="submit">Submit&lt;/button>
    &lt;/form>
  );
}</code></pre>



<p>This is a bit verbose but it comes with some benefits:</p>



<ol><li>We get a single source of truth for form values in the state.</li><li>We can validate the form when and how we want.</li><li>We get performance perks by loading what we need and when we need it.</li></ol>



<h3>OK, so why Formik again?</h3>



<p>As it is with anything JavaScript, there’s already a bevy of form management libraries out there, like <a href="https://react-hook-form.com">React Hook Form</a> and <a href="https://redux-form.com/8.3.0/">Redux Form</a>, that we can use. But there are several things that make Formik stand out from the pack:</p>



<ol><li><strong>It’s declarative:</strong> Formik eliminates redundancy through abstraction and taking responsibility for state, validation and submissions.</li><li><strong>It offers an Escape Hatch:</strong> Abstraction is good, but forms are peculiar to certain patterns. Formik abstracts for you but also let’s you control it should you need to.</li><li><strong>It co-locates form states:</strong> Formik keeps everything that has to do with your form within your form components.</li><li><strong>It’s adaptable: </strong>Formik doesn’t enforce any rules on you. You can use as less or as much Formik as you need.</li><li><strong>Easy to use: </strong>Formik <em>just</em> works.</li></ol>



<p>Sound good? Let’s implement Formik into our form component.</p>



<h2><strong>Going Formik</strong></h2>



<p>We will be building a basic login form to get our beaks wet with the fundamentals. We’ll be touching on three different ways to work with Formik:</p>



<ol><li>Using the <code>useFormik</code> <a href="https://reactjs.org/docs/hooks-intro.html">hook</a></li><li>Using <code>Formik</code> with <a href="https://reactjs.org/docs/context.html">React context</a></li><li>Using <code>withFormik</code> as a <a href="https://css-tricks.com/what-are-higher-order-components-in-react/">higher-order component</a></li></ol>



<p>I’ve created a demo with the packages we need, Formik and Yup.</p>



<iframe src="https://codesandbox.io/embed/better-forms-in-react-with-formik-eq7q0?fontsize=14&amp;hidenavigation=1&amp;theme=dark" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" title="Better Forms in React with Formik" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin">
</iframe>



<h3>Method 1: Using the useFormik hook</h3>



<p>As it is right now, our form does nothing tangible. To start using Formik, we need to import the <code>useFormik</code> hook. When we use the hook, it returns all of the Formik functions and variables that help us manage the form. If we were to log the returned values to the console, we get this:</p>



<figure class="wp-block-image size-large"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/v7P4xHW6.png?fit=976%2C1024&amp;ssl=1" alt="Showing console output of the various hooks and objects that are logged by Formik." class="wp-image-306674" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/v7P4xHW6.png?w=1174&amp;ssl=1 1174w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/v7P4xHW6.png?resize=286%2C300&amp;ssl=1 286w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/v7P4xHW6.png?resize=976%2C1024&amp;ssl=1 976w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/v7P4xHW6.png?resize=768%2C806&amp;ssl=1 768w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/v7P4xHW6.png?resize=1000%2C1049&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>We’ll call <code>useFormik</code> and pass it <code>initialValues</code> to start. Then, an <code>onSubmit</code> handler fires when a form submission happens. Here’s how that looks:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">// This is a React component
function BaseFormik() {
  const formik = useFormik({
    initialValues: {
      email: "",
      password: ""
    },
    onSubmit(values) {
      // This will run when the form is submitted
    }
  });
  
 // If you're curious, you can run this Effect
 //  useEffect(() => {
 //   console.log({formik});
 // }, [])
 
  return (
    // Your actual form
  )
}</code></pre>



<p>Then we’ll bind Formik to our form elements:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">// This is a React component
function BaseFormik() {
  const formik = useFormik({
    initialValues: {
      email: "",
      password: ""
    },
    onSubmit(values) {
      // This will run when the form is submitted
    }
  });
  
 // If you're curious, you can run this Effect
 //  useEffect(() => {
 //   console.log({formik});
 // }, [])
 
  return (
  // We bind "onSubmit" to "formik.handleSubmit"
  &lt;form className="baseForm" onSubmit={formik.handleSubmit} noValidate>
    &lt;input
      type="email"
      name="email"
      id="email"
      className="email formField"
      value={formik.values.email} // We also bind our email value
      onChange={formik.handleChange} // And, we bind our "onChange" event.
    />
  &lt;/form>
  )
}</code></pre>



<p>This is how the binding works:</p>



<ol><li>It handles form submission with <code>onSubmit={formik.handleSubmit}</code>.</li><li>It handles the state of inputs with <code>value={formik.values.email}</code> and <code>onChange={formik.handleChange}</code>.</li></ol>



<p>If you take a closer look, we didn’t have to set up our state, nor handle the <code>onChange</code> or <code>onSubmit</code> events as we’d typically do with React.</p>



<p>However as you might have noticed, our form contains some redundancy. We had to drill down formik and manually bind the form input’s <code>value</code> and <code>onChange</code> event. That means we should de-structure the returned value and immediately bind the necessary props to a dependent field, like this:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line="24"><code markup="tt">// This is a React component
function BaseFormik() {
  const {getFieldProps, handleSubmit} = useFormik({
    initialValues: {
      email: "",
      password: ""
    },
    onSubmit(values) {
      // This will run when the form is submitted
    }
  });
  
 // If you're curious, you can run this Effect
 //  useEffect(() => {
 //   console.log({formik});
 // }, [])
 
  return (
  &lt;form className="baseForm" onSubmit={handleSubmit} noValidate>
    &lt;input
      type="email"
      id="email"
      className="email formField"
      {...getFieldProps("email")} // We pass the name of the dependent field
    />
  &lt;/form>
  )
}</code></pre>



<p>Let’s take things even further with the included <code>&lt;Formik/&gt;</code> &nbsp;component.</p>



<h3>Method 2: Using Formik with React context</h3>



<p>The <code>&lt;Formik/&gt;</code> component exposes various other components that adds more abstraction and sensible defaults. For example, components like <code>&lt;Form/</code>&gt;, <code>&lt;Field/&gt;</code>, and <code>&lt;ErrorMessage/&gt;</code> are ready to go right out of the box.</p>



<p class="explanation">Keep in mind, you don’t have to use these components when working with <code>&lt;Formik/&gt;</code> but they do require <code>&lt;Formik/&gt;</code> (or <code>withFormik</code>) when using them.</p>



<p>Using&nbsp;<code>&lt;Formik/&gt;</code>&nbsp;requires an overhaul because it uses the&nbsp;<a rel="noreferrer noopener" target="_blank" href="https://reactjs.org/docs/render-props.html">render props pattern</a>&nbsp;as opposed to hooks with&nbsp;<code>useFormik</code>. The render props pattern isn’t something new in React. It is a pattern that enables code re-usability between components — something hooks solve better. Nevertheless, <code>&lt;Formik/&gt;</code>&nbsp;has a bagful of custom components that make working with forms much easier.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import { Formik } from "formik";
 
function FormikRenderProps() {
  const initialValues = {
    email: "",
    password: ""
  };
  function onSubmit(values) {
    // Do stuff here...
    alert(JSON.stringify(values, null, 2));
  }
  return (
      &lt;Formik {...{ initialValues, onSubmit }}>
        {({ getFieldProps, handleSubmit }) => (
            &lt;form className="baseForm" onSubmit={handleSubmit} noValidate>
              &lt;input
                type="email"
                id="email"
                className="email formField"
                {...getFieldProps("email")}
              />
            &lt;/form>
        )}
      &lt;/Formik>
  );
}</code></pre>



<p>Notice that <code>initialValues</code> and <code>onSubmit</code> have been completely detached from <code>useFormik</code>. This means we are able to pass the props that <code>&lt;Formik/&gt;</code> needs, specifically <code>initialValues</code> and <code>useFormik</code>.</p>



<p><code>&lt;Formik/&gt;</code> returns a value that’s been de-structured into <code>getFieldProps</code> and <code>handleSubmit</code>. Everything else basically remains the same as the first method using <code>useFormik</code>.</p>



<p class="explanation"><a href="https://css-tricks.com/an-overview-of-render-props-in-react/">Here’s a refresher on React render props</a> if you’re feeling a little rusty.</p>



<p>We haven’t actually put any <code>&lt;Formik/&gt;</code> components to use just yet. I’ve done this intentionally to demonstrate Formik’s adaptability. We certainly do want to use those components for our form fields, so let’s rewrite the component so it uses the <code>&lt;Form/&gt;</code> component.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import { Formik, Field, Form } from "formik";
 
function FormikRenderProps() {
  const initialValues = {
    email: "",
    password: ""
  };
  function onSubmit(values) {
    // Do stuff here...
    alert(JSON.stringify(values, null, 2));
  }
  return (
      &lt;Formik {...{ initialValues, onSubmit }}>
        {() => (
            &lt;Form className="baseForm" noValidate>
              &lt;Field
                type="email"
                id="email"
                className="email formField"
                name="email"
              />
            &lt;/Form>
        )}
      &lt;/Formik>
  );
}</code></pre>



<p>We replaced <code>&lt;form/&gt;</code> with <code>&lt;Form/&gt;</code> and removed the <code>onSubmit</code> handler since Formik handles that for us. Remember, it takes on all the responsibilities for handling forms.</p>



<p>We also replaced <code>&lt;input/&gt;</code> with <code>&lt;Field/&gt;</code> and removed the bindings. Again, Formik handles that.</p>



<p>There’s also no need to bother with the returned value from <code>&lt;Formik/&gt;</code> anymore. You guessed it, Formik handles that as well.</p>



<p>Formik handles everything for us. We can now focus more on the business logic of our forms rather than things that can essentially be abstracted.</p>



<p>We’re pretty much set to go and guess what? We’ve haven&#8217;t been concerned with state managements or form submissions!</p>



<p>“What about validation?&#8221; you may ask. We haven’t touched on that because it’s a whole new level on its own. Let’s touch on that before jumping to the last method.</p>



<h4>Form validation with Formik</h4>



<p>If you’ve ever worked with forms (and I bet you have), then you’re aware that validation isn’t something to neglect.</p>



<p>We want to take control of <em>when</em> and <em>how</em> to validate so new opportunities open up to create better user experiences. Gmail, for example, will not let you input a password unless the email address input is validated and authenticated. We could also do something where we validate on the spot and display messaging without additional interactions or page refreshes.</p>



<p>Here are three ways that Formik is able to handle validation:</p>



<ol><li>At the form level</li><li>At the field level</li><li>With manual triggers</li></ol>



<p>Validation at the form level means validating the form as a whole. Since we have immediate access to form values, we can validate the entire form at once by either:</p>



<ul><li>using <code>validate</code>, or</li><li>using a third-party library with <code><a href="https://jaredpalmer.com/formik/docs/guides/validation%23validationschema">validationSchema</a></code>.</li></ul>



<p>Both <code>validate</code> and <code>validationSchema</code> are functions that return an <code>errors</code> object with key/value pairings that those of <code>initialValues</code>. We can pass those to &nbsp;<code>useFormik</code>, <code>&lt;Formik/&gt;</code> or <code>withFormik</code>.&nbsp;</p>



<p class="explanation">While <code>validate</code> is used for custom validations, <code>validationSchema</code> is used with a third-party library like Yup.&nbsp;</p>



<p>Here’s an example using <code>validate</code>:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">// Pass the `onSubmit` function that gets called when the form is submitted.
const formik = useFormik({
  initialValues: {
    email: "",
    password: ""
  },
  // We've added a validate function
  validate() {
    const errors = {};
    // Add the touched to avoid the validator validating all fields at once
    if (formik.touched.email &amp;&amp; !formik.values.email) {
      errors.email = "Required";
    } else if (
      !/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(formik.values.email)
    ) {
      errors.email = "Invalid email address";
    }
    if (formik.touched.password &amp;&amp; !formik.values.password) {
      errors.password = "Required";
    } else if (formik.values.password.length &lt;= 8) {
      errors.password = "Must be more than 8 characters";
    }
    return errors;
  },
  onSubmit(values) {
    // Do stuff here...
  }
});
// ...</code></pre>



<p>And here we go with an example using <code>validationSchema</code> instead:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const formik = useFormik({
  initialValues: {
    email: "",
    password: ""
  },
  // We used Yup here.
  validationSchema: Yup.object().shape({
    email: Yup.string()
      .email("Invalid email address")
      .required("Required"),
    password: Yup.string()
      .min(8, "Must be more than 8 characters")
      .required("Required")
  }),
  onSubmit(values) {
    // Do stuff here...
  }
});</code></pre>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/Screen-Shot-2020-04-28-at-1.21.31-PM.png?fit=1024%2C809&amp;ssl=1" alt="" class="wp-image-307816" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/Screen-Shot-2020-04-28-at-1.21.31-PM.png?w=1732&amp;ssl=1 1732w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/Screen-Shot-2020-04-28-at-1.21.31-PM.png?resize=300%2C237&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/Screen-Shot-2020-04-28-at-1.21.31-PM.png?resize=1024%2C809&amp;ssl=1 1024w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/Screen-Shot-2020-04-28-at-1.21.31-PM.png?resize=768%2C607&amp;ssl=1 768w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/Screen-Shot-2020-04-28-at-1.21.31-PM.png?resize=1536%2C1213&amp;ssl=1 1536w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/Screen-Shot-2020-04-28-at-1.21.31-PM.png?resize=1000%2C790&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p class="explanation">Validating at the <a href="https://jaredpalmer.com/formik/docs/guides/validation%23field-level-validation">field level</a> or using <a href="https://jaredpalmer.com/formik/docs/guides/validation%23manually-triggering-validation">manual triggers</a> are fairly simple to understand. Albeit, you’ll likely use form level validation most of the time. It’s also worth checking out the <a href="https://jaredpalmer.com/formik/docs/guides/validation">docs</a> to see other use cases.</p>



<h3>Method 3: Using withFormik as a higher-order component</h3>



<p><code>withFormik</code> is a higher-order component and be used that way if that’s your thing. Write the form, then expose it through Formik.</p>



<h3>A couple of practical examples</h3>



<p>So far, we’ve become acquainted with Formik, covered the benefits of using it for creating forms in React, and covered a few methods to implement it as a React component while demonstrating various ways we can use it for validation. What we haven’t done is looked at examples of those key concepts.</p>



<p>So, let’s look at a couple of practical applications: displaying error messages and generating a username based on what&#8217;s entered in the email input.</p>



<h4>Displaying error messages</h4>



<p>We’ve built our form and validated it. And we’ve caught some errors that can be found in our <code>errors</code> object. But it’s no use if we aren’t actually displaying those errors.</p>



<p>Formik makes this a pretty trivial task. All we need to do is check the <code>errors</code> object returned by any of the methods we’ve looked at — <code>&lt;Formik/&gt;</code>, <code>useFormik</code> or <code>withFormik</code> — and display them:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line="4"><code markup="tt">&lt;label className="formFieldLabel" htmlFor="email">
  Email address
  &lt;span className="errorMessage">
    {touched["email"] &amp;&amp; errors["email"]}
  &lt;/span>
&lt;/label>
&lt;div className="formFieldWrapInner">
  &lt;input
    type="email"
    id="email"
    className="email formField"
    {...getFieldProps("email")}
  />
&lt;/div></code></pre>



<p>If there’s an error during validation, <code>{touched["email"] &amp;&amp; errors["email"]}</code> will display it to the user.</p>



<p>We could do the same with <code>&lt;ErrorMessage/&gt;</code>. With this, we only need to tell it the name of the dependent field to watch:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">&lt;ErrorMessage name="email">
  {errMsg => &lt;span className="errorMessage">{errMsg}&lt;/span>}
&lt;/ErrorMessage></code></pre>



<h4>Generating a username from an email address</h4>



<p>Imagine a form that automatically generates a username for your users based on their email address. In other words, whatever the user types into the email input gets pulled out, stripped of <code>@</code> and everything after it, and leaves us with a username with what’s left.</p>



<p>For example: <code>jane@doe.com</code> produces <code>@jane</code>.</p>



<p>Formik exposes helpers that can “intercept” its functionality and lets us perform some effects.In the case of auto-generating a username, one way will be through Formik’s <code>setValues</code>:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">onSubmit(values) {
  // We added a `username` value for the user which is everything before @ in their email address.
  setValues({
    ...values,
    username: `@${values.email.split("@")[0]}`
  });
}</code></pre>



<p>Type in an email address and password, then submit the form to see your new username!</p>



<iframe src="https://codesandbox.io/embed/better-forms-in-react-with-formik-eq7q0?fontsize=14&amp;hidenavigation=1&amp;initialpath=%2Fhatch-escape&amp;module=%2Fsrc%2FBaseFormikSetValues.js&amp;theme=dark" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" title="Better Forms in React with Formik" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>



<h3>Wrapping up</h3>



<p>Wow, we covered a lot of ground in a short amount of space. While this is merely the tip of the iceberg as far as covering all the needs of a form and what Formik is capable of doing, I hope this gives you a new tool to reach for the next time you find yourself tackling forms in a React application.</p>



<p>If you’re ready to take Formik to the next level, I’d suggest <a href="https://jaredpalmer.com/formik/docs/resources">looking through their resources</a> as a starting point. There are so many goodies in there and it’s a good archive of what Formik can do as well as more tutorials that get into deeper use cases.</p>



<p>Good luck with your forms!</p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/using-formik-to-handle-forms-in-react/">Using Formik to Handle Forms in React</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://css-tricks.com/using-formik-to-handle-forms-in-react/feed/</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
		<post-id xmlns="com-wordpress:feed-additions:1">306672</post-id>	</item>
		<item>
		<title>Rethinking Twitter as a Serverless App</title>
		<link>https://css-tricks.com/rethinking-twitter-as-a-serverless-app/</link>
					<comments>https://css-tricks.com/rethinking-twitter-as-a-serverless-app/#comments</comments>
		
		<dc:creator><![CDATA[Brecht De Rooms]]></dc:creator>
		<pubDate>Thu, 23 Apr 2020 14:56:09 +0000</pubDate>
				<category><![CDATA[Sponsored]]></category>
		<category><![CDATA[cloud functions]]></category>
		<category><![CDATA[cloudinary]]></category>
		<category><![CDATA[fauna]]></category>
		<category><![CDATA[react]]></category>
		<category><![CDATA[twitter]]></category>
		<guid isPermaLink="false">https://css-tricks.com/?p=307188</guid>

					<description><![CDATA[<p>In a <a href="https://css-tricks.com/instant-graphql-backend-using-faunadb/">previous article</a>, we showed how to build a GraphQL API with FaunaDB. We&#8217;ve also written a series of articles [<a href="https://css-tricks.com/consistent-backends-and-ux:-why-should-you-care?">1</a>, <a href="https://css-tricks.com/consistent-backends-and-ux-what-can-go-wrong">2</a>, <a href="https://css-tricks.com/consistent-backends-and-ux-what-are-the-barriers-to-adoption">3</a>, <a href="https://css-tricks.com/consistent-backends-and-ux:-how-do-new-algorithms-help?">4</a>] explaining how traditional databases built for global scalability have to adopt eventual (vs. strong) consistency, and/or make compromises on relations and indexing possibilities. FaunaDB is different since it does not make these compromises. It’s built to scale so it can safely serve your future startup no matter how big &#8230; <a href="https://css-tricks.com/rethinking-twitter-as-a-serverless-app/" class="read-more">Read article <span class="screen-reader-text"> &#8220;Rethinking Twitter as a Serverless App&#8221;</span></a></p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/rethinking-twitter-as-a-serverless-app/">Rethinking Twitter as a Serverless App</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></description>
										<content:encoded><![CDATA[
<p>In a <a href="https://css-tricks.com/instant-graphql-backend-using-faunadb/">previous article</a>, we showed how to build a GraphQL API with FaunaDB. We&#8217;ve also written a series of articles [<a href="https://css-tricks.com/consistent-backends-and-ux:-why-should-you-care?">1</a>, <a href="https://css-tricks.com/consistent-backends-and-ux-what-can-go-wrong">2</a>, <a href="https://css-tricks.com/consistent-backends-and-ux-what-are-the-barriers-to-adoption">3</a>, <a href="https://css-tricks.com/consistent-backends-and-ux:-how-do-new-algorithms-help?">4</a>] explaining how traditional databases built for global scalability have to adopt eventual (vs. strong) consistency, and/or make compromises on relations and indexing possibilities. FaunaDB is different since it does not make these compromises. It’s built to scale so it can safely serve your future startup no matter how big it gets, without sacrificing relations and consistent data.</p>



<p>In this article, we&#8217;re very excited to start bringing all of this together in a real-world app with highly dynamic data in a serverless fashion using <a href="https://reactjs.org/docs/hooks-intro.html">React hooks</a>, <a href="https://synd.co/2RW93ns">FaunaDB</a>, and <a href="https://cloudinary.com/">Cloudinary</a>. We will use the Fauna Query Language (FQL) instead of GraphQL and start with a frontend-only approach that directly accesses the serverless database FaunaDB for data storage, authentication, and authorization.</p>



<span id="more-307188"></span>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/stack2.png?fit=1024%2C333&amp;ssl=1" alt="" class="wp-image-307189" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/stack2.png?w=1600&amp;ssl=1 1600w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/stack2.png?resize=300%2C98&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/stack2.png?resize=1024%2C333&amp;ssl=1 1024w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/stack2.png?resize=768%2C250&amp;ssl=1 768w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/stack2.png?resize=1536%2C500&amp;ssl=1 1536w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/stack2.png?resize=1000%2C326&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p><br>The golden standard for example applications that feature a specific technology is a todo app&#8211;mainly because they are simple. Any database out there can serve a very simple application and shine.&nbsp;</p>



<p>And that is exactly why this app will be different! If we truly want to show how<strong> </strong>FaunaDB excels for real world applications, then we need to build something more advanced.&nbsp;</p>



<h3>Introducing Fwitter</h3>



<blockquote class="wp-block-quote"><p>When we started at Twitter, databases were bad. When we left, they&nbsp;were still bad</p><cite>Evan Weaver</cite></blockquote>



<p>Since FaunaDB was developed by ex-Twitter engineers who experienced these limitations first-hand, a Twitter-like application felt like an appropriately sentimental choice. And, since we are building it with FaunaDB, let’s call this serverless baby ‘<strong>Fwitter’</strong>.&nbsp;</p>



<p>Below is a short video that shows how it looks, and the full source code is <a href="https://github.com/fauna-brecht/fwitter">available on GitHub</a>.</p>



<figure class="wp-block-video"><video controls src="https://css-tricks.com/wp-content/uploads/2020/04/twitterapp_walkthrough.mp4"></video></figure>



<p>When you <a href="https://github.com/fauna-brecht/fwitter">clone the repo</a> and start digging around, you might notice a plethora of well-commented example queries not covered in this article. That&#8217;s because we&#8217;ll be using Fwitter as our go-to example application in future articles, and building additional features into it with time.&nbsp;</p>



<p>But, for now, here&#8217;s a basic rundown of what we&#8217;ll cover here:</p>



<ul><li><a href="#article-header-id-1">Modeling the data&nbsp;</a></li><li><a href="#article-header-id-2">Setup the project</a></li><li><a href="#article-header-id-3">Creating the front end</a></li><li><a href="#article-header-id-4">The FaunaDB JavaScript driver</a></li><li><a href="#article-header-id-5">Creating data</a></li><li><a href="#article-header-id-6">Securing your data with UDFs and ABAC roles</a></li><li><a href="#article-header-id-7">How to implement authentication</a></li><li><a href="#article-header-id-8">Adding Cloudinary for media</a></li><li><a href="#article-header-id-9">Retrieving data</a></li><li><a href="#article-header-id-10">More in the code base</a></li></ul>



<p>We build these features without having to configure operations or set up servers for your database. Since both Cloudinary and FaunaDB are scalable and distributed out-of-the-box, we will never have to worry about setting up servers in multiple regions to achieve low latencies for users in other countries.&nbsp;</p>



<p>Let’s dive in!</p>



<h3>Modeling the data&nbsp;</h3>



<p>Before we can show how FaunaDB excels at relations, we need to cover the types of relations in our application&#8217;s data model. FaunaDB&#8217;s data entities are stored in documents, which are then stored in collections&#8211;like rows in tables. For example, each user&#8217;s details will be represented by a User document stored in a Users collection. And we eventually plan to support both single sign-on and password-based login methods for a single user, each of which will be represented as an Account document in an Accounts collection.</p>



<p>At this point, one user has one account, so it doesn’t matter which entity stores the reference (i.e., the user ID). We could have stored the user ID in either the Account or the User document in a one-to-one relation:</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/1to1.png?fit=1024%2C82&amp;ssl=1" alt="" class="wp-image-307191" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/1to1.png?w=1600&amp;ssl=1 1600w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/1to1.png?resize=300%2C24&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/1to1.png?resize=1024%2C82&amp;ssl=1 1024w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/1to1.png?resize=768%2C61&amp;ssl=1 768w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/1to1.png?resize=1536%2C123&amp;ssl=1 1536w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/1to1.png?resize=1000%2C80&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /><figcaption>One-to-one</figcaption></figure>



<p>However, since one User will eventually have multiple Accounts (or authentication methods), we&#8217;ll have a one-to-many model.</p>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/1to.png?fit=1024%2C172&amp;ssl=1" alt="" class="wp-image-307192" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/1to.png?w=1600&amp;ssl=1 1600w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/1to.png?resize=300%2C50&amp;ssl=1 300w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/1to.png?resize=1024%2C172&amp;ssl=1 1024w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/1to.png?resize=768%2C129&amp;ssl=1 768w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/1to.png?resize=1536%2C257&amp;ssl=1 1536w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/1to.png?resize=1000%2C168&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /><figcaption>One-to-many</figcaption></figure>



<p>In a one-to-many relation between Users and Accounts, each Account points to only one user, so it makes sense to store the User reference on the Account:</p>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/accounts-users.png?fit=1024%2C367&amp;ssl=1" alt="" class="wp-image-307193" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/accounts-users.png?w=1600&amp;ssl=1 1600w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/accounts-users.png?resize=300%2C107&amp;ssl=1 300w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/accounts-users.png?resize=1024%2C367&amp;ssl=1 1024w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/accounts-users.png?resize=768%2C275&amp;ssl=1 768w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/accounts-users.png?resize=1536%2C550&amp;ssl=1 1536w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/accounts-users.png?resize=1000%2C358&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>We also have many-to-many relations, like the relations between Fweets and Users, because of the complex ways users interact with each other via likes, comments, and refweets.&nbsp;</p>



<figure class="wp-block-image size-large"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/CpvhwCDEL9x-yDFdSpc3XRd967fQRoASZAHS709rxbRwaYuJ-ZprfAI2FiUBQ03l_UF1MATncTMC-3Hkl9iUDOVZA3lQhx4rWVxWXjGKm98quTKlztvU9BxaJzcJZIfkW_MPOsk.png?fit=1024%2C172&amp;ssl=1" alt="" class="wp-image-307194" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/CpvhwCDEL9x-yDFdSpc3XRd967fQRoASZAHS709rxbRwaYuJ-ZprfAI2FiUBQ03l_UF1MATncTMC-3Hkl9iUDOVZA3lQhx4rWVxWXjGKm98quTKlztvU9BxaJzcJZIfkW_MPOsk.png?w=1600&amp;ssl=1 1600w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/CpvhwCDEL9x-yDFdSpc3XRd967fQRoASZAHS709rxbRwaYuJ-ZprfAI2FiUBQ03l_UF1MATncTMC-3Hkl9iUDOVZA3lQhx4rWVxWXjGKm98quTKlztvU9BxaJzcJZIfkW_MPOsk.png?resize=300%2C50&amp;ssl=1 300w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/CpvhwCDEL9x-yDFdSpc3XRd967fQRoASZAHS709rxbRwaYuJ-ZprfAI2FiUBQ03l_UF1MATncTMC-3Hkl9iUDOVZA3lQhx4rWVxWXjGKm98quTKlztvU9BxaJzcJZIfkW_MPOsk.png?resize=1024%2C172&amp;ssl=1 1024w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/CpvhwCDEL9x-yDFdSpc3XRd967fQRoASZAHS709rxbRwaYuJ-ZprfAI2FiUBQ03l_UF1MATncTMC-3Hkl9iUDOVZA3lQhx4rWVxWXjGKm98quTKlztvU9BxaJzcJZIfkW_MPOsk.png?resize=768%2C129&amp;ssl=1 768w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/CpvhwCDEL9x-yDFdSpc3XRd967fQRoASZAHS709rxbRwaYuJ-ZprfAI2FiUBQ03l_UF1MATncTMC-3Hkl9iUDOVZA3lQhx4rWVxWXjGKm98quTKlztvU9BxaJzcJZIfkW_MPOsk.png?resize=1536%2C257&amp;ssl=1 1536w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/CpvhwCDEL9x-yDFdSpc3XRd967fQRoASZAHS709rxbRwaYuJ-ZprfAI2FiUBQ03l_UF1MATncTMC-3Hkl9iUDOVZA3lQhx4rWVxWXjGKm98quTKlztvU9BxaJzcJZIfkW_MPOsk.png?resize=1000%2C168&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /><figcaption>Many-to-many</figcaption></figure>



<p>Further, we will use a third collection, Fweetstats, to store information about the interaction between a User and a Fweet.</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/fweets-users2.png?fit=1024%2C218&amp;ssl=1" alt="" class="wp-image-307195" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/fweets-users2.png?w=1600&amp;ssl=1 1600w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/fweets-users2.png?resize=300%2C64&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/fweets-users2.png?resize=1024%2C218&amp;ssl=1 1024w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/fweets-users2.png?resize=768%2C164&amp;ssl=1 768w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/fweets-users2.png?resize=1536%2C327&amp;ssl=1 1536w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/fweets-users2.png?resize=1000%2C213&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>Fweetstats&#8217; data will help us determine, for example, whether or not to color the icons indicating to&nbsp; the user that he has already liked, commented, or refweeted a Fweet. It also helps us determine what clicking on the heart means: unlike or like.</p>



<figure class="wp-block-image size-large"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/icons.png?ssl=1" alt="" class="wp-image-307196" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/icons.png?w=644&amp;ssl=1 644w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/icons.png?resize=300%2C107&amp;ssl=1 300w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>The final model for the application will look like this:&nbsp;</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/model.png?fit=1024%2C950&amp;ssl=1" alt="" class="wp-image-307197" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/model.png?w=1600&amp;ssl=1 1600w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/model.png?resize=300%2C278&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/model.png?resize=1024%2C950&amp;ssl=1 1024w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/model.png?resize=768%2C713&amp;ssl=1 768w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/model.png?resize=1536%2C1426&amp;ssl=1 1536w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/model.png?resize=1000%2C928&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /><figcaption>The application model of the fwitter application</figcaption></figure>



<p>Fweets are the center of the model, because they contain the most important data of the Fweet such as the information about the message, the number of likes, refweets, comments, and the Cloudinary media that was attached. FaunaDB stores this data in a json format that looks like this:&nbsp;</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/example_fweet.png?fit=1024%2C511&amp;ssl=1" alt="" class="wp-image-307198" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/example_fweet.png?w=1069&amp;ssl=1 1069w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/example_fweet.png?resize=300%2C150&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/example_fweet.png?resize=1024%2C511&amp;ssl=1 1024w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/example_fweet.png?resize=768%2C383&amp;ssl=1 768w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/example_fweet.png?resize=1000%2C499&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>As shown in the model and in this example json, hashtags are stored as a list of references. If we wanted to, we <strong>could </strong>have stored the complete hashtag json in here, and that is the preferred solution in more limited document-based databases that lack relations. However, that would mean that our hashtags would be duplicated everywhere (as they are in more limited databases) and it would be more difficult to search for hashtags and/or retrieve Fweets for a specific hashtag as shown below.</p>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/fwitter.png?fit=1024%2C366&amp;ssl=1" alt="" class="wp-image-307317" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/fwitter.png?w=1686&amp;ssl=1 1686w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/fwitter.png?resize=300%2C107&amp;ssl=1 300w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/fwitter.png?resize=1024%2C366&amp;ssl=1 1024w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/fwitter.png?resize=768%2C274&amp;ssl=1 768w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/fwitter.png?resize=1536%2C548&amp;ssl=1 1536w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/fwitter.png?resize=1000%2C357&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>Note that a Fweet does not contain a link to Comments, but the Comments collection contains a reference to the Fweet. That&#8217;s because one Comment belongs to one Fweet, but a Fweet can have many comments&#8211;similar to the one-to-many relation between Users and Accounts.</p>



<p>Finally, there is a FollowerStats collection which basically saves information about how much users interact with each other in order to personalize their respective feeds. We won&#8217;t cover that much in this article, but you can experiment with the queries in the <a href="https://github.com/fauna-brecht/fwitter">source code</a> and <a href="https://fauna.com/blog">stay tuned</a> for a future article on advanced indexing.</p>



<p>Hopefully, you&#8217;re starting to see why we chose something more complex than a ToDo app. Although Fwitter&nbsp; is nowhere near the complexity of the real Twitter app on which it&#8217;s based, it&#8217;s already becoming apparent that implementing such an application without relations would be a serious brainbreaker.&nbsp;</p>



<p>Now, if you haven&#8217;t already done so from the github repo, it&#8217;s finally time to get our project running locally!</p>



<h3>Setup the project</h3>



<p>To set up the project, go to the <a href="https://dashboard.fauna.com/">FaunaDB</a> dashboard and sign up. Once you are in the dashboard, click on <strong>New Database</strong>, fill in a name, and click <strong>Save</strong>. You should now be on the &#8220;Overview&#8221; page of your new database.&nbsp;</p>



<p>Next, we need a key that we will use in our setup scripts. Click on the Security tab in the left sidebar, then click the <strong>New key </strong>button.&nbsp;</p>



<p>In the &#8220;New key&#8221; form, the current database should already be selected. For &#8220;Role&#8221;, leave it as &#8220;Admin&#8221;. Optionally, add a key name. Next, click <strong>Save </strong>and copy the key secret displayed on the next page. It will not be displayed again.</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0.png?ssl=1" alt="" class="wp-image-307201" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0.png?w=837&amp;ssl=1 837w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0.png?resize=300%2C218&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0.png?resize=768%2C559&amp;ssl=1 768w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>Now that you have your database secret, clone the <a href="https://github.com/fauna-brecht/fwitter">git repository</a> and follow the readme. We have prepared a few scripts so that you only have to run the following commands to initialize your app, create all collections, and populate your database. The scripts will give you further instructions:</p>



<pre rel="Terminal" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">// install node modules
npm install
// run setup, this will create all the resources in your database
// provide the admin key when the script asks for it. 
// !!! the setup script will give you another key, this is a key
// with almost no permissions that you need to place in your .env.local as the
// script suggestions

npm run setup
npm run populate
 
// start the frontend</code></pre>



<p>After the script, your .env.local file should contain the bootstrap key that the script provided you (not the admin key)</p>



<pre rel=" " class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">REACT_APP_LOCAL___BOOTSTRAP_FAUNADB_KEY=&lt;bootstrap key></code></pre>



<p>You can optionally create an account with Cloudinary and add your cloudname and a public template (there is a default template called ‘ml_default’ which you can make public) to the environment to include images and videos in the fweets.&nbsp;</p>



<pre rel=" " class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">REACT_APP_LOCAL___CLOUDINARY_CLOUDNAME=&lt;cloudinary cloudname>
REACT_APP_LOCAL___CLOUDINARY_TEMPLATE=&lt;cloudinary template></code></pre>



<p>Without these variables, the include media button will not work, but the rest of the app should run fine:</p>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-2.png?ssl=1" alt="" class="wp-image-307202" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-2.png?w=669&amp;ssl=1 669w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-2.png?resize=300%2C91&amp;ssl=1 300w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<h3>Creating the front end</h3>



<figure class="wp-block-image size-full is-resized"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-3.png?resize=290%2C412&#038;ssl=1" alt="" class="wp-image-307203" width="290" height="412" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-3.png?w=387&amp;ssl=1 387w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-3.png?resize=211%2C300&amp;ssl=1 211w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>For the frontend, we used Create React App to generate an application, then divided the application into pages and components. Pages are top-level components which have their own URLs. The Login and Register pages speak for themselves. Home is the standard feed of Fweets from the authors we follow; this is the page that we see when we log into our account. And the User and Tag pages show the Fweets for a specific user or tag in reverse chronological order.&nbsp;</p>



<p>We use React Router to direct to these pages depending on the URL, as you can see in the <a href="https://github.com/fauna-brecht/fwitter/blob/master/src/app.js"><code>src/app.js</code></a> file.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">&lt;Router>
  &lt;SessionProvider value={{ state, dispatch }}>
    &lt;Layout>
      &lt;Switch>
        &lt;Route exact path="/accounts/login">
          &lt;Login />
        &lt;/Route>
        &lt;Route exact path="/accounts/register">
          &lt;Register />
        &lt;/Route>
        &lt;Route path="/users/:authorHandle" component={User} />
        &lt;Route path="/tags/:tag" component={Tag} />
        &lt;Route path="/">
          &lt;Home />
        &lt;/Route>
      &lt;/Switch>
    &lt;/Layout>
  &lt;/SessionProvider>
&lt;/Router></code></pre>



<p>The only other thing to note in the above snippet is the SessionProvider, which is a React context to store the user&#8217;s information upon login. We’ll revisit this in the authentication section. For now, it’s enough to know that this gives us access to the Account (and thus User) information from each component.</p>



<p>Take a quick look at the home page (<a href="https://github.com/fauna-brecht/fwitter/blob/master/src/pages/home.js"><code>src/pages/home.js</code></a>) to see how we use a combination of hooks to manage our data. The bulk of our application&#8217;s logic is implemented in FaunaDB queries which live in the <a href="https://github.com/fauna-brecht/fwitter/tree/master/src/fauna/queries"><code>src/fauna/querie</code>s</a> folder. All calls to the database pass through the <a href="https://github.com/fauna-brecht/fwitter/blob/master/src/fauna/query-manager.js">query-manager</a>, which in a future article, we&#8217;ll refactor into serverless function calls. But for now these calls originate from the frontend and we&#8217;ll secure the sensitive parts of it with FaunaDB’s ABAC security rules and User Defined Functions (UDF). Since FaunaDB behaves as a token-secured API, <a href="https://medium.com/swlh/databases-that-play-nice-with-your-serverless-backend-13eb7dc1e1c">we do not have to worry</a> about a limit on the amount of connections as we would in traditional databases.&nbsp;</p>



<h3>The FaunaDB JavaScript driver</h3>



<p>Next, take a look at the <a href="https://github.com/fauna-brecht/fwitter/blob/master/src/fauna/query-manager.js"><code>src/fauna/query-manager.js</code></a> file to see how we connect FaunaDB to our application using FaunaDB&#8217;s JavaScript driver, which is just a <a href="https://docs.fauna.com/fauna/current/drivers/javascript.html">node module</a> we pulled with `npm install`. As with any node module, we import it into our application as so:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import faunadb from 'faunadb'</code></pre>



<p>And create a client by providing a token.&nbsp;</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">this.client = new faunadb.Client({
  secret: token || this.bootstrapToken
})</code></pre>



<p>We&#8217;ll cover tokens a little more in the Authentication section. For now, let&#8217;s create some data!&nbsp;</p>



<h3>Creating data</h3>



<p>The logic to create a new Fweet document can be found in the <a href="https://github.com/fauna-brecht/fwitter/blob/master/src/fauna/queries/fweets.js"><code>src/fauna/queries/fweets.js</code></a> file. FaunaDB documents are just like JSON, and each Fweet follows the same basic structure:&nbsp;</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const data = {
  data: {
   message: message,
   likes: 0,
   refweets: 0,
   comments: 0,
   created: Now()
  }
}</code></pre>



<p>The <code>Now()</code><strong> </strong>function is used to insert the time of the query so that the Fweets in a user&#8217;s feed can be sorted chronologically. Note that FaunaDB automatically places timestamps on every database entity <a href="https://docs.fauna.com/fauna/current/api/fql/functions/at">for temporal querying</a>. However, the FaunaDB timestamp represents the time the document was last updated, not the time it was created, and the document gets updated every time a Fweet is liked; for our intended sorting order, we need the created time.&nbsp;</p>



<p>Next, we send this data to FaunaDB with the <strong>Create() </strong>function. By providing <code>Create()</code> with the reference to the Fweets collection using <code>Collection(‘fweets’)</code><strong>, </strong>we specify where the data needs to go.&nbsp;</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const query = Create(Collection('fweets'), data )</code></pre>



<p>We can now wrap this query in a function that takes a message parameter and executes it using <code>client.query()</code><strong> </strong>which will send the query to the database. Only when we call <code>client.query()</code> will the query be sent to the database and executed. Before that, we combine as many FQL functions as we want to construct our query.&nbsp;</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">function createFweet(message, hashtags) {
   const data = …
   const query = …
   return client.query(query)
}</code></pre>



<p>Note that we have used plain old JavaScript variables to compose this query and in essence just called functions. Writing FQL is all about function composition; you construct queries by combining small functions into larger expressions. This functional approach has very strong advantages. It allows us to use native language features such as JavaScript variables to compose queries, while also writing higher-order FQL functions that are protected from injection.</p>



<p>For example, in the query below, we add hashtags to the document with a <code>CreateHashtags()</code> function that we&#8217;ve defined elsewhere using FQL.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const data = {
  data: {
    // ...
    hashtags: CreateHashtags(tags),
    likes: 0,
    // ... 
}</code></pre>



<p>The way FQL works from within the driver&#8217;s host language (in this case, JavaScript) is what makes FQL an eDSL (embedded domain-specific language). Functions like <code>CreateHashtags()</code> behave just like a native FQL function in that they are both just functions that take input. This means that we can easily extend the language with our own functions, like in <a href="https://github.com/shiftx/faunadb-fql-lib">this open source FQL library</a> from the Fauna community.&nbsp;</p>



<p>It’s also important to notice that we create two entities in two different collections, in one transaction. Thus, if/when things go wrong, there is no risk that the Fweet is created yet the Hashtags are not. In more technical terms, FaunaDB is transactional and consistent whether you run queries over multiple collections or not, a property <a href="https://css-tricks.com/consistent-backends-and-ux:-why-should-you-care/">that is rare</a> in scalable distributed databases.&nbsp;</p>



<p>Next, we need to add the author to the query. First, we can use the<strong> </strong><code>Identity()</code> FQL function to return a reference to the currently logged in document. As discussed previously in the data modeling section, that document is of the type Account and is separated from Users to support SSO in a later phase.</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-4.png?ssl=1" alt="" class="wp-image-307206" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-4.png?w=635&amp;ssl=1 635w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-4.png?resize=300%2C121&amp;ssl=1 300w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>Then, we need to wrap <code>Identity()</code> in a <code>Get()</code> to access the full Account document and not just the reference to it.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">Get(Identity()) </code></pre>



<p>Finally, we wrap all of that in a <code>Select()</code> to select the <code>data.user</code> field from the account document and add it to the data JSON.&nbsp;</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const data = {
  data: {
    // ...
    hashtags: CreateHashtags(tags),
    author: Select(['data', 'user'], Get(Identity())),
    likes: 0,
    // ...
  }
}</code></pre>



<p>Now that we&#8217;ve constructed the query, let&#8217;s pull it all together and call <code>client.query(query)</code> to execute it.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">function createFweet(message, hashtags) {
 const data = {
   data: {
     message: message,
     likes: 0,
     refweets: 0,
     comments: 0,
     author: Select(['data', 'user'], Get(Identity())),
     hashtags: CreateHashtags(tags),
     created: Now()
   }
 }
 
 const query = Create(Collection('fweets'), data )
 return client.query(query)
}</code></pre>



<p>By using functional composition, you can easily combine all your advanced logic in one query that will be executed in one transaction. Check out the file <a href="https://github.com/fauna-brecht/fwitter/blob/master/src/fauna/queries/fweets.js"><code>src/fauna/queries/fweets.js</code></a> to see the final result which takes even more advantage of function composition to add rate-limiting, etc.&nbsp;</p>



<h3>Securing your data with UDFs and ABAC roles</h3>



<p>The attentive reader will have some thoughts about security by now. We are essentially creating queries in JavaScript and calling these queries from the frontend. What stops a malicious user from altering these queries?&nbsp;</p>



<p>FaunaDB provides two features that allow us to secure our data: Attribute-Based Access Control (<a href="https://docs.fauna.com/fauna/current/security/abac.html">ABAC</a>) and User Defined Functions (<a href="https://docs.fauna.com/fauna/current/api/graphql/functions">UDF</a>). With ABAC, we can control which collections or entities that a specific key or token can access by writing Roles.&nbsp;</p>



<p>With UDFs, we can push FQL statements to the database by using the <strong><code>CreateFunction()</code>.</strong>&nbsp;</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">CreateFunction({ 
  name: 'create_fweet', 
  body: &lt;your FQL statement>, 
})</code></pre>



<p>Once the function is in the database as a UDF, where the application can&#8217;t alter it anymore, we then call this UDF from the front end.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">client.query(
  Call(Function('create_fweet'), message, hashTags)
)</code></pre>



<p>Since the query is now saved on the database (just like a stored procedure), the user can no longer manipulate it.&nbsp;</p>



<p>One example of how UDFs can be used to secure a call is that we <strong>do not </strong>pass in the author of the Fweet. The author of the Fweet is derived from the Identity() function instead, which makes it impossible for a user to write a Fweet on someone’s behalf.</p>



<p>Of course, we still have to define that the user has access to call the UDF. For that, we will use a very simple ABAC role that defines a group of role members and their privileges. This role will be named <code>logged_in_role</code>, its membership will include all of the documents in the Accounts collection, and all of these members will be granted the privilege of calling the <code>create_fweet</code> UDF.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">CreateRole(
  name: 'logged_in_role', 
  privileges: [
   {
     resource: q.Function('create_fweet'),
     actions: {
       call: true
     }
   }
  ],
  membership: [{ resource: Collection('accounts') }],
)</code></pre>



<p>We now know that these privileges are granted to an account, but how do we ‘become’ an Account? By using the FaunaDB <strong>Login() </strong>function to authenticate our users as explained in the next section.</p>



<h3>How to implement authentication in FaunaDB</h3>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/N0KK_l2xJSc7boO1-69_9Ui045ETlEVqqa6Nsh2A4o6skkpxkW9zNy8J694HPde1ZnqJ7jGnOc2XVHRnToZocAsQ6BIqos3ioS-zFhgRAz3efqXQxWR3UoZuxExsSn9bA4_ehu0.png?ssl=1" alt="" class="wp-image-307207" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/N0KK_l2xJSc7boO1-69_9Ui045ETlEVqqa6Nsh2A4o6skkpxkW9zNy8J694HPde1ZnqJ7jGnOc2XVHRnToZocAsQ6BIqos3ioS-zFhgRAz3efqXQxWR3UoZuxExsSn9bA4_ehu0.png?w=677&amp;ssl=1 677w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/N0KK_l2xJSc7boO1-69_9Ui045ETlEVqqa6Nsh2A4o6skkpxkW9zNy8J694HPde1ZnqJ7jGnOc2XVHRnToZocAsQ6BIqos3ioS-zFhgRAz3efqXQxWR3UoZuxExsSn9bA4_ehu0.png?resize=300%2C136&amp;ssl=1 300w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>We just showed a role that gives Accounts the permissions to call the <code>create_fweets</code> function. But how do we &#8220;become&#8221; an Account?.</p>



<p>First, we create a new Account document, storing credentials alongside any other data associated with the Account (in this case, the email address and the reference to the User).</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">return Create(Collection('accounts'), {
  credentials: { password: password },
    data: {
      email: email,
      user: Select(['ref'], Var('user'))
    }
  })
}</code></pre>



<p>We can then call <strong><code>Login()</code></strong> on the Account reference, which retrieves a token.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">Login(
 Match( &lt; Account reference > ,
    { password: password }
 )
)</code></pre>



<p>We use this token in the client to impersonate the Account. Since all Accounts are members of the Account collection, this token fulfills the membership requirement of the <code>logged_in_role</code> and is granted access to call the <code>create_fweet</code> UDF.</p>



<p>To bootstrap this whole process, we have two very important roles.</p>



<ul><li><code>bootstrap_role</code>: can only call the <code>login</code> and <code>register</code> UDFs</li><li><code>logged_in_role</code>: can call other functions such as <code>create_fweet</code></li></ul>



<p>The token you received when you ran the setup script is essentially a key created with the <code>bootstrap_role</code>. A client is created with that token in <a href="https://github.com/fauna-brecht/fwitter/blob/master/src/fauna/query-manager.js"><code>src/fauna/query-manager.js</code></a> which will only be able to register or login. Once we log in, we use the new token returned from <code>Login()</code> to create a new FaunaDB client which now grants access to other UDF functions such as <code>create_fweet</code>. Logging out means we just revert to the bootstrap token. You can see this process in the <a href="https://github.com/fauna-brecht/fwitter/blob/master/src/fauna/query-manager.js"><code>src/fauna/query-manager.js</code></a>, along with more complex role examples in the <a href="https://github.com/fauna-brecht/fwitter/blob/master/src/fauna/setup/roles.js"><code>src/fauna/setup/roles.js</code></a> file.&nbsp;</p>



<h4>How to implement the session in React</h4>



<p>Previously, in the &#8220;Creating the front end&#8221; section, we mentioned the <code>SessionProvider</code> component. In React, providers belong to a React Context which is a concept to facilitate data sharing between different components. This is ideal for data such as user information that you need everywhere in your application. By inserting the <code>SessionProvider</code> in the HTML early on, we made sure that each component would have access to it. Now, the only thing a component has to do to access the user details is import the context and use React’s ‘useContext’ hook.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import SessionContext from '../context/session'
import React, { useContext } from 'react'

// In your component
const sessionContext = useContext(SessionContext)
const { user } = sessionContext.state</code></pre>



<p>But how does the user end up in the context? When we included the SessionProvider, we passed in a value consisting of the current state and a dispatch function.&nbsp;</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const [state, dispatch] = React.useReducer(sessionReducer, { user: null })
// ...
&lt;SessionProvider value={{ state, dispatch }}></code></pre>



<p>The state is simply the current state, and the dispatch function is called to modify the context. This dispatch function is actually the core of the context since creating a context only involves calling <code>React.createContext()</code> which will give you access to a <code>Provider</code> and a <code>Consumer</code>.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const SessionContext = React.createContext({})
export const SessionProvider = SessionContext.Provider
export const SessionConsumer = SessionContext.Consumer
export default SessionContext</code></pre>



<p>We can see that the state and dispatch are extracted from something that React calls a reducer (using <code>React.useReducer</code>), so let&#8217;s write a reducer.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">export const sessionReducer = (state, action) => {
 switch (action.type) {
   case 'login': {
     return { user: action.data.user }
   }
   case 'register': {
     return { user: action.data.user }
   }
   case 'logout': {
     return { user: null }
   }
   default: {
     throw new Error(`Unhandled action type: ${action.type}`)
   }
 }
}</code></pre>



<p>This is the logic that allows you to change the context. In essence, it receives an action and decides how to modify the context given that action. In my case, the action is simply a type with a string. We use this context to keep user information, which means that we call it on a successful login with:&nbsp;</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">sessionContext.dispatch({ type: 'login', data: e })</code></pre>



<h3>Adding Cloudinary for media&nbsp;</h3>



<p>When we created a Fweet, we did not take into account assets yet. FaunaDB is meant to store application data, not image blobs or video data. However, we can easily store the media on Cloudinary and just keep a link in FaunaDB. The following inserts the Cloudinary script (in <code>app.js</code>):</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">loadScript('https://widget.cloudinary.com/v2.0/global/all.js')</code></pre>



<p>We then create a Cloudinary Upload Widget (in <a href="https://github.com/fauna-brecht/fwitter/blob/master/src/components/uploader.js"><code>src/components/uploader.js</code></a>):</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">window.cloudinary.createUploadWidget(
  {
    cloudName: process.env.REACT_APP_LOCAL___CLOUDINARY_CLOUDNAME,
    uploadPreset: process.env.REACT_APP_LOCAL___CLOUDINARY_TEMPLATE,
  },
  (error, result) => {
    // ...
  }
)</code></pre>



<p>As mentioned earlier, you need to provide a Cloudinary cloud name and template in the environment variables (<code>.env.local</code> file) to use this feature. Creating a Cloudinary account is free and once you have an account you can grab the cloud name from the <code>dashboard</code>.</p>



<figure class="wp-block-image size-large"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-5.png?ssl=1" alt="" class="wp-image-307209" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-5.png?w=930&amp;ssl=1 930w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-5.png?resize=300%2C83&amp;ssl=1 300w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-5.png?resize=768%2C212&amp;ssl=1 768w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>You have the option to use API keys as well to secure uploads. In this case, we upload straight from the front end so the upload uses a public template. To add a template or modify it to make it public, click on the <strong>gear</strong> icon in the top menu, go to <strong>Upload</strong> tab, and click <strong>Add upload preset</strong>.&nbsp;</p>



<p>You could also edit the ml_default template and just make it public.</p>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/dVyNXh4E12mxZV7zLw47ylAUrIVxs__4vHS74ZdhsPvneEnrxvvqnqS-W3mE1YTI81yLv5nzaQuSbZSEekg5uv3DUS4PLRuomfReSRdtwNDKjirC3_Lt6s-XJRTsus-4_u67EY.png?ssl=1" alt="" class="wp-image-307210" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/dVyNXh4E12mxZV7zLw47ylAUrIVxs__4vHS74ZdhsPvneEnrxvvqnqS-W3mE1YTI81yLv5nzaQuSbZSEekg5uv3DUS4PLRuomfReSRdtwNDKjirC3_Lt6s-XJRTsus-4_u67EY.png?w=651&amp;ssl=1 651w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/04/dVyNXh4E12mxZV7zLw47ylAUrIVxs__4vHS74ZdhsPvneEnrxvvqnqS-W3mE1YTI81yLv5nzaQuSbZSEekg5uv3DUS4PLRuomfReSRdtwNDKjirC3_Lt6s-XJRTsus-4_u67EY.png?resize=300%2C46&amp;ssl=1 300w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>Now, we just call <code>widget.open()</code> when our media button is clicked.</p>



<pre rel="HTML" class="wp-block-csstricks-code-block language-markup" data-line=""><code markup="tt">const handleUploadClick = () => {
  widget.open()
}
 
return (
  &lt;div>
    &lt;FontAwesomeIcon icon={faImage} onClick={handleUploadClick}>&lt;/FontAwesomeIcon>
  &lt;/div>
)</code></pre>



<p>This provides us with a small media button that will open the Cloudinary Upload Widget when it’s clicked.&nbsp;</p>



<figure class="wp-block-image size-large ticss-13a5e520"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-6.png?ssl=1" alt="" class="wp-image-307211" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-6.png?w=830&amp;ssl=1 830w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-6.png?resize=292%2C300&amp;ssl=1 292w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-6.png?resize=768%2C788&amp;ssl=1 768w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>When we create the widget, we can also provide styles and fonts to give it the look and feel of our own application as we did above (in <a href="https://github.com/fauna-brecht/fwitter/blob/master/src/components/uploader.js"><code>src/components/uploader.js</code></a>):&nbsp;</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const widget = window.cloudinary.createUploadWidget(
   {
     cloudName: process.env.REACT_APP_LOCAL___CLOUDINARY_CLOUDNAME,
     uploadPreset: process.env.REACT_APP_LOCAL___CLOUDINARY_TEMPLATE,
     styles: {
       palette: {
         window: '#E5E8EB',
         windowBorder: '#4A4A4A',
         tabIcon: '#000000',
         // ...
       },
       fonts: {</code></pre>



<p><br>Once we have uploaded media to Cloudinary, we receive a bunch of information about the uploaded media, which we then add to the data when we create a Fweet.</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-7.png?fit=1024%2C519&amp;ssl=1" alt="" class="wp-image-307212" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-7.png?w=1054&amp;ssl=1 1054w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-7.png?resize=300%2C152&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-7.png?resize=1024%2C519&amp;ssl=1 1024w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-7.png?resize=768%2C389&amp;ssl=1 768w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-7.png?resize=1000%2C507&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>We can then simply use the stored <strong><code>id</code></strong> (which Cloudinary refers to as the publicId) with the Cloudinary React library (in <a href="https://github.com/fauna-brecht/fwitter/blob/master/src/components/asset.js"><code>src/components/asset.js</code></a>):</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import { Image, Video, Transformation } from 'cloudinary-react'</code></pre>



<p>To show the image in our feed.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">&lt;div className="fweet-asset">
  &lt;Image publicId={asset.id} 
    cloudName={cloudName} fetchFormat="auto" quality="auto" secure="true" />
&lt;/div></code></pre>



<p>When you use the id, instead of the direct URL, Cloudinary does a whole range of optimizations to deliver the media in the most optimal format possible. For example when you add a video image as follows:</p>



<pre rel="HTML" class="wp-block-csstricks-code-block language-markup" data-line=""><code markup="tt">&lt;div className="fweet-asset">
  &lt;Video playsInline autoPlay loop={true} controls={true} cloudName={cloudName} publicId={publicId}>
    &lt;Transformation width="600" fetchFormat="auto" crop="scale" />
  &lt;/Video>
&lt;/div></code></pre>



<p>Cloudinary will automatically scale down the video to a width of 600 pixels and deliver it as a WebM (VP9) to Chrome browsers (482 KB), an MP4 (HEVC) to Safari browsers (520 KB), or an MP4 (H.264) to browsers that support neither format (821 KB). Cloudinary does these optimizations server-side, significantly improving page load time and the overall user experience.&nbsp;</p>



<h3>Retrieving data</h3>



<p>We have shown how to add data. Now we still need to retrieve data. Getting the data of our Fwitter feed has many challenges. We need to:&nbsp;</p>



<ul><li>Get fweets from people you follow in a specific order (taking time and popularity into account)</li><li>Get the author of the fweet to show his profile image and handle</li><li>Get the statistics to show how many likes, refweets and comments it has</li><li>Get the comments to list those beneath the fweet.&nbsp;</li><li>Get info about whether you already liked, refweeted, or commented on this specific fweet.&nbsp;</li><li>If it’s a refweet, get the original fweet.&nbsp;</li></ul>



<p>This kind of query fetches data from many different collections and requires advanced indexing/sorting, but let&#8217;s start off simple. How do we get the Fweets? We start off by getting a reference to the Fweets collection using the <strong><code>Collection()</code> </strong>function.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">Collection('fweets')</code></pre>



<p>And we wrap that in the <strong><code>Documents()</code> </strong>function to get all of the collection&#8217;s document references.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">Documents(Collection('fweets'))</code></pre>



<p>We then Paginate over these references.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">Paginate(Documents(Collection('fweets')))</code></pre>



<p><code>Paginate()</code> requires some explanation. Before calling <code>Paginate()</code>, we had a query that returned a hypothetical set of data. <code>Paginate()</code> actually materializes that data into pages of entities that we can read. FaunaDB requires that we use this <strong><code>Paginate()</code></strong> function to protect us from writing inefficient queries that retrieve every document from a collection, because in a database built for massive scale, that collection could contain millions of documents. Without the safeguard of Paginate(), that could get very expensive!</p>



<p>Let&#8217;s save this partial query in a plain JavaScript variable <code>references</code> that we can continue to build on.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const references = Paginate(Documents(Collection('fweets')))</code></pre>



<p>So far, our query only returns a list of references to our Fweets. To get the actual documents, we do exactly what we would do in JavaScript: map over the list with an anonymous function. In FQL, a Lambda is just an anonymous function.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const fweets = Map(
  references,
  Lambda(['ref'], Get(Var('ref')))
)</code></pre>



<p>This might seem verbose if you&#8217;re used to declarative query languages like SQL that declare <strong>what you want </strong>and let the database figure out how to get it. In contrast, FQL declares both <strong>what you want </strong>and <strong>how you want it </strong>which makes it more procedural. Since you&#8217;re the one defining how you want your data, and not the query engine, the price and performance impact of your query is predictable. You can exactly determine how many reads this query costs without executing it, which is a significant advantage if your database contains a huge amount of data and is pay-as-you-go. So there might be a learning curve, but it&#8217;s well worth it in the money and hassle it will save you. And once you learn how FQL works, you will find that queries read just like regular code.&nbsp;</p>



<p>Let’s prepare our query to be extended easily by introducing Let. Let will allow us to bind variables and reuse them immediately in the next variable binding, which allows you to structure your query more elegantly.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const fweets = Map(
 references,
 Lambda(
   ['ref'],
   Let(
     {
       fweet: Get(Var('ref'))
     },
     // Just return the fweet for now
     Var('fweet')
   )
 )
)</code></pre>



<p>Now that we have this structure, getting extra data is easy. So let’s get the author.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const fweets = Map(
 references,
 Lambda(
   ['ref'],
   Let(
     {
       fweet: Get(Var('ref')),
       author: Get(Select(['data', 'author'], Var('fweet')))
     },
     { fweet: Var('fweet'), author: Var('author') }
   )
 )
)</code></pre>



<p>Although we did not write a join, we have just joined Users (the author) with the Fweets. We&#8217;ll expand on these building blocks even further in a follow up article. Meanwhile, browse <a href="https://github.com/fauna-brecht/fwitter/blob/master/src/fauna/queries/fweets.js"><code>src/fauna/queries/fweets.js</code></a> to view the final query and several more examples.&nbsp;</p>



<h3>More in the code base</h3>



<p>If you haven&#8217;t already, please open the <a href="https://github.com/fauna-brecht/fwitter">code base</a> for this Fwitter example app. You will find a plethora of well-commented examples we haven&#8217;t explored here, but will in future articles. This section touches on a few files we think you should check out.</p>



<p>First, check out the <a href="https://github.com/fauna-brecht/fwitter/blob/master/src/fauna/queries/fweets.js"><code>src/fauna/<strong>queries</strong>/fweets.js</code></a> file for examples of how to do complex matching and sorting with FaunaDB&#8217;s indexes (the indexes are created in <a href="https://github.com/fauna-brecht/fwitter/blob/master/src/fauna/setup/fweets.js"><code>src/fauna/<strong>setup</strong>/fweets.js</code></a>). We implemented three different access patterns to get Fweets by popularity and time, by handle, and by tag.</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/access_paths.png?fit=1024%2C602&amp;ssl=1" alt="" class="wp-image-307214" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/access_paths.png?w=1600&amp;ssl=1 1600w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/access_paths.png?resize=300%2C176&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/access_paths.png?resize=1024%2C602&amp;ssl=1 1024w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/access_paths.png?resize=768%2C451&amp;ssl=1 768w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/access_paths.png?resize=1536%2C902&amp;ssl=1 1536w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/access_paths.png?resize=1000%2C588&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>Getting Fweets by popularity and time is a particularly interesting access pattern because it actually sorts the Fweets by a sort of decaying popularity based on users&#8217; interactions with each other.&nbsp;</p>



<p>Also, check out <a href="https://github.com/fauna-brecht/fwitter/blob/master/src/fauna/queries/search.js"><code>src/fauna/queries/search.js</code></a>, where we&#8217;ve implemented autocomplete based on FaunaDB <a href="https://docs.fauna.com/fauna/current/api/fql/indexes">indexes</a> and index <a href="https://docs.fauna.com/fauna/current/tutorials/indexes/bindings.html">bindings</a> to search for authors and tags. Since FaunaDB can index over multiple collections, we can write one index that supports an autocomplete type of search on both Users and Tags.</p>



<figure class="wp-block-image size-large ticss-6af4c1bc"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-8.png?ssl=1" alt="" class="wp-image-307215" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-8.png?w=373&amp;ssl=1 373w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/pasted-image-0-8.png?resize=193%2C300&amp;ssl=1 193w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>We&#8217;ve implemented these examples because the combination of flexible and powerful indexes with relations is rare for scalable distributed databases. Databases that lack relations and flexible indexes require you to <strong>know</strong> in advance how your data will be accessed and you will run into problems when your business logic needs to change to accommodate your clients&#8217; evolving use cases.</p>



<p>In FaunaDB, if you did not foresee a specific way that you’d like to access your data, no worries — just add an Index! We have range indexes, term indexes, and composite indexes that can be specified whenever you want without having to code around eventual consistency.&nbsp;</p>



<h3>A preview of what’s to come&nbsp;</h3>



<p>As mentioned in the introduction, we&#8217;re introducing this Fwitter app to demonstrate complex, real-world use cases. That said, a few features are still missing and will be covered in future articles, including streaming, pagination, benchmarks, and a more advanced security model with short-lived tokens, JWT tokens, single sign-on (possibly using a service like Auth0), IP-based rate limiting (with Cloudflare workers), e-mail verification (with a service like SendGrid), and HttpOnly cookies.</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/stack3.png?fit=1024%2C673&amp;ssl=1" alt="" class="wp-image-307216" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/stack3.png?w=1600&amp;ssl=1 1600w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/stack3.png?resize=300%2C197&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/stack3.png?resize=1024%2C673&amp;ssl=1 1024w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/stack3.png?resize=768%2C505&amp;ssl=1 768w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/stack3.png?resize=1536%2C1010&amp;ssl=1 1536w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/04/stack3.png?resize=1000%2C658&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>The end result will be a stack that relies on services and serverless functions which is very similar to a dynamic JAMstack app, minus the static site generator. Stay tuned for the follow-up articles and make sure to subscribe to the <a href="https://fauna.com/blog">Fauna</a> blog and monitor CSS-Tricks for more FaunaDB-related articles.&nbsp;</p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/rethinking-twitter-as-a-serverless-app/">Rethinking Twitter as a Serverless App</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://css-tricks.com/rethinking-twitter-as-a-serverless-app/feed/</wfw:commentRss>
			<slash:comments>9</slash:comments>
		
		<enclosure url="https://css-tricks.com/wp-content/uploads/2020/04/twitterapp_walkthrough.mp4" length="14003637" type="video/mp4" />

		<post-id xmlns="com-wordpress:feed-additions:1">307188</post-id>	</item>
		<item>
		<title>Building a Real-Time Chat App with React and Firebase</title>
		<link>https://css-tricks.com/building-a-real-time-chat-app-with-react-and-firebase/</link>
					<comments>https://css-tricks.com/building-a-real-time-chat-app-with-react-and-firebase/#comments</comments>
		
		<dc:creator><![CDATA[Deven Rathore]]></dc:creator>
		<pubDate>Mon, 23 Mar 2020 14:37:08 +0000</pubDate>
				<category><![CDATA[Article]]></category>
		<category><![CDATA[authentication]]></category>
		<category><![CDATA[firebase]]></category>
		<category><![CDATA[react]]></category>
		<guid isPermaLink="false">https://css-tricks.com/?p=305248</guid>

					<description><![CDATA[<p>In this article, we’ll cover key concepts for authenticating a user with Firebase in a real-time chat application. We’ll integrate third-party auth providers (e.g. Google, Twitter and GitHub) and, once users are signed in, we’ll learn how to store user chat data in the <a href="https://firebase.google.com/docs/database/">Firebase Realtime Database</a>, where we can sync data with a NoSQL cloud database.</p>
<p>The client application is going to be built in <a href="https://reactjs.org/">React</a>, as it is one of the most popular JavaScript frameworks out &#8230; <a href="https://css-tricks.com/building-a-real-time-chat-app-with-react-and-firebase/" class="read-more">Read article <span class="screen-reader-text"> &#8220;Building a Real-Time Chat App with React and Firebase&#8221;</span></a></p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/building-a-real-time-chat-app-with-react-and-firebase/">Building a Real-Time Chat App with React and Firebase</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></description>
										<content:encoded><![CDATA[
<p>In this article, we’ll cover key concepts for authenticating a user with Firebase in a real-time chat application. We’ll integrate third-party auth providers (e.g. Google, Twitter and GitHub) and, once users are signed in, we’ll learn how to store user chat data in the <a href="https://firebase.google.com/docs/database/">Firebase Realtime Database</a>, where we can sync data with a NoSQL cloud database.</p>



<span id="more-305248"></span>



<p>The client application is going to be built in <a href="https://reactjs.org/">React</a>, as it is one of the most popular JavaScript frameworks out there, but the concepts can also be applied to other frameworks.</p>



<h3><strong>But first, what is Firebase?</strong></h3>



<p><a href="https://firebase.google.com/">Firebase</a> is Google&#8217;s mobile platform for quickly developing apps. Firebase provides a suite of tools for authenticating applications, building reactive client apps, reporting analytics, as well as a host of other helpful resources for managing apps in general. It also provides back-end management for web, iOS, Android, and <a href="https://unity.com/">Unity</a>, a 3D development platform.</p>



<p>Out of the box, Firebase is packaged with features that help developers like ourselves focus on building apps while it handles all server-side logic. Things like:</p>



<ul><li><strong>Authentication</strong>: This includes support for email and password authentication as well as single sign-on capabilities (via Facebook, Twitter and Google).</li><li><strong>Realtime database</strong>: This is a “NoSQL” database that updates in real time.</li><li><strong>Cloud functions</strong>: These run extra server-side logic.</li><li><strong>Static hosting</strong>: This is a means of serving assets pre-built instead of rendering at runtime.</li><li><strong>Cloud storage: </strong>This gives us a place to store media assets.</li></ul>



<p>Firebase offers a generous free tier that includes authentication and access to their Realtime Database. The authentication providers we’ll be covering email and password — Google and GitHub — are free on that side as well. The Realtime Database allows up to 100 simultaneous connections and 1 gigabyte storage per month. A full table of pricing can be found on the <a href="https://firebase.google.com/pricing">Firebase website</a>.</p>



<h3>Here’s what we’re making</h3>



<p>We’re going to build an application called Chatty. It will allow only authenticated users to send and read messages and users can sign up by providing their email and creating a password, or by authenticating through a Google or GitHub account. Check out <a href="https://github.com/Dunebook/Firebase-auth-chat-app">source code </a>if you want to refer to it or take a peek as we get started.</p>



<p>We’ll end up with something like this:</p>



<figure class="wp-block-video"><video controls src="https://res.cloudinary.com/css-tricks/video/upload/f_auto,q_auto/v1584987521/chatty_mqlt4z.mov"></video></figure>



<h3>Setting up</h3>



<p>You’re going to need a Google account to use Firebase, so snag one if you haven’t already. And once you do, we can officially kick the tires on this thing.</p>



<p>First off, head over to the <a href="https://console.firebase.google.com">Firebase Console</a> and click the <strong>“Add project&#8221; </strong>option.</p>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/Q2lqApyg.png?ssl=1" alt="" class="wp-image-305249" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/Q2lqApyg.png?w=760&amp;ssl=1 760w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/Q2lqApyg.png?resize=300%2C126&amp;ssl=1 300w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>Next, let’s enter a name for the project. I’m going with Chatty.</p>



<figure class="wp-block-image size-large"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/7VtppeLc.png?ssl=1" alt="" class="wp-image-305250" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/7VtppeLc.png?w=746&amp;ssl=1 746w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/7VtppeLc.png?resize=300%2C218&amp;ssl=1 300w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>You can choose to add analytics to your project, but it’s not required. Either way, click continue to proceed and Firebase will take a few seconds to delegate resources for the project.</p>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/EsQ3lcMg.png?ssl=1" alt="" class="wp-image-305251" data-recalc-dims="1"/></figure>



<p>Once that spins up, we are taken to the Firebase dashboard But, before we can start using Firebase in our web app, we have to get the configuration details down for our project. So, click on the web icon in the dashboard.</p>



<figure style="width:308px;" class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/fyDn76lg.png?w=308&#038;ssl=1" alt="" class="wp-image-305252" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/fyDn76lg.png?w=308&amp;ssl=1 308w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/fyDn76lg.png?resize=300%2C237&amp;ssl=1 300w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>Then, enter a name for&nbsp;the&nbsp;app and click&nbsp;<strong>Register app</strong>.</p>



<figure class="wp-block-image size-large"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/dwRXRfo0.png?ssl=1" alt="" class="wp-image-305253" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/dwRXRfo0.png?w=811&amp;ssl=1 811w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/dwRXRfo0.png?resize=300%2C174&amp;ssl=1 300w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/dwRXRfo0.png?resize=768%2C445&amp;ssl=1 768w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>Next up, we’ll copy and store the configuration details on the next screen in a safe place. That will come in handy in the next step.</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/bjqoXwdU.png?fit=1024%2C714&amp;ssl=1" alt="" class="wp-image-305254" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/bjqoXwdU.png?w=1600&amp;ssl=1 1600w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/bjqoXwdU.png?resize=300%2C209&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/bjqoXwdU.png?resize=1024%2C714&amp;ssl=1 1024w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/bjqoXwdU.png?resize=768%2C536&amp;ssl=1 768w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/bjqoXwdU.png?resize=1536%2C1071&amp;ssl=1 1536w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/bjqoXwdU.png?resize=1000%2C698&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>Again, we’re going to authenticate users via email and password, with additional options for single sign-on with a Google or GitHub account. We need to enable these from the Authentication tab in the dashboard, but we’ll go through each of them one at a time.</p>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/SICEzQKs.png?ssl=1" alt="" class="wp-image-305255" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/SICEzQKs.png?w=763&amp;ssl=1 763w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/SICEzQKs.png?resize=300%2C155&amp;ssl=1 300w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<h3>Email and password authentication</h3>



<p>There’s a <strong>Sign-in method</strong> tab in the Firebase dashboard. Click the <strong>Email/Password</strong> option and enable it.</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/HSht-gN6.png?ssl=1" alt="" class="wp-image-305256" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/HSht-gN6.png?w=755&amp;ssl=1 755w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/HSht-gN6.png?resize=300%2C263&amp;ssl=1 300w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<figure class="wp-block-image size-large"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/U5lI1llt.png?ssl=1" alt="" class="wp-image-305257" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/U5lI1llt.png?w=763&amp;ssl=1 763w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/U5lI1llt.png?resize=300%2C266&amp;ssl=1 300w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>Now we can use it in our app!</p>



<h3>Setting up the web app</h3>



<p>For our web app, we’ll be using React but most of the concepts can be applied to any other framework. Well need <a href="https://nodejs.org/">Node.js</a> for a React setup, so download and install it if you haven’t already.</p>



<p>We’ll use <a href="https://github.com/facebook/create-react-app">create-react-app</a> to bootstrap a new React project. This downloads and installs the necessary packages required for a React application. In the terminal, <code>cd</code> into where you’d like our Chatty project to go and run this to initialize it:</p>



<pre rel="Terminal" class="wp-block-csstricks-code-block language-none" data-line=""><code markup="tt">npx create-react-app chatty</code></pre>



<p>This command does the initial setup for our react app and installs the dependencies in package.json. We’ll also install some additional packages. So, let’s <code>cd</code> into the project itself and add packages for <a href="https://github.com/ReactTraining/react-router">React Router</a> and Firebase.</p>



<pre rel="Terminal" class="wp-block-csstricks-code-block language-none" data-line=""><code markup="tt">cd chatty
yarn add react-router-dom firebase</code></pre>



<p>We already know why we need Firebase, but why React Router? Our chat app will have a couple of views we can use React Router to handle navigating between pages.</p>



<p>With that done, we can officially start the app:</p>



<pre rel="Terminal" class="wp-block-csstricks-code-block language-none" data-line=""><code markup="tt">yarn start</code></pre>



<p>This starts a development server and opens a URL in your default browser. If everything got installed correctly, you should see a screen like this:</p>



<figure class="wp-block-image size-large"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/m0f3daT8.png?fit=1024%2C604&amp;ssl=1" alt="" class="wp-image-305258" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/m0f3daT8.png?w=1251&amp;ssl=1 1251w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/m0f3daT8.png?resize=300%2C177&amp;ssl=1 300w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/m0f3daT8.png?resize=1024%2C604&amp;ssl=1 1024w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/m0f3daT8.png?resize=768%2C453&amp;ssl=1 768w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/m0f3daT8.png?resize=1000%2C590&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>Looking at the folder structure, you would see something similar to this:</p>



<figure style="width:300px;" class="wp-block-image size-large"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/vc0fDMX8.png?ssl=1" alt="" class="wp-image-305259" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/vc0fDMX8.png?w=314&amp;ssl=1 314w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/vc0fDMX8.png?resize=300%2C253&amp;ssl=1 300w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>For our chat app, this is the folder structure we’ll be using:</p>



<figure style="width:300px;" class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/logku1nk-2.png?ssl=1" alt="" class="wp-image-305262" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/logku1nk-2.png?w=299&amp;ssl=1 299w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/logku1nk-2.png?resize=251%2C300&amp;ssl=1 251w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<ul><li><code>/components</code>: contains reusable widgets used in different pages</li><li><code>/helpers</code>: a set of reusable functions</li><li><code>/pages</code>: the app views</li><li><code>/services</code>: third-party services that we’re using (e.g. Firebase)</li><li><code>App.js</code>: the root component</li></ul>



<p>Anything else in the folder is unnecessary for this project and can safely be removed. From here, let’s add some code to <code>src/services/firebase.js</code> so the app can talk with Firebase.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import firebase from 'firebase';</code></pre>



<h3>Let’s get Firebase into the app</h3>



<p>We’ll import and initialize Firebase using the configuration details we copied earlier when registering the app in the Firebase dashboard. Then, we’ll export the authentication and database modules.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const config = {
  apiKey: "ADD-YOUR-DETAILS-HERE",
  authDomain: "ADD-YOUR-DETAILS-HERE",
  databaseURL: "ADD-YOUR-DETAILS-HERE"
};
firebase.initializeApp(config);
export const auth = firebase.auth;
export const db = firebase.database();</code></pre>



<p>Let’s import our dependencies in <code>src/App.js</code>:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import React, { Component } from 'react';
import {
  Route,
  BrowserRouter as Router,
  Switch,
  Redirect,
} from "react-router-dom";
import Home from './pages/Home';
import Chat from './pages/Chat';
import Signup from './pages/Signup';
import Login from './pages/Login';
import { auth } from './services/firebase';</code></pre>



<p>These are ES6 imports. Specifically, we’re importing React and other packages needed to build out the app. We’re also importing all the pages of our app that we’ll configure later to our router.</p>



<h3>Next up is routing</h3>



<p>Our app has public routes (accessible without authentication) and a private route (accessible only with authentication). Because React doesn’t provide a way to check the authenticated state, we’ll create <a href="https://css-tricks.com/what-are-higher-order-components-in-react/">higher-order components</a> (HOCs) for both types of routes.</p>



<p>Our HOCs will:</p>



<ul><li>wrap a <code>&lt;Route&gt;</code>,</li><li>pass props from the router to the <code>&lt;Route&gt;</code>,</li><li>render the component depending on the authenticated state, and</li><li>redirect the user to a specified route if the condition is not met</li></ul>



<p>Let’s write the code for our <code>&lt;PrivateRoute&gt;</code> HOC.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">function PrivateRoute({ component: Component, authenticated, ...rest }) {
  return (
    &lt;Route
      {...rest}
      render={(props) => authenticated === true
        ? &lt;Component {...props} />
        : &lt;Redirect to={{ pathname: '/login', state: { from: props.location } }} />}
    />
  )
}</code></pre>



<p>It receives&nbsp;three&nbsp;props: the component to render if the condition is true, the&nbsp;<code>authenticated</code>&nbsp;state,&nbsp;and the ES6 spread operator to get the remaining parameters passed from the router. It checks if&nbsp;<code>authenticated</code>&nbsp;is true and renders the component passed, else it redirects to/login.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">function PublicRoute({ component: Component, authenticated, ...rest }) {
  return (
    &lt;Route
      {...rest}
      render={(props) => authenticated === false
        ? &lt;Component {...props} />
        : &lt;Redirect to='/chat' />}
    />
  )
}</code></pre>



<p>The&nbsp;<code>&lt;PublicRoute&gt;</code>&nbsp;is pretty much the same. It renders our public routes and redirects to the&nbsp;<code>/chat</code>&nbsp;path if the authenticated state becomes true.&nbsp;We can use the HOCs in our render method:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">render() {
  return this.state.loading === true ? &lt;h2>Loading...&lt;/h2> : (
    &lt;Router>
      &lt;Switch>
        &lt;Route exact path="/" component={Home}>&lt;/Route>
        &lt;PrivateRoute path="/chat" authenticated={this.state.authenticated} component={Chat}>&lt;/PrivateRoute>
        &lt;PublicRoute path="/signup" authenticated={this.state.authenticated} component={Signup}>&lt;/PublicRoute>
        &lt;PublicRoute path="/login" authenticated={this.state.authenticated} component={Login}>&lt;/PublicRoute>
      &lt;/Switch>
    &lt;/Router>
  );
}</code></pre>



<h3>Checking for authentication</h3>



<p>It would be nice to show a loading indicator while we verify if the user is authenticated. Once the check is complete, we render the appropriate route that matches the URL. We have three public routes — <code>&lt;Home&gt;</code>, <code>&lt;Login&gt;</code> and <code>&lt;Signup&gt;</code> — and a private one called <code>&lt;Chat&gt;</code>.</p>



<p>Let’s write the logic to check if the user is indeed authenticated.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">class App extends Component {
  constructor() {
    super();
    this.state = {
      authenticated: false,
      loading: true,
    };
  }
}

export default App;</code></pre>



<p>Here we’re setting the initial state of the app. Then, we’re using the <code>componentDidMount</code> <a href="https://css-tricks.com/the-circle-of-a-react-lifecycle/">lifecycle hook</a> to check if the user is authenticated. So, let’s add this after the constructor:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">componentDidMount() {
  auth().onAuthStateChanged((user) => {
    if (user) {
      this.setState({
        authenticated: true,
        loading: false,
      });
    } else {
      this.setState({
        authenticated: false,
        loading: false,
      });
    }
  })
}</code></pre>



<p>Firebase provides an intuitive method called <code>onAuthStateChanged</code> that is triggered when the authenticated state changes. We use this to update our initial state. <code>user</code> is null if the user is not authenticated. If the <code>user</code> is true, we update authenticated to <code>true</code>; else we set it to <code>false</code>. We also set loading to <code>false</code> either way.</p>



<h3>Registering users with email and password</h3>



<p>Users will be able to register for Chatty through email and password. The <code>helpers</code> folder contains a set of methods that we’ll use to handle some authentication logic. Inside this folder, let’s create a new file called <code>auth.js</code> and add this:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import { auth } from "../services/firebase";</code></pre>



<p>We import the auth module from the service we created earlier.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">export function signup(email, password) {
  return auth().createUserWithEmailAndPassword(email, password);
}
 
export function signin(email, password) {
  return auth().signInWithEmailAndPassword(email, password);
}</code></pre>



<p>We have two methods here: <code>signup</code> and<code>signin</code>:</p>



<ul><li><code>signup</code> will create a new user using their email and password.&nbsp;</li><li><code>signin</code> will log in an existing user created with email and password.</li></ul>



<p>Let’s create our <code>&lt;Signup&gt;</code> page by creating a new file <code>Signup.js</code> file in the pages folder. This is the markup for the UI:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import React, { Component } from 'react';
import { Link } from 'react-router-dom';
import { signup } from '../helpers/auth';
 
export default class SignUp extends Component {
 
  render() {
    return (
      &lt;div>
        &lt;form onSubmit={this.handleSubmit}>
          &lt;h1>
            Sign Up to
          &lt;Link to="/">Chatty&lt;/Link>
          &lt;/h1>
          &lt;p>Fill in the form below to create an account.&lt;/p>
          &lt;div>
            &lt;input placeholder="Email" name="email" type="email" onChange={this.handleChange} value={this.state.email}>&lt;/input>
          &lt;/div>
          &lt;div>
            &lt;input placeholder="Password" name="password" onChange={this.handleChange} value={this.state.password} type="password">&lt;/input>
          &lt;/div>
          &lt;div>
            {this.state.error ? &lt;p>{this.state.error}&lt;/p> : null}
            &lt;button type="submit">Sign up&lt;/button>
          &lt;/div>
          &lt;hr>&lt;/hr>
          &lt;p>Already have an account? &lt;Link to="/login">Login&lt;/Link>&lt;/p>
        &lt;/form>
      &lt;/div>
    )
  }
}</code></pre>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/qCw8GxtA.png?ssl=1" alt="" class="wp-image-305264" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/qCw8GxtA.png?w=657&amp;ssl=1 657w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/qCw8GxtA.png?resize=300%2C168&amp;ssl=1 300w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /><figcaption>Email? Check. Password? Check. Submit button? Check. Our form is looking good.</figcaption></figure>



<p>The form and input fields are bound to a method we haven’t created yet, so let’s sort that out. Just before the <code>render()</code> method, we’ll add the following:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">constructor(props) {
  super(props);
  this.state = {
    error: null,
    email: '',
    password: '',
  };
  this.handleChange = this.handleChange.bind(this);
  this.handleSubmit = this.handleSubmit.bind(this);
}</code></pre>



<p>We’re setting the initial state of the page. We’re also binding the <code>handleChange</code> and <code>handleSubmit</code> methods to the component’s this scope.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">handleChange(event) {
  this.setState({
    [event.target.name]: event.target.value
  });
}</code></pre>



<p>Next up, we’ll add the <code>handleChange</code> method that our input fields are bound to. The method uses <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Operators/Object_initializer%23Computed_property_names">computed properties</a> to dynamically determine the key and set the corresponding state variable.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">async handleSubmit(event) {
  event.preventDefault();
  this.setState({ error: '' });
  try {
    await signup(this.state.email, this.state.password);
  } catch (error) {
    this.setState({ error: error.message });
  }
}</code></pre>



<p>For handleSubmit, we’re preventing the default behavior for form submissions (which simply reloads the browser, among other things). We’re also clearing up the error state variable, then using the signup() method imported from helpers/auth to pass the email and password entered by the user.</p>



<p>If the registration is successful, users get redirected to the /Chats route. This is possible with the combination of onAuthStateChanged and the HOCs we created earlier. If registration fails, we set the error variable which displays a message to users.</p>



<p><strong>Authenticating users with email and password</strong></p>



<p>The login page is identical to the signup page. The only difference is we’ll be using the <code>signin</code> method from the helpers we created earlier. That said, let’s create yet another new file in the pages directory, this time called <code>Login.js</code>, with this code in it:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import React, { Component } from "react";
import { Link } from "react-router-dom";
import { signin, signInWithGoogle, signInWithGitHub } from "../helpers/auth";
 
export default class Login extends Component {
  constructor(props) {
    super(props);
    this.state = {
      error: null,
      email: "",
      password: ""
    };
    this.handleChange = this.handleChange.bind(this);
    this.handleSubmit = this.handleSubmit.bind(this);
  }
 
  handleChange(event) {
    this.setState({
      [event.target.name]: event.target.value
    });
  }
 
  async handleSubmit(event) {
    event.preventDefault();
    this.setState({ error: "" });
    try {
      await signin(this.state.email, this.state.password);
    } catch (error) {
      this.setState({ error: error.message });
    }
  }
 
  render() {
    return (
      &lt;div>
        &lt;form
          autoComplete="off"
          onSubmit={this.handleSubmit}
        >
          &lt;h1>
            Login to
            &lt;Link to="/">
              Chatty
            &lt;/Link>
          &lt;/h1>
          &lt;p>
            Fill in the form below to login to your account.
          &lt;/p>
          &lt;div>
            &lt;input
              placeholder="Email"
              name="email"
              type="email"
              onChange={this.handleChange}
              value={this.state.email}
            />
          &lt;/div>
          &lt;div>
            &lt;input
              placeholder="Password"
              name="password"
              onChange={this.handleChange}
              value={this.state.password}
              type="password"
            />
          &lt;/div>
          &lt;div>
            {this.state.error ? (
              &lt;p>{this.state.error}&lt;/p>
            ) : null}
            &lt;button type="submit">Login&lt;/button>
          &lt;/div>
          &lt;hr />
          &lt;p>
            Don't have an account? &lt;Link to="/signup">Sign up&lt;/Link>
          &lt;/p>
        &lt;/form>
      &lt;/div>
    );
  }
}</code></pre>



<p>Again, very similar to before. When the user successfully logs in, they’re redirected to <code>/chat</code>.</p>



<h3>Authenticating with a Google account</h3>



<p>Firebase allows us to authenticate users with a valid Google account. We’ve got to enable it in the Firebase dashboard just like we did for email and password.</p>



<figure class="wp-block-image size-large"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/aZv8zTsA.png?fit=1024%2C554&amp;ssl=1" alt="" class="wp-image-305265" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/aZv8zTsA.png?w=1241&amp;ssl=1 1241w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/aZv8zTsA.png?resize=300%2C162&amp;ssl=1 300w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/aZv8zTsA.png?resize=1024%2C554&amp;ssl=1 1024w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/aZv8zTsA.png?resize=768%2C416&amp;ssl=1 768w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/aZv8zTsA.png?resize=1000%2C541&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /><figcaption>Select the Google option and enable it in the settings.</figcaption></figure>



<p>On that same page, we also need to scroll down to add a domain to the list of domains that are authorized to access feature. This way, we avoid spam from any domain that is not whitelisted. For development purposes, our domain is <code>localhost</code>, so we’ll go with that for now.</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/8CGd20pA.png?ssl=1" alt="" class="wp-image-305266" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/8CGd20pA.png?w=998&amp;ssl=1 998w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/8CGd20pA.png?resize=300%2C57&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/8CGd20pA.png?resize=768%2C145&amp;ssl=1 768w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>We can switch back to our editor now. We’ll add a new method to <code>helpers/auth.js</code> to handle Google authentication.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">export function signInWithGoogle() {
  const provider = new auth.GoogleAuthProvider();
  return auth().signInWithPopup(provider);
}</code></pre>



<p>Here, we’re creating an instance of the <code>GoogleAuthProvider</code>. Then, we’re calling <code>signInWithPopup</code> with the provider as a parameter. When this method is called, a pop up will appear and take the user through the Google sign in flow before redirecting them back to the app. You’ve likely experienced it yourself at some point in time.</p>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/8g34je7Z.png?ssl=1" alt="" class="wp-image-305267" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/8g34je7Z.png?w=553&amp;ssl=1 553w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/8g34je7Z.png?resize=300%2C300&amp;ssl=1 300w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/8g34je7Z.png?resize=150%2C150&amp;ssl=1 150w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/8g34je7Z.png?resize=100%2C100&amp;ssl=1 100w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>Let’s use it in our signup page by importing the method:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import { signin, signInWithGoogle } from "../helpers/auth";</code></pre>



<p>Then, let’s add a button to trigger the method, just under the <strong>Sign up</strong> button:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">&lt;p>Or&lt;/p>
&lt;button onClick={this.googleSignIn} type="button">
  Sign up with Google
&lt;/button></code></pre>



<p>Next, we’ll add the <code>onClick</code> handler:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">async googleSignIn() {
  try {
    await signInWithGoogle();
  } catch (error) {
    this.setState({ error: error.message });
  }
}</code></pre>



<p>Oh, and we should remember to bind the handler to the component:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">constructor() {
  // ...
  this.githubSignIn = this.githubSignIn.bind(this);
}</code></pre>



<p>That’s all we need! When the button is clicked, it takes users through the Google sign in flow and, if successful, the app redirects the user to the chat route.</p>



<h3>Authenticating with a GitHub account</h3>



<p>We’re going to do the same thing with GitHub. May as well give folks more than one choice of account.</p>



<p>Let’s walk through the steps. First, we’ll enable GitHub sign in on Firebase dashboard, like we did for email and Google.</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/S7heJD_E.png?fit=1024%2C521&amp;ssl=1" alt="" class="wp-image-305268" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/S7heJD_E.png?w=1249&amp;ssl=1 1249w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/S7heJD_E.png?resize=300%2C153&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/S7heJD_E.png?resize=1024%2C521&amp;ssl=1 1024w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/S7heJD_E.png?resize=768%2C391&amp;ssl=1 768w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/S7heJD_E.png?resize=1000%2C509&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>You will notice both the client ID and client secret fields are empty, but we do have our authorization callback URL at the bottom. Copy that, because we’ll use it when we do our next thing, which is <a href="https://github.com/settings/applications/new">register the app</a> on GitHub.</p>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/6VFztsR0.png?ssl=1" alt="" class="wp-image-305269" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/6VFztsR0.png?w=908&amp;ssl=1 908w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/6VFztsR0.png?resize=300%2C213&amp;ssl=1 300w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/6VFztsR0.png?resize=768%2C546&amp;ssl=1 768w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>Once that’s done, we’ll get a client ID and secret which we can now add to the Firebase console.</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/fTjvmH_7.jpeg?ssl=1" alt="" class="wp-image-305270" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/fTjvmH_7.jpeg?w=832&amp;ssl=1 832w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/fTjvmH_7.jpeg?resize=300%2C161&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/fTjvmH_7.jpeg?resize=768%2C412&amp;ssl=1 768w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>Let’s switch back to the editor and add a new method to <code>helpers/auth.js</code>:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">export function signInWithGitHub() {
  const provider = new auth.GithubAuthProvider();
  return auth().signInWithPopup(provider);
}</code></pre>



<p>It’s similar to the Google sign in interface, but this time we’re creating a <code>GithubAuthProvider</code>. Then, we’ll call <code>signInWithPopup</code> with the provider.</p>



<p>In <code>pages/Signup.js</code>, we update our imports to include the <code>signInWithGitHub</code> method:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import { signup, signInWithGoogle, signInWithGitHub } from "../helpers/auth";</code></pre>



<p>We add a button for GitHub sign up:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">&lt;button type="button" onClick={this.githubSignIn}>
  Sign up with GitHub
&lt;/button></code></pre>



<p>Then we add a click handler for the button which triggers the GitHub sign up flow:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">async githubSignIn() {
  try {
    await signInWithGitHub();
  } catch (error) {
    this.setState({ error: error.message });
  }
}</code></pre>



<p>Let’s remember again to bind the handler to the component:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">constructor() {
  // ...
  this.githubSignIn = this.githubSignIn.bind(this);
}</code></pre>



<p>Now we’ll get the same sign-in and authentication flow that we have with Google, but with GitHub.</p>



<h3>Reading data from Firebase</h3>



<p>Firebase has two types of databases: A product they call Realtime Database and another called Cloud Firestore. Both databases are NoSQL-like databases, meaning the database is structured as key-value pairs. For this tutorial, we’ll use the Realtime Database.</p>



<figure class="wp-block-image size-large"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/BGJK2cZo.png?ssl=1" alt="" class="wp-image-305271" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/BGJK2cZo.png?w=987&amp;ssl=1 987w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/BGJK2cZo.png?resize=300%2C181&amp;ssl=1 300w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/BGJK2cZo.png?resize=768%2C462&amp;ssl=1 768w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>This is the structure we’ll be using for our app. We have a root node <code>chats</code> with children nodes. Each child has a content, timestamp, and user ID. One of the tabs you’ll notice is <strong>Rules </strong>which is how we set permissions on the contents of the database.</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/JXdxou3Q.png?ssl=1" alt="" class="wp-image-305272" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/JXdxou3Q.png?w=979&amp;ssl=1 979w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/JXdxou3Q.png?resize=300%2C156&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/JXdxou3Q.png?resize=768%2C400&amp;ssl=1 768w" sizes="(min-width: 735px) 864px, 96vw" data-recalc-dims="1" /></figure>



<p>Firebase database rules are defined as key-value pairs as well. Here, we’ll set our rules to allow only authenticated users to read and write to the chat node. There are a lot more <a href="https://firebase.google.com/docs/rules">firebase rules</a>. worth checking out.</p>



<p>Let’s write code to read from the database. First, create a new file called <code>Chat.js</code> &nbsp;in the pages &nbsp;folder and add this code to import React, Firebase authentication, and Realtime Database:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import React, { Component } from "react";
import { auth } from "../services/firebase";
import { db } from "../services/firebase"</code></pre>



<p>Next, let’s define the initial state of the app:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">export default class Chat extends Component {
  constructor(props) {
    super(props);
    this.state = {
      user: auth().currentUser,
      chats: [],
      content: '',
      readError: null,
      writeError: null
    };
  }
  async componentDidMount() {
    this.setState({ readError: null });
    try {
      db.ref("chats").on("value", snapshot => {
        let chats = [];
        snapshot.forEach((snap) => {
          chats.push(snap.val());
        });
        this.setState({ chats });
      });
    } catch (error) {
      this.setState({ readError: error.message });
    }
  }
}</code></pre>



<p>The real main logic takes place in <code>componentDidMount. db.ref("chats")</code> is a reference to the chats path in the database. We listen to the value event which is triggered anytime a new value is added to the chats node. What is returned from the database is an array-like object that we loop through and push each object into an array. Then, we set the chats state variable to our resulting array. If there is an error, we set the <code>readError</code> state variable to the error message.</p>



<p>One thing to note here is that a connection is created between the client and our Firebase database because we used the <code>.on()</code> method. This means any time a new value is added to the database, the client app is updated in real-time which means users can see new chats without a page refresh Nice!.</p>



<p>After <code>componentDidMount</code>, we can render our chats like so:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">render() {
  return (
    &lt;div>
      &lt;div className="chats">
        {this.state.chats.map(chat => {
          return &lt;p key={chat.timestamp}>{chat.content}&lt;/p>
        })}
      &lt;/div>
      &lt;div>
        Login in as: &lt;strong>{this.state.user.email}&lt;/strong>
      &lt;/div>
    &lt;/div>
  );
}</code></pre>



<p>This renders the array of chats. We render the email of the currently logged in user.</p>



<h3>Writing data to Firebase</h3>



<p>At the moment, users can only read from the database but are unable to send messages. What we need is a form with an input field that accepts a message and a button to send the message to the chat.</p>



<p>So, let’s modify the markup like so:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">return (
    &lt;div>
      &lt;div className="chats">
        {this.state.chats.map(chat => {
          return &lt;p key={chat.timestamp}>{chat.content}&lt;/p>
        })}
      &lt;/div>
      {# message form #}
      &lt;form onSubmit={this.handleSubmit}>
        &lt;input onChange={this.handleChange} value={this.state.content}>&lt;/input>
        {this.state.error ? &lt;p>{this.state.writeError}&lt;/p> : null}
        &lt;button type="submit">Send&lt;/button>
      &lt;/form>
      &lt;div>
        Login in as: &lt;strong>{this.state.user.email}&lt;/strong>
      &lt;/div>
    &lt;/div>
  );
}</code></pre>



<p>We have added a form with an input field and a button. The value of the input field is bound to our state variable <code>content</code> and we call <code>handleChange</code> when its value changes.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">handleChange(event) {
  this.setState({
    content: event.target.value
  });
}</code></pre>



<p><code>handleChange</code> gets the value from the input field and sets on our state variable. To submit the form, we call <code>handleSubmit</code>:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">async handleSubmit(event) {
  event.preventDefault();
  this.setState({ writeError: null });
  try {
    await db.ref("chats").push({
      content: this.state.content,
      timestamp: Date.now(),
      uid: this.state.user.uid
    });
    this.setState({ content: '' });
  } catch (error) {
    this.setState({ writeError: error.message });
  }
}</code></pre>



<p>We set any previous errors to <code>null</code>. We create a reference to the <code>chats</code> node in the database and use&nbsp;<code>push()</code> to create a unique key and pushe the object to it.</p>



<p>As always, we have to bind our methods to the component:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">constructor(props) {
  // ...
  this.handleChange = this.handleChange.bind(this);
  this.handleSubmit = this.handleSubmit.bind(this);
}</code></pre>



<p>Now a user can add new messages to the chats and see them in real-time! How cool is that?</p>



<h3>Demo time!</h3>



<figure class="wp-block-video"><video controls src="https://res.cloudinary.com/css-tricks/video/upload/f_auto,q_auto/v1584987593/chat_app_demo_gibrtj.mp4"></video></figure>



<h3>Enjoy your new chat app!</h3>



<p>Congratulations! You have just built a chat tool that authenticates users with email and password, long with options to authenticate through a Google or GitHub account.</p>



<p>I hope this give you a good idea of how handy Firebase can be to get up and running with authentication on an app. We worked on a chat app, but the real gem is the signup and sign-in methods we created to get into it. That’s something useful for many apps.</p>



<p>Questions? Thoughts? Feedback? Let me know in the comments!<br></p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/building-a-real-time-chat-app-with-react-and-firebase/">Building a Real-Time Chat App with React and Firebase</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://css-tricks.com/building-a-real-time-chat-app-with-react-and-firebase/feed/</wfw:commentRss>
			<slash:comments>24</slash:comments>
		
		<enclosure url="https://res.cloudinary.com/css-tricks/video/upload/f_auto,q_auto/v1584987521/chatty_mqlt4z.mov" length="815045" type="video/quicktime" />
<enclosure url="https://res.cloudinary.com/css-tricks/video/upload/f_auto,q_auto/v1584987593/chat_app_demo_gibrtj.mp4" length="111120" type="video/mp4" />

		<post-id xmlns="com-wordpress:feed-additions:1">305248</post-id>	</item>
		<item>
		<title>React Suspense in Practice</title>
		<link>https://css-tricks.com/react-suspense-in-practice/</link>
					<comments>https://css-tricks.com/react-suspense-in-practice/#comments</comments>
		
		<dc:creator><![CDATA[Adam Rackis]]></dc:creator>
		<pubDate>Thu, 19 Mar 2020 18:44:09 +0000</pubDate>
				<category><![CDATA[Article]]></category>
		<category><![CDATA[react]]></category>
		<category><![CDATA[react suspense]]></category>
		<guid isPermaLink="false">https://css-tricks.com/?p=304861</guid>

					<description><![CDATA[<p>This post is about understanding how Suspense works, what it does, and seeing how it can integrate into a real web app. We&#8217;ll look at how to integrate <em>routing</em> and <em>data loading</em> with <a href="https://reactjs.org/docs/concurrent-mode-suspense.html">Suspense</a> in React. For routing, I&#8217;ll be using vanilla JavaScript, and I&#8217;ll be using my own <a href="https://github.com/arackaf/micro-graphql-react">micro-graphql-react</a> GraphQL library for data.</p>
<p class="explanation">If you&#8217;re wondering about <a href="https://reacttraining.com/react-router/">React Router,</a> it seems great, but I&#8217;ve never had the chance to use it. My own side project has a simple enough &#8230; <a href="https://css-tricks.com/react-suspense-in-practice/" class="read-more">Read article <span class="screen-reader-text"> &#8220;React Suspense in Practice&#8221;</span></a></p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/react-suspense-in-practice/">React Suspense in Practice</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></description>
										<content:encoded><![CDATA[
<p>This post is about understanding how Suspense works, what it does, and seeing how it can integrate into a real web app. We&#8217;ll look at how to integrate <em>routing</em> and <em>data loading</em> with <a href="https://reactjs.org/docs/concurrent-mode-suspense.html">Suspense</a> in React. For routing, I&#8217;ll be using vanilla JavaScript, and I&#8217;ll be using my own <a href="https://github.com/arackaf/micro-graphql-react">micro-graphql-react</a> GraphQL library for data.</p>



<span id="more-304861"></span>



<p class="explanation">If you&#8217;re wondering about <a href="https://reacttraining.com/react-router/">React Router,</a> it seems great, but I&#8217;ve never had the chance to use it. My own side project has a simple enough routing story that I always just did it by hand. Besides, using vanilla JavaScript will give us a better look at how Suspense works.</p>



<h3>A little background</h3>



<p>Let’s talk about Suspense itself. Kingsley Silas provides a <a href="https://css-tricks.com/reacts-experimental-suspense-api-will-rock-for-fallback-ui-during-data-fetches/">thorough overview of it</a>, but the first thing to note is that it&#8217;s still an experimental API. That means — and <a href="https://reactjs.org/docs/concurrent-mode-suspense.html">React’s docs say the same</a> — not to lean on it yet for production-ready work. There’s always a chance it will change between now and when it’s fully complete, so please bear that in mind.</p>



<p>That said, Suspense is all about maintaining a consistent UI in the face of asynchronous dependencies, such as lazily loaded React components, GraphQL data, etc. Suspense provides low-level API&#8217;s that allow you to easily maintain your UI while your app is managing these things.</p>



<p>But what does &#8220;consistent&#8221; mean in this case? <strong>It means <em>not</em> rendering a UI that&#8217;s partially complete.</strong> It means, if there are three data sources on the page, and one of them has completed, we <em>don&#8217;t</em> want to render that updated piece of state, with a spinner next to the now-outdated other two pieces of state.</p>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-some-loading.png?fit=1024%2C512&amp;ssl=1" alt="" class="wp-image-304863" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-some-loading.png?w=1200&amp;ssl=1 1200w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-some-loading.png?resize=300%2C150&amp;ssl=1 300w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-some-loading.png?resize=1024%2C512&amp;ssl=1 1024w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-some-loading.png?resize=768%2C384&amp;ssl=1 768w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-some-loading.png?resize=1000%2C500&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>What we <em>do</em> want to do is indicate to the user that data are loading, while continuing to show either the old UI, or an alternative UI which indicates we&#8217;re waiting on data; Suspense supports either, which I&#8217;ll get into.</p>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-all-loading.png?fit=1024%2C512&amp;ssl=1" alt="" class="wp-image-304864" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-all-loading.png?w=1200&amp;ssl=1 1200w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-all-loading.png?resize=300%2C150&amp;ssl=1 300w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-all-loading.png?resize=1024%2C512&amp;ssl=1 1024w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-all-loading.png?resize=768%2C384&amp;ssl=1 768w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-all-loading.png?resize=1000%2C500&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<h3>What exactly Suspense does</h3>



<p>This is all less complicated than it may seem. Traditionally in React, you&#8217;d set state, and your UI would update. Life was simple. But it also led to the sorts of inconsistencies described above. What Suspense adds is the ability to have a component notify React at render time that it&#8217;s waiting for asynchronous data; this is called suspending, and it can happen anywhere in a component&#8217;s tree, as many times as needed, until the tree is ready. When a component suspends, React will decline to render the pending state update until all suspended dependencies have been satisfied.</p>



<p>So what happens when a component suspends? React will look up the tree, find the first <code>&lt;Suspense&gt;</code> component, and render its fallback. I&#8217;ll be providing plenty of examples, but for now, know that you can provide this:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">&lt;Suspense fallback={&lt;Loading />}></code></pre>



<p>…and the <code>&lt;Loading /&gt;</code> component will render if any child components of <code>&lt;Suspense&gt;</code> are suspended.</p>



<p>But what if we already have a valid, consistent UI, and the user loads new data, causing a component to suspend? This would cause the entire existing UI to un-render, and the fallback to show. That&#8217;d still be consistent, but hardly a good UX. We&#8217;d prefer the old UI stay on the screen while the new data are loading.</p>



<p>To support this, React provides a second API, useTransition, which effectively makes a state change <strong>in memory</strong>. In other words, it allows you to set state in memory while keeping your existing UI on screen; React will literally keep a second copy of your component tree rendered in memory, and set state on <em>that</em> tree. Components may suspend, but only in memory, so your existing UI will continue to show on the screen. When the state change is complete, and all suspensions have resolved, the in-memory state change will render onto the screen. Obviously you want to provide feedback to your user while this is happening, so <code>useTransition</code> provides a <code>pending</code> boolean, which you can use to display some sort of inline &#8220;loading&#8221; notification while suspensions are being resolved in memory.</p>



<p>When you think about it, you probably don&#8217;t want your existing UI to show indefinitely while your loading is pending. If the user tries to do something, and a long period of time elapses before it&#8217;s finished, you should probably consider the existing UI outdated and invalid. At this point, you probably <strong>will</strong> want your component tree to suspend, and your <code>&lt;Suspense&gt;</code> fallback to display.</p>



<p>To accomplish this, <code>useTransition</code> takes a <code>timeoutMs</code> value. This indicates the amount of time you&#8217;re willing to let the in-memory state change run, before you suspend.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const Component = props => {
  const [startTransition, isPending] = useTransition({ timeoutMs: 3000 });
  // .....
};</code></pre>



<p>Here, <code>startTransition</code> is a function. When you want to run a state change &#8220;in memory,&#8221; you call <code>startTransition</code>, and pass a lambda expression that does your state change.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">startTransition(() => {
  dispatch({ type: LOAD_DATA_OR_SOMETHING, value: 42 });
})</code></pre>



<p>You can call <code>startTransition</code> wherever you want. You can pass it to child components, etc. When you call it, any state change you perform will happen in memory. If a suspension happens, <code>isPending</code> will become true, which you can use to display some sort of inline loading indicator.</p>



<p>That&#8217;s it. That&#8217;s what Suspense does.</p>



<p>The rest of this post will get into some actual code to leverage these features.</p>



<h3>Example: Navigation</h3>



<p>To tie navigation into Suspense, you&#8217;ll be happy to know that React provides a primitive to do this: <code><a href="https://reactjs.org/docs/code-splitting.html#reactlazy">React.lazy</a></code>. It&#8217;s a function that takes a lambda expression that returns a Promise, which resolves to a React component. The result of this function call becomes your lazily loaded component. It sounds complicated, but it looks like this:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const SettingsComponent = lazy(() => import("./modules/settings/settings"));</code></pre>



<p><code>SettingsComponent</code> is now a React component that, when rendered (but not before), will call the function we passed in, which will call <code>import()</code> and load the JavaScript module located at <code>./modules/settings/settings</code>.</p>



<p>The key piece is this: while that <code>import()</code> is in flight, the component rendering <code>SettingsComponent</code> will suspend. It seems we have all the pieces in hand, so let&#8217;s put them together and build some Suspense-based navigation.</p>



<h3>Navigation helpers</h3>



<p>But first, for context, I&#8217;ll briefly cover how navigation state is managed in this app, so the Suspense code will make more sense.</p>



<p>I&#8217;ll be using my <a href="https://github.com/arackaf/booklist">booklist app</a>. It&#8217;s just a side project of mine I mainly keep around to mess around with bleeding-edge web technology. It was written by me alone, so expect parts of it to be a bit unrefined (especially the design).</p>



<p>The app is small, with about eight different modules a user can browse to, without any deeper navigation. Any search state a module might use is stored in the URL’s query string. With this in mind, there are a few methods which scrape the current module name, and search state from the URL. This code uses the <a href="https://github.com/sindresorhus/query-string"><code>query-string</code></a> and <a href="https://github.com/ReactTraining/history"><code>history</code></a> packages from npm, and looks somewhat like this (some details have been removed for simplicity, like authentication).</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">import createHistory from "history/createBrowserHistory";
import queryString from "query-string";
export const history = createHistory();
export function getCurrentUrlState() {
  let location = history.location;
  let parsed = queryString.parse(location.search);
  return {
    pathname: location.pathname,
    searchState: parsed
  };
}
export function getCurrentModuleFromUrl() {
  let location = history.location;
  return location.pathname.replace(/\//g, "").toLowerCase();
}</code></pre>



<p>I have an <code>appSettings</code> reducer that holds the current module and <code>searchState</code> values for the app, and uses these methods to sync with the URL when needed.</p>



<h3>The pieces of a Suspense-based navigation</h3>



<p>Let&#8217;s get started with some Suspense work. First, let&#8217;s create the lazy-loaded components for our modules.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const ActivateComponent = lazy(() => import("./modules/activate/activate"));
const AuthenticateComponent = lazy(() =>
  import("./modules/authenticate/authenticate")
);
const BooksComponent = lazy(() => import("./modules/books/books"));
const HomeComponent = lazy(() => import("./modules/home/home"));
const ScanComponent = lazy(() => import("./modules/scan/scan"));
const SubjectsComponent = lazy(() => import("./modules/subjects/subjects"));
const SettingsComponent = lazy(() => import("./modules/settings/settings"));
const AdminComponent = lazy(() => import("./modules/admin/admin"));</code></pre>



<p>Now we need a method that chooses the right component based on the current module. If we were using React Router, we&#8217;d have some nice <code>&lt;Route /&gt;</code> components. Since we&#8217;re rolling this manually, a <code>switch</code> will do.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">export const getModuleComponent = moduleToLoad => {
  if (moduleToLoad == null) {
    return null;
  }
  switch (moduleToLoad.toLowerCase()) {
    case "activate":
      return ActivateComponent;
    case "authenticate":
      return AuthenticateComponent;
    case "books":
      return BooksComponent;
    case "home":
      return HomeComponent;
    case "scan":
      return ScanComponent;
    case "subjects":
      return SubjectsComponent;
    case "settings":
      return SettingsComponent;
    case "admin":
      return AdminComponent;
  }
  
  return HomeComponent;
};</code></pre>



<h3>The whole thing put together</h3>



<p>With all the boring setup out of the way, let&#8217;s see what the entire app root looks like. There&#8217;s a lot of code here, but I promise, relatively few of these lines pertain to Suspense, and I&#8217;ll cover all of it.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const App = () => {
  const [startTransitionNewModule, isNewModulePending] = useTransition({
    timeoutMs: 3000
  });
  const [startTransitionModuleUpdate, moduleUpdatePending] = useTransition({
    timeoutMs: 3000
  });
  let appStatePacket = useAppState();
  let [appState, _, dispatch] = appStatePacket;
  let Component = getModuleComponent(appState.module);
  useEffect(() => {
    startTransitionNewModule(() => {
      dispatch({ type: URL_SYNC });
    });
  }, []);
  useEffect(() => {
    return history.listen(location => {
      if (appState.module != getCurrentModuleFromUrl()) {
        startTransitionNewModule(() => {
          dispatch({ type: URL_SYNC });
        });
      } else {
        startTransitionModuleUpdate(() => {
          dispatch({ type: URL_SYNC });
        });
      }
    });
  }, [appState.module]);
  return (
    &lt;AppContext.Provider value={appStatePacket}>
      &lt;ModuleUpdateContext.Provider value={moduleUpdatePending}>
        &lt;div>
          &lt;MainNavigationBar />
          {isNewModulePending ? &lt;Loading /> : null}
          &lt;Suspense fallback={&lt;LongLoading />}>
            &lt;div id="main-content" style={{ flex: 1, overflowY: "auto" }}>
              {Component ? &lt;Component updating={moduleUpdatePending} /> : null}
            &lt;/div>
          &lt;/Suspense>
        &lt;/div>
      &lt;/ModuleUpdateContext.Provider>
    &lt;/AppContext.Provider>
  );
};</code></pre>



<p>First, we have two different calls to <code>useTransition</code>. We&#8217;ll use one for routing to a new module, and the other for updating search state for the current module. Why the difference? Well, when a module&#8217;s search state is updating, that module will likely want to display an inline loading indicator. That updating state is held by the <code>moduleUpdatePending</code> variable, which you&#8217;ll see I put on context for the active module to grab, and use as needed:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">&lt;div>
  &lt;MainNavigationBar />
  {isNewModulePending ? &lt;Loading /> : null}
  &lt;Suspense fallback={&lt;LongLoading />}>
    &lt;div id="main-content" style={{ flex: 1, overflowY: "auto" }}>
      {Component ? &lt;Component updating={moduleUpdatePending} /> : null} // highlight
    &lt;/div>
  &lt;/Suspense>
&lt;/div></code></pre>



<p>The <code>appStatePacket</code> is the result of the app state reducer I discussed above (but did not show). It contains various pieces of application state which rarely change (color theme, offline status, current module, etc).</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">let appStatePacket = useAppState();</code></pre>



<p>A little later, I grab whichever component happens to be active, based on the current module name. Initially this will be null.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">let Component = getModuleComponent(appState.module);</code></pre>



<p>The first call to <code>useEffect</code> will tell our <code>appSettings</code> reducer to sync with the URL at startup.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">useEffect(() => {
  startTransitionNewModule(() => {
    dispatch({ type: URL_SYNC });
  });
}, []);</code></pre>



<p>Since this is the initial module the web app navigates to, I wrap it in <code>startTransitionNewModule</code> to indicate that a fresh module is loading. While it might be tempting to have the <code>appSettings</code> reducer have the initial module name as its initial state, doing this prevents us from calling our <code>startTransitionNewModule</code> callback, which means our Suspense boundary would render the fallback immediately, instead of after the timeout.</p>



<p>The next call to <code>useEffect</code> sets up a history subscription. No matter what, when the url changes we tell our app settings to sync against the URL. The only difference is which <code>startTransition</code> that same call is wrapped in.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line="3,8"><code markup="tt">useEffect(() => {
  return history.listen(location => {
    if (appState.module != getCurrentModuleFromUrl()) {
      startTransitionNewModule(() => {
        dispatch({ type: URL_SYNC });
      });
    } else {
      startTransitionModuleUpdate(() => {
        dispatch({ type: URL_SYNC });
      });
    }
  });
}, [appState.module]);</code></pre>



<p>If we&#8217;re browsing to a new module, we call <code>startTransitionNewModule</code>. If we&#8217;re loading a component that hasn&#8217;t been loaded already, <code>React.lazy</code> will suspend, and the pending indicator visible only to the app&#8217;s root will set, which will show a loading spinner at the top of the app while the lazy component is fetched and loaded. Because of how <code>useTransition</code> works, the current screen will continue to show for three seconds. If that time expires and the component is still not ready, our UI will suspend, and the fallback will render, which will show the <code>&lt;LongLoading /&gt;</code> component:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">{isNewModulePending ? &lt;Loading /> : null}
&lt;Suspense fallback={&lt;LongLoading />}>
  &lt;div id="main-content" style={{ flex: 1, overflowY: "auto" }}>
    {Component ? &lt;Component updating={moduleUpdatePending} /> : null}
  &lt;/div>
&lt;/Suspense></code></pre>



<p>If we&#8217;re not changing modules, we call <code>startTransitionModuleUpdate</code>:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">startTransitionModuleUpdate(() => {
  dispatch({ type: URL_SYNC });
});</code></pre>



<p>If the update causes a suspension, the pending indicator we&#8217;re putting on context will be triggered. The active component can detect that and show whatever inline loading indicator it wants. As before, if the suspension takes longer than three seconds, the same Suspense boundary from before will be triggered&#8230; unless, as we&#8217;ll see later, there&#8217;s a Suspense boundary lower in the tree.</p>



<p>One important thing to note is that these three-second timeouts apply not only to the component loading, but also being ready to display. If the component loads in two seconds, and, when rendering in memory (since we&#8217;re inside of a <code>startTransition</code> call) suspends, the <code>useTransition</code> will <em>continue</em> to wait for up to one more second before Suspending.</p>



<p>In writing this blog post, I used Chrome&#8217;s slow network modes to help force loading to be slow, to test my Suspense boundaries. The settings are in the Network tab of Chrome&#8217;s dev tools. </p>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview.png?fit=1024%2C285&amp;ssl=1" alt="" class="wp-image-304866" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview.png?w=1328&amp;ssl=1 1328w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview.png?resize=300%2C84&amp;ssl=1 300w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview.png?resize=1024%2C285&amp;ssl=1 1024w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview.png?resize=768%2C214&amp;ssl=1 768w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview.png?resize=1000%2C279&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>Let&#8217;s open our app to the settings module. This will be called:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">dispatch({ type: URL_SYNC });</code></pre>



<p>Our <code>appSettings</code> reducer will sync with the URL, then set module to &#8220;settings.&#8221; This will happen inside of <code>startTransitionNewModule</code> so that, when the lazy-loaded component attempts to render, it&#8217;ll suspend. Since we&#8217;re inside <code>startTransitionNewModule</code>, the <code>isNewModulePending</code> will switch over to <code>true</code>, and the <code>&lt;Loading /&gt;</code> component will render.</p>



<figure class="wp-block-image size-large"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/8TSbMkpA.png?fit=1024%2C510&amp;ssl=1" alt="" class="wp-image-304867" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/8TSbMkpA.png?w=1600&amp;ssl=1 1600w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/8TSbMkpA.png?resize=300%2C149&amp;ssl=1 300w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/8TSbMkpA.png?resize=1024%2C510&amp;ssl=1 1024w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/8TSbMkpA.png?resize=768%2C383&amp;ssl=1 768w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/8TSbMkpA.png?resize=1536%2C765&amp;ssl=1 1536w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/8TSbMkpA.png?resize=1000%2C498&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-2.png?fit=1024%2C499&amp;ssl=1" alt="" class="wp-image-304868" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-2.png?w=1600&amp;ssl=1 1600w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-2.png?resize=300%2C146&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-2.png?resize=1024%2C499&amp;ssl=1 1024w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-2.png?resize=768%2C374&amp;ssl=1 768w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-2.png?resize=1536%2C748&amp;ssl=1 1536w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-2.png?resize=1000%2C487&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /><figcaption>If the component is still not ready to render&nbsp;within three seconds, the in-memory version of our component tree will switch over, suspend, and our Suspense boundary will render the&nbsp;<code>&lt;LongLoading /&gt;</code> component.</figcaption></figure>



<figure class="wp-block-image size-large"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/SskEWCOi.png?fit=1024%2C553&amp;ssl=1" alt="" class="wp-image-304869" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/SskEWCOi.png?w=1600&amp;ssl=1 1600w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/SskEWCOi.png?resize=300%2C162&amp;ssl=1 300w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/SskEWCOi.png?resize=1024%2C553&amp;ssl=1 1024w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/SskEWCOi.png?resize=768%2C415&amp;ssl=1 768w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/SskEWCOi.png?resize=1536%2C829&amp;ssl=1 1536w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/SskEWCOi.png?resize=1000%2C540&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /><figcaption>When&nbsp;it’s&nbsp;done, the settings module will show.</figcaption></figure>



<p>So what happens when we browse somewhere new? Basically the same thing as before, except this call:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">dispatch({ type: URL_SYNC });</code></pre>



<p>…will come from the second instance of <code>useEffect</code>. Let&#8217;s browse to the books module and see what happens. First, the inline spinner shows as expected:</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-3.png?fit=1024%2C460&amp;ssl=1" alt="" class="wp-image-304870" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-3.png?w=1600&amp;ssl=1 1600w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-3.png?resize=300%2C135&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-3.png?resize=1024%2C460&amp;ssl=1 1024w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-3.png?resize=768%2C345&amp;ssl=1 768w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-3.png?resize=1536%2C690&amp;ssl=1 1536w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-3.png?resize=1000%2C449&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<figure class="wp-block-image size-large"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/falZk-5B.png?fit=1024%2C452&amp;ssl=1" alt="" class="wp-image-304871" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/falZk-5B.png?w=1600&amp;ssl=1 1600w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/falZk-5B.png?resize=300%2C133&amp;ssl=1 300w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/falZk-5B.png?resize=1024%2C452&amp;ssl=1 1024w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/falZk-5B.png?resize=768%2C339&amp;ssl=1 768w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/falZk-5B.png?resize=1536%2C679&amp;ssl=1 1536w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/falZk-5B.png?resize=1000%2C442&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /><figcaption>If the three-second timeout elapses, our Suspense boundary will render its fallback:</figcaption></figure>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-4.png?fit=1024%2C482&amp;ssl=1" alt="" class="wp-image-304872" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-4.png?w=1600&amp;ssl=1 1600w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-4.png?resize=300%2C141&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-4.png?resize=1024%2C482&amp;ssl=1 1024w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-4.png?resize=768%2C361&amp;ssl=1 768w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-4.png?resize=1536%2C723&amp;ssl=1 1536w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-4.png?resize=1000%2C471&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /><figcaption>And, eventually,&nbsp;our books module loads:</figcaption></figure>



<h3>Searching and updating</h3>



<p>Let&#8217;s stay within the books module, and update the URL search string to kick off a new search. Recall from before that we were detecting the same module in that second <code>useEffect</code> call and using a dedicated <code>useTransition</code> call for it. From there, we were putting the pending indicator on context for whichever module was active for us to grab and use.</p>



<p>Let&#8217;s see some code to actually use that. There&#8217;s not really much Suspense-related code here. I’m grabbing the value from context, and if true, rendering an inline spinner on top of my existing results. Recall that this happens when a <code>useTransition</code> call has begun, and the app is suspended <strong>in memory</strong>. While that’s happening, we continue to show the existing UI, but with this loading indicator.</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const BookResults: SFC&lt;{ books: any; uiView: any }> = ({ books, uiView }) => {
  const isUpdating = useContext(ModuleUpdateContext);
  return (
    &lt;>
      {!books.length ? (
        &lt;div
          className="alert alert-warning"
          style={{ marginTop: "20px", marginRight: "5px" }}
        >
          No books found
        &lt;/div>
      ) : null}
      {isUpdating ? &lt;Loading /> : null}
      {uiView.isGridView ? (
        &lt;GridView books={books} />
      ) : uiView.isBasicList ? (
        &lt;BasicListView books={books} />
      ) : uiView.isCoversList ? (
        &lt;CoversView books={books} />
      ) : null}
    &lt;/>
  );
};</code></pre>



<p>Let&#8217;s set a search term and see what happens.&nbsp;First, the inline spinner displays.</p>



<figure class="wp-block-image size-large"><img src="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-5.png?fit=1024%2C492&amp;ssl=1" alt="" class="wp-image-304873" srcset="https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-5.png?w=1600&amp;ssl=1 1600w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-5.png?resize=300%2C144&amp;ssl=1 300w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-5.png?resize=1024%2C492&amp;ssl=1 1024w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-5.png?resize=768%2C369&amp;ssl=1 768w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-5.png?resize=1536%2C738&amp;ssl=1 1536w, https://i2.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-5.png?resize=1000%2C481&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>Then, if the&nbsp;<code>useTransition</code>&nbsp;timeout expires, we&#8217;ll get the Suspense boundary&#8217;s fallback. The books module defines its own Suspense boundary in order to provide a more fine-tuned loading indicator, which looks like this:</p>



<figure class="wp-block-image size-large"><img src="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-6-bordered.png?fit=1024%2C396&amp;ssl=1" alt="" class="wp-image-304879" srcset="https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-6-bordered.png?w=1602&amp;ssl=1 1602w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-6-bordered.png?resize=300%2C116&amp;ssl=1 300w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-6-bordered.png?resize=1024%2C396&amp;ssl=1 1024w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-6-bordered.png?resize=768%2C297&amp;ssl=1 768w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-6-bordered.png?resize=1536%2C593&amp;ssl=1 1536w, https://i1.wp.com/css-tricks.com/wp-content/uploads/2020/03/image_preview-6-bordered.png?resize=1000%2C386&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>This is a key point. When making Suspense boundary fallbacks, try not to&nbsp;throw up any sort of&nbsp;spinner&nbsp;and &#8220;loading&#8221; message. That made sense for our top-level navigation&nbsp;because&nbsp;there&#8217;s not much else to do. But when you&#8217;re in a specific part of your application, try to make your fallback re-use many of the same components with some sort of loading indicator where the data would be&nbsp;—&nbsp;but with everything else disabled.</p>



<p>This is what the relevant components look like for my books module:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">const RenderModule: SFC&lt;{}> = ({}) => {
  const uiView = useBookSearchUiView();
  const [lastBookResults, setLastBookResults] = useState({
    totalPages: 0,
    resultsCount: 0
  });
  return (
    &lt;div className="standard-module-container margin-bottom-lg">
      &lt;Suspense fallback={&lt;Fallback uiView={uiView} {...lastBookResults} />}>
        &lt;MainContent uiView={uiView} setLastBookResults={setLastBookResults} />
      &lt;/Suspense>
    &lt;/div>
  );
};
const Fallback: SFC&lt;{
  uiView: BookSearchUiView;
  totalPages: number;
  resultsCount: number;
}> = ({ uiView, totalPages, resultsCount }) => {
  return (
    &lt;>
      &lt;BooksMenuBarDisabled
        totalPages={totalPages}
        resultsCount={resultsCount}
      />
      {uiView.isGridView ? (
        &lt;GridViewShell />
      ) : (
        &lt;h1>
          Books are loading &lt;i className="fas fa-cog fa-spin">&lt;/i>
        &lt;/h1>
      )}
    &lt;/>
  );
};</code></pre>



<h3>A quick note on consistency</h3>



<p>Before we move on, I&#8217;d like to point out one thing from the earlier screenshots. Look at the inline spinner that displays while the search is pending, then look at the screen when that search suspended, and next, the finished results:</p>



<figure class="wp-block-image size-large"><img src="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-clear-search.png?fit=1024%2C369&amp;ssl=1" alt="" class="wp-image-304875" srcset="https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-clear-search.png?w=1600&amp;ssl=1 1600w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-clear-search.png?resize=300%2C108&amp;ssl=1 300w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-clear-search.png?resize=1024%2C369&amp;ssl=1 1024w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-clear-search.png?resize=768%2C277&amp;ssl=1 768w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-clear-search.png?resize=1536%2C554&amp;ssl=1 1536w, https://i0.wp.com/css-tricks.com/wp-content/uploads/2020/03/suspense-clear-search.png?resize=1000%2C361&amp;ssl=1 1000w" sizes="(min-width: 735px) 864px, 96vw" /></figure>



<p>Notice how there&#8217;s a &#8220;C++&#8221; label to the right of the search pane, with an option to remove it from the search query? Or rather, notice how that label is only on the second two screenshots? The moment the URL updates, the application state governing that label <em>is</em> updated; however, that state does not initially display. Initially, the state update suspends in memory (since we used useTransition), and the <em>prior</em> UI continues to show.</p>



<p>Then the fallback renders. The fallback renders a disabled version of that same search bar, which does show the current search state (by choice). We&#8217;ve now removed our prior UI (since by now it’s quite old, and stale) and are waiting on the search shown in the disabled menu bar.</p>



<p>This is the sort of consistency Suspense gives you, for free.</p>



<p>You can spend your time crafting nice application states, and React does the leg work of surmising whether things are ready, without you needing to juggle promises.</p>



<h3>Nested Suspense boundaries</h3>



<p>Let&#8217;s suppose our top-level navigation takes a while to load our books component to the extent that our “Still loading, sorry” spinner from the Suspense boundary renders. From there, the books component loads and the new Suspense boundary inside the books component renders. But, then, as rendering continues, our book search query fires, and suspends. What will happen? Will the top-level Suspense boundary continue to show, until everything is ready, or will the lower-down Suspense boundary in books take over?</p>



<p>The answer is the latter. As new Suspense boundaries render lower in the tree, their fallback will <em>replace</em> the fallback of whatever antecedent Suspense fallback was already showing. There&#8217;s currently an unstable API to override this, but if you&#8217;re doing a good job of crafting your fallbacks, this is probably the behavior you want. You don&#8217;t want “Still loading, sorry” to just keep showing. Rather, as soon as the books component is ready, you absolutely want to display that shell with the more targeted waiting message.</p>



<p>Now, what if our books module loads and starts to render while the <code>startTransition</code> spinner is still showing and then suspends? In other words, imagine that our <code>startTransition</code> has a timeout of three seconds, the books component renders, the nested Suspense boundary is in the component tree after one second, and the search query suspends. Will the remaining two seconds elapse before that new nested Suspense boundary renders the fallback, or will the fallback show immediately? The answer, perhaps surprisingly, is that the new Suspense fallback will show immediately by default. That’s because it&#8217;s best to show a new, valid UI as quickly as possible, so the user can see that things are happening, and progressing.&nbsp;</p>



<h3>How data fits in</h3>



<p>Navigation is fine, but how does data loading fit into all of this?</p>



<p>It fits in completely and transparently. Data loading triggers suspensions just like navigation with <code>React.lazy</code>, and it hooks into all the same <code>useTransition</code> and Suspense boundaries. This is what&#8217;s so amazing about Suspense:<strong> all your async dependencies seamlessly work in this same system. </strong>Managing these various async requests manually to ensure consistency was a nightmare before Suspense, which is precisely why nobody did it. Web apps were notorious for cascading spinners that stopped at unpredictable times, producing inconsistent UIs that were only partially finished.</p>



<p>OK, but how do we actually tie data loading into this? Data loading in Suspense is paradoxically both more complex, and also simple.</p>



<p>I&#8217;ll explain.</p>



<p>If you&#8217;re waiting on data, you&#8217;ll throw a promise in the component that reads (or attempts to read) the data. The promise should be consistent based on the data request. So, four repeated requests for that same &#8220;C++&#8221; search query should throw the same, identical promise. This implies some sort of caching layer to manage all this. You&#8217;ll likely not write this yourself. Instead, you&#8217;ll just hope, and wait for the data library you use to update itself to support Suspense.</p>



<p>This is already done in my <a href="https://github.com/arackaf/micro-graphql-react">micro-graphql-react</a> library. Instead of using the <code>useQuery</code> hook, you’ll use the <code>useSuspenseQuery</code> hook, which has an identical API, but throws a consistent promise when you&#8217;re waiting on data.</p>



<h3>Wait, what about preloading?!</h3>



<p>Has your brain turned to mush reading other things on Suspense that talked about waterfalls, fetch-on-render, preloading, etc? Don&#8217;t worry about it. Here&#8217;s what it all means.</p>



<p>Let&#8217;s say you lazy load the books component, which renders <em>and then</em> requests some data, which causes a new Suspense. The network request for the component and the network request for the data will happen one after the other—in a waterfall fashion.</p>



<p>But here&#8217;s the key part: the application state that led to whatever initial query that ran when the component loaded was already available when you started loading the component (which, in this case, is the URL). So why not &#8220;start&#8221; the query as soon as you know you&#8217;ll need it? As soon as you browse to <code>/books</code>, why not fire off the current search query right then and there, so it&#8217;s already in flight when the component loads.</p>



<p>The micro-graphql-react module does indeed have a <code>preload</code> method, and I urge you to use it. Preloading data is a nice performance optimization, but it has nothing to do with Suspense. Classic React apps could (and should) preload data as soon as they know they&#8217;ll need it. Vue apps should preload data as soon as they know they&#8217;ll need it. Svelte apps should&#8230; you get the point.</p>



<p>Preloading data is orthogonal to Suspense, which is something you can do with literally any framework. It’s also something we all should have been doing already, even though nobody else was.</p>



<h3>But seriously, how do you preload?</h3>



<p>That&#8217;s up to you. At the very least, the logic to run the current search absolutely needs to be completely separated into its own, standalone module. You should literally make sure this preload function is in a file by itself. Don&#8217;t rely on webpack to treeshake; you&#8217;ll likely face abject sadness the next time you audit your bundles.</p>



<p>You have a <code>preload()</code> method in its own bundle, so call it. Call it when you know you&#8217;re about to navigate to that module. I assume React Router has some sort of API to run code on a navigation change. For the vanilla routing code above, I call the method in that routing switch from before. I had omitted it for brevity, but the books entry actually looks like this:</p>



<pre rel="JavaScript" class="wp-block-csstricks-code-block language-javascript" data-line=""><code markup="tt">switch (moduleToLoad.toLowerCase()) {
  case "activate":
    return ActivateComponent;
  case "authenticate":
    return AuthenticateComponent;
  case "books":
    // preload!!!
    booksPreload();
    return BooksComponent;</code></pre>



<p>That&#8217;s it. Here&#8217;s a live demo to play around with:</p>



<iframe height="800" width="100%" style="border: 1px solid #eaeaea;" src="https://mylibrary.io/view?userId=573d1b97120426ef0078aa92"></iframe>



<p>To modify the Suspense timeout value, which defaults to 3000ms, navigate to Settings, and check out the misc tab. Just be sure to refresh the page after modifying it.</p>



<h3>Wrapping up</h3>



<p>I&#8217;ve seldom been as excited for anything in the web dev ecosystem as I am for Suspense. It&#8217;s an incredibly ambitious system for managing one of the trickiest problems in web development: asynchrony.</p>
<p>The post <a rel="nofollow" href="https://css-tricks.com/react-suspense-in-practice/">React Suspense in Practice</a> appeared first on <a rel="nofollow" href="https://css-tricks.com">CSS-Tricks</a>.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://css-tricks.com/react-suspense-in-practice/feed/</wfw:commentRss>
			<slash:comments>2</slash:comments>
		
		
		<post-id xmlns="com-wordpress:feed-additions:1">304861</post-id>	</item>
	</channel>
</rss>
